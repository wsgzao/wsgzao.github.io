
 <!DOCTYPE HTML>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <script type="text/javascript">
    var host = "wsgzao.github.io";
    if ((host == window.location.host) && (window.location.protocol != "https:"))
        window.location.protocol = "https";
  </script> 
<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-LJ3PMGPVCK"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-LJ3PMGPVCK');
</script>
  
    <title>使用Monit替代Supervisor自动化管理和监控服务小结 | HelloDog</title>
    <meta name="viewport" content="width=device-width, initial-scale=1,user-scalable=no">
    
    <meta name="author" content="wsgzao">
    

    
    <meta name="description" content="使用Monit替代Supervisor自动化管理和监控服务小结">
<meta property="og:type" content="article">
<meta property="og:title" content="使用Monit替代Supervisor自动化管理和监控服务小结">
<meta property="og:url" content="https://wsgzao.github.io/post/monit/index.html">
<meta property="og:site_name" content="HelloDog">
<meta property="og:description" content="使用Monit替代Supervisor自动化管理和监控服务小结">
<meta property="og:locale" content="zh_CN">
<meta property="article:published_time" content="2020-01-15T06:59:49.000Z">
<meta property="article:modified_time" content="2023-02-27T05:33:06.936Z">
<meta property="article:author" content="wsgzao">
<meta name="twitter:card" content="summary">

    
    <link rel="alternative" href="/atom.xml" title="HelloDog" type="application/atom+xml">
    
    
    <link rel="icon" href="/img/favicon.ico">
    
    
    <link rel="apple-touch-icon" href="/img/jacman.jpg">
    <link rel="apple-touch-icon-precomposed" href="/img/jacman.jpg">
    
    
<link rel="stylesheet" href="/css/style.css">

<meta name="generator" content="Hexo 6.3.0"></head>

  <body>
    <header>
      
<div>
		
			<div id="imglogo">
				<a href="/"><img src="/img/logo.png" alt="HelloDog" title="HelloDog"/></a>
			</div>
			
			<div id="textlogo">
				<h1 class="site-name"><a href="/" title="HelloDog">HelloDog</a></h1>
				<h2 class="blog-motto">Keep Calm and Carry On</h2>
			</div>
			<div class="navbar"><a class="navbutton navmobile" href="#" title="菜单">
			</a></div>
			<nav class="animated">
				<ul>
					<ul>
					 
						<li><a href="/">主页 | Home</a></li>
					
						<li><a href="/index/">索引 | Index</a></li>
					
						<li><a href="/archives/">归档 | Archives</a></li>
					
						<li><a href="/about/">简介 | About</a></li>
					
					<li>
 					
						<form class="search">
							<label>Search</label>
						<input type="text" id="search" class="st-default-search-input" name="q" size="30" placeholder="搜索"><br>
						</form>
					
					</li>
				</ul>
			</nav>			
</div>
    </header>
    <div id="container">
      <div id="main" class="post" itemscope itemprop="blogPost">
  
	<article itemprop="articleBody"> 
		<header class="article-info clearfix">
  <h1 itemprop="name">
    
      <a href="/post/monit/" title="使用Monit替代Supervisor自动化管理和监控服务小结" itemprop="url">使用Monit替代Supervisor自动化管理和监控服务小结</a>
  </h1>
  <p class="article-author">By
       
		<a href="/about" title="wsgzao" target="_blank" itemprop="author">wsgzao</a>
		
  <p class="article-time">
    <time datetime="2020-01-15T06:59:49.000Z" itemprop="datePublished"> 发表于 2020-01-15</time>
    
  </p>
</header>
	<div class="article-content">
<!-- 		
		<div id="toc" class="toc-article">
			<strong class="toc-title">文章目录</strong>
		
			<ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%89%8D%E8%A8%80"><span class="toc-number">1.</span> <span class="toc-text">前言</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%9B%B4%E6%96%B0%E5%8E%86%E5%8F%B2"><span class="toc-number">2.</span> <span class="toc-text">更新历史</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Monit%E4%BB%8B%E7%BB%8D"><span class="toc-number">3.</span> <span class="toc-text">Monit介绍</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Supervisor%E4%BB%8B%E7%BB%8D"><span class="toc-number">4.</span> <span class="toc-text">Supervisor介绍</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Supervisor-A-Process-Control-System"><span class="toc-number"></span> <span class="toc-text">Supervisor: A Process Control System</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#Monit-VS-Supervisor"><span class="toc-number">1.</span> <span class="toc-text">Monit VS Supervisor</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Monit%E6%98%AF%E4%BB%80%E4%B9%88"><span class="toc-number">1.1.</span> <span class="toc-text">Monit是什么</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%BA%E4%BB%80%E4%B9%88%E9%80%89%E6%8B%A9Monit"><span class="toc-number">1.2.</span> <span class="toc-text">为什么选择Monit</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Supervisor%E4%BC%98%E7%BC%BA%E7%82%B9"><span class="toc-number">1.3.</span> <span class="toc-text">Supervisor优缺点</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Monit%E4%BC%98%E7%BC%BA%E7%82%B9"><span class="toc-number">1.4.</span> <span class="toc-text">Monit优缺点</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Monit%E5%9F%BA%E6%9C%AC%E7%94%A8%E6%B3%95"><span class="toc-number">2.</span> <span class="toc-text">Monit基本用法</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Monit%E5%B8%B8%E7%94%A8%E5%91%BD%E4%BB%A4"><span class="toc-number">2.1.</span> <span class="toc-text">Monit常用命令</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Monit%E6%9C%8D%E5%8A%A1%E7%9B%91%E6%8E%A7%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6%E6%A0%BC%E5%BC%8F"><span class="toc-number">2.2.</span> <span class="toc-text">Monit服务监控配置文件格式</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Monit%E9%85%8D%E7%BD%AE%E5%AE%9E%E8%B7%B5"><span class="toc-number">3.</span> <span class="toc-text">Monit配置实践</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%8F%82%E8%80%83%E6%96%87%E7%AB%A0"><span class="toc-number">4.</span> <span class="toc-text">参考文章</span></a></li></ol>
		
		</div>
		 -->
		<h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>对于进程的监控最常见的需求就是进程挂了如何被自动拉起来，现在可以由Kubernetes等先进的容器化技术来自动化管理，那原来再物理服务器或者虚拟机中的进程有什么好的办法呢？答案就是Monit&#x2F;Supervisor等第三方应用来解决，因为线上环境分别使用Monit来监控Core Logical Service，Supervisor用在Codis Dashboard&#x2F;FE&#x2F;Proxy上，使用下来的感受和网上的对比分析报告类似，具体内容会在文章内引用，推荐大家使用Monit替代Supervisor自动化管理和监控服务。</p>
<blockquote>
<p>使用Monit替代Supervisor自动化管理和监控服务小结</p>
</blockquote>
<h2 id="更新历史"><a href="#更新历史" class="headerlink" title="更新历史"></a>更新历史</h2><p>2020年01月15日 - 初稿</p>
<p>阅读原文 - <a href="https://wsgzao.github.io/post/monit/">https://wsgzao.github.io/post/monit/</a></p>
<p><strong>扩展阅读</strong></p>
<p><a target="_blank" rel="noopener" href="https://mmonit.com/">Monit</a><br><a target="_blank" rel="noopener" href="http://supervisord.org/">Supervisor</a></p>
<hr>
<h2 id="Monit介绍"><a href="#Monit介绍" class="headerlink" title="Monit介绍"></a>Monit介绍</h2><blockquote>
<p>NAME</p>
</blockquote>
<p>Monit - utility for monitoring services on a Unix system</p>
<blockquote>
<p>SYNOPSIS</p>
</blockquote>
<p><strong>monit</strong> [options] <arguments></p>
<blockquote>
<p>DESCRIPTION</p>
</blockquote>
<p><strong>Monit</strong> is a utility for managing and monitoring processes, programs, files, directories and filesystems on a Unix system. Monit conducts automatic maintenance and repair and can execute meaningful causal actions in error situations. E.g. Monit can start a process if it does not run, restart a process if it does not respond and stop a process if it uses too much resources. You can use Monit to monitor files, directories and filesystems for changes, such as timestamps changes, checksum changes or size changes.</p>
<p>Monit is controlled via an easy to configure control file based on a free-format, token-oriented syntax. Monit logs to syslog or to its own log file and notifies you about error conditions via customisable alert messages. Monit can perform various TCP&#x2F;IP network checks, protocol checks and can utilise SSL for such checks. Monit provides a HTTP(S) interface and you may use a browser to access the Monit program.</p>
<blockquote>
<p>WHAT TO MONITOR?</p>
</blockquote>
<p>You can use Monit to monitor daemon <strong>processes</strong> or similar programs running on localhost. Monit is particularly useful for monitoring daemon processes, such as those started at system boot time. For instance sendmail, sshd, apache and mysql. In contrast to many other monitoring systems, Monit can act if an error situation should occur, e.g.; if sendmail is not running, monit can start sendmail again automatically or if apache is using too many resources (e.g. if a DoS attack is in progress) Monit can stop or restart apache and send you an alert message. Monit can also monitor process characteristics, such as how much memory or cpu cycles a process is using.</p>
<p>You can also use Monit to monitor <strong>files</strong>, <strong>directories</strong> and <strong>filesystems</strong> on localhost. Monit can monitor these items for changes, such as timestamps changes, checksum changes or size changes. This is also useful for security reasons - you can monitor the md5 or sha1 checksum of files that should not change and get an alert or perform an action if they should change.</p>
<p>Monit can monitor <strong>network connections</strong> to various servers, either on localhost or on remote hosts. TCP, UDP and Unix Domain Sockets are supported. Network test can be performed on a protocol level; Monit has built-in tests for the main Internet protocols, such as HTTP, SMTP etc. Even if a protocol is not supported you can still test the server because you can configure Monit to send any data and test the response from the server.</p>
<p>Monit can be used to test <strong>programs</strong> or scripts at certain times, much like cron, but in addition, you can test the exit value of a program and perform an action or send an alert if the exit value indicates an error. This means that you can use Monit to perform any type of check you can write a script for.</p>
<p>Finally, Monit can be used to monitor general <strong>system</strong> resources on localhost such as overall CPU usage, Memory and System Load.</p>
<p><a target="_blank" rel="noopener" href="https://mmonit.com/monit/documentation/monit.html">https://mmonit.com/monit/documentation/monit.html</a></p>
<h2 id="Supervisor介绍"><a href="#Supervisor介绍" class="headerlink" title="Supervisor介绍"></a>Supervisor介绍</h2><h1 id="Supervisor-A-Process-Control-System"><a href="#Supervisor-A-Process-Control-System" class="headerlink" title="Supervisor: A Process Control System"></a>Supervisor: A Process Control System</h1><p>Supervisor is a client&#x2F;server system that allows its users to monitor and control a number of processes on UNIX-like operating systems.</p>
<p>It shares some of the same goals of programs like <a target="_blank" rel="noopener" href="http://supervisord.org/glossary.html#term-launchd"><em>launchd</em></a>, <a target="_blank" rel="noopener" href="http://supervisord.org/glossary.html#term-daemontools"><em>daemontools</em></a>, and <a target="_blank" rel="noopener" href="http://supervisord.org/glossary.html#term-runit"><em>runit</em></a>. Unlike some of these programs, it is not meant to be run as a substitute for init as “process id 1”. Instead it is meant to be used to control processes related to a project or a customer, and is meant to start like any other program at boot time.</p>
<p><a target="_blank" rel="noopener" href="http://supervisord.org/">http://supervisord.org/</a></p>
<h2 id="Monit-VS-Supervisor"><a href="#Monit-VS-Supervisor" class="headerlink" title="Monit VS Supervisor"></a>Monit VS Supervisor</h2><h3 id="Monit是什么"><a href="#Monit是什么" class="headerlink" title="Monit是什么"></a>Monit是什么</h3><ul>
<li>Monit 是一个管理和监控 Unix 系统的小型开源组件.</li>
<li>Monit 可以在出现错误的情况下, 自动维护, 修复和做一些有意义的行为</li>
</ul>
<h3 id="为什么选择Monit"><a href="#为什么选择Monit" class="headerlink" title="为什么选择Monit"></a>为什么选择Monit</h3><p>除了 Monit 还有一些其他的第三方监控方案(eg. Supervisor), 我们考虑选择额 Monit 作为监控的原因有</p>
<ul>
<li>超轻量, 稳定, 高可用</li>
<li>依赖少, 安装配置方便, 尽量减少运维及学习成本(即使没有任何 Monit 基础的人, 都能轻易的读懂大部分监控文件)</li>
<li>非侵入式, 被监控的程序可以不用知道监控程序的存在(如果使用 Supervisor 监控, 则服务必须从 Supervisor 启动)</li>
<li>基本功能完备(9 种类型监控, 邮件报警, 支持用户自定义 shell 扩展)</li>
</ul>
<h3 id="Supervisor优缺点"><a href="#Supervisor优缺点" class="headerlink" title="Supervisor优缺点"></a>Supervisor优缺点</h3><p><strong>优点</strong></p>
<ol>
<li>轻量、特性丰富、内存友好(好客套的优点。。。)</li>
<li>对被监控进程的状态获取迅速且精确——通过子进程管理，没办法不精确</li>
</ol>
<p><strong>缺点</strong></p>
<ol>
<li>被监控进程必须运行在前台(可以理解为有自己的控制终端)——这也是最为致命的一点</li>
<li>无法管理依赖，也就是说无法控制服务启动先后顺序</li>
<li>无法管理被监控进程创建的子进程——重启服务时被监控进程的子进程无法正常退出，隐患大</li>
<li>无法控制进程失败重试的间隔时间——有些进程需要清理资源，不过这点还好</li>
</ol>
<h3 id="Monit优缺点"><a href="#Monit优缺点" class="headerlink" title="Monit优缺点"></a>Monit优缺点</h3><p><strong>优点</strong></p>
<ol>
<li>安装配置简单，同样轻量(似乎也是很客套了)</li>
<li>可以监控前台进程和非前台进程——完美的弥补了supervisor的致命缺点</li>
<li>除了监控进程还能监控文件、文件系统，甚至系统资源，CPU利用率，内存使用也是可以的</li>
<li>被监控的进程可以设置依赖，控制启动顺序</li>
</ol>
<p><strong>缺点</strong></p>
<ol>
<li>无法监控没有pid文件的进程，如shell脚本</li>
<li>对进程监控的状态感知有延时，即精度不够——采用轮训决定了它无法像supervisor一样实时感知被监控进程状态</li>
</ol>
<p>这样看起来还是monit更为普适一点。</p>
<p>不过这催生了一个大胆的想法，使用supervisor管理容器内多进程，monit作为一个被监控进程挂在supervisor之下。这样对于无法前台运行的程序，就可以通过monit监控，而对服务中断感知强烈的则直接挂在supervisor之下。看起来似乎是个好办法，有机会试试，哈哈哈。</p>
<p>从实际容器中运行的表现看，monit经常出现各种未知异常，而supervisor表现得十分稳定。</p>
<h2 id="Monit基本用法"><a href="#Monit基本用法" class="headerlink" title="Monit基本用法"></a>Monit基本用法</h2><h3 id="Monit常用命令"><a href="#Monit常用命令" class="headerlink" title="Monit常用命令"></a>Monit常用命令</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># monit -h</span></span><br><span class="line">Usage: monit [options]+ [<span class="built_in">command</span>]</span><br><span class="line">Options are as follows:</span><br><span class="line"> -c file       Use this control file</span><br><span class="line"> -d n          Run as a daemon once per n seconds</span><br><span class="line"> -g name       Set group name <span class="keyword">for</span> monit commands</span><br><span class="line"> -l logfile    Print <span class="built_in">log</span> information to this file</span><br><span class="line"> -p pidfile    Use this lock file <span class="keyword">in</span> daemon mode</span><br><span class="line"> -s statefile  Set the file monit should write state information to</span><br><span class="line"> -I            Do not run <span class="keyword">in</span> background (needed when run from init)</span><br><span class="line"> --<span class="built_in">id</span>          Print Monit<span class="string">&#x27;s unique ID</span></span><br><span class="line"><span class="string"> --resetid     Reset Monit&#x27;</span>s unique ID. Use with caution</span><br><span class="line"> -B            Batch <span class="built_in">command</span> line mode (<span class="keyword">do</span> not output tables or colors)</span><br><span class="line"> -t            Run syntax check <span class="keyword">for</span> the control file</span><br><span class="line"> -v            Verbose mode, work noisy (diagnostic output)</span><br><span class="line"> -vv           Very verbose mode, same as -v plus <span class="built_in">log</span> stacktrace on error</span><br><span class="line"> -H [filename] Print SHA1 and MD5 hashes of the file or of stdin <span class="keyword">if</span> the</span><br><span class="line">               filename is omited; monit will <span class="built_in">exit</span> afterwards</span><br><span class="line"> -V            Print version number and patchlevel</span><br><span class="line"> -h            Print this text</span><br><span class="line">Optional commands are as follows:</span><br><span class="line"> start all             - Start all services</span><br><span class="line"> start &lt;name&gt;          - Only start the named service</span><br><span class="line"> stop all              - Stop all services</span><br><span class="line"> stop &lt;name&gt;           - Stop the named service</span><br><span class="line"> restart all           - Stop and start all services</span><br><span class="line"> restart &lt;name&gt;        - Only restart the named service</span><br><span class="line"> monitor all           - Enable monitoring of all services</span><br><span class="line"> monitor &lt;name&gt;        - Only <span class="built_in">enable</span> monitoring of the named service</span><br><span class="line"> unmonitor all         - Disable monitoring of all services</span><br><span class="line"> unmonitor &lt;name&gt;      - Only <span class="built_in">disable</span> monitoring of the named service</span><br><span class="line"> reload                - Reinitialize monit</span><br><span class="line"> status [name]         - Print full status information <span class="keyword">for</span> service(s)</span><br><span class="line"> summary [name]        - Print short status information <span class="keyword">for</span> service(s)</span><br><span class="line"> report [up|down|..]   - Report state of services. See manual <span class="keyword">for</span> options</span><br><span class="line"> quit                  - Kill the monit daemon process</span><br><span class="line"> validate              - Check all services and start <span class="keyword">if</span> not running</span><br><span class="line"> procmatch &lt;pattern&gt;   - Test process matching pattern</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>想要让 Monit 可靠的为我们工作, 学习成本非常低, 只需要学习一些 Monit 命令行和配置文件写法</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># options - 选项</span></span><br><span class="line">- monit</span><br><span class="line">- monit -t</span><br><span class="line">- monit -c /var/monit/monitrc  <span class="comment"># 指定配置文件</span></span><br><span class="line">- monit -g &lt;groupname&gt; start/stop <span class="comment"># Monit 可以对各个监控分组, 如果需要对某个分组统一操作, 可以用这个命令</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># arguments - 参数</span></span><br><span class="line">- monit reload</span><br><span class="line">- monit quit</span><br><span class="line">- monit start/stop/restart/monitor/unmonitor &lt;name&gt;/all  <span class="comment"># &lt;name&gt;: 每个监控都有一个独一无二的名字, 具体后面会提到; all: 所有监控服务</span></span><br></pre></td></tr></table></figure>

<h3 id="Monit服务监控配置文件格式"><a href="#Monit服务监控配置文件格式" class="headerlink" title="Monit服务监控配置文件格式"></a>Monit服务监控配置文件格式</h3><p>详细配置, 共计 9 种, 所有配置中, 都符合以下规则</p>
<ul>
<li>如果指定的 path 不存在, 而且配置块里包含 start 方法, 会调用这个 start 方法</li>
<li>如果 path 指定的文件类型不对, Monit 不能监控这个项目</li>
</ul>
<blockquote>
<ol>
<li>Process</li>
</ol>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">CHECK PROCESS &lt;unique name&gt; &lt;PIDFILE &lt;path&gt; | MATCHING &lt;regex&gt;&gt;</span><br><span class="line"></span><br><span class="line">&lt;path&gt; pid-file 的绝对路径. 不存在 pid-file 文件或者 pid-file 文件没有对应的正在运行的程序, Monit 会执行 start 方法</span><br><span class="line"></span><br><span class="line">&lt;regex&gt; 进程名称的正则表达来监控进程, 可以通过命令行测试正则是否写对了: monit procmatch &quot;regex-pattern&quot;</span><br></pre></td></tr></table></figure>

<blockquote>
<ol start="2">
<li>File</li>
</ol>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">CHECK FILE &lt;unique name&gt; PATH &lt;path&gt;</span><br><span class="line"></span><br><span class="line">&lt;path&gt; file 的绝对路径.</span><br></pre></td></tr></table></figure>

<blockquote>
<ol start="3">
<li>Fifo</li>
</ol>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">CHECK FIFO &lt;unique name&gt; PATH &lt;path&gt;</span><br><span class="line">&lt;path&gt; fifo 的绝对路径.</span><br></pre></td></tr></table></figure>

<blockquote>
<ol start="4">
<li>Filesystem</li>
</ol>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">CHECK FILESYSTEM &lt;unique name&gt; PATH &lt;path&gt;</span><br><span class="line">&lt;path&gt; 设备/磁盘, 挂载点的路径 或 NFS/CIFS/FUSE 链接字符串. 如果文件系统不可用, Monit 会执行 start 方法</span><br></pre></td></tr></table></figure>

<blockquote>
<ol start="5">
<li>Directory</li>
</ol>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">CHECK DIRECTORY &lt;unique name&gt; PATH &lt;path&gt;</span><br><span class="line"></span><br><span class="line">&lt;path&gt; 目录问价的绝对路径</span><br></pre></td></tr></table></figure>

<blockquote>
<ol start="6">
<li>Remote host</li>
</ol>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">CHECK HOST &lt;unique name&gt; ADDRESS &lt;host&gt;</span><br><span class="line"></span><br><span class="line">&lt;host&gt; 可以是域名或者 IP 地址. eg: &quot;tildeslash.com&quot; or &quot;64.87.72.95&quot;.</span><br></pre></td></tr></table></figure>

<blockquote>
<ol start="7">
<li>System</li>
</ol>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">CHECK SYSTEM &lt;unique name&gt;</span><br><span class="line"></span><br><span class="line">&lt;unique name&gt; 通常来说是本机名称(可以用 $HOST), 也可以是其他名称. 用于邮件报警或者 M/Monit 的初始化名称</span><br><span class="line">这类配置可以监控系统资源(CPU, memory, load average...)</span><br></pre></td></tr></table></figure>

<blockquote>
<ol start="8">
<li>Program</li>
</ol>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">CHECK PROGRAM &lt;unique name&gt; PATH &lt;executable file&gt; [TIMEOUT &lt;number&gt; SECONDS]</span><br><span class="line"></span><br><span class="line">&lt;path&gt; 可执行程序或脚本的绝对路径. 允许检查程序退出状态.如果程序没能在 &lt;number&gt; 秒内执行完成, Monit 会终结这个程序, 默认是 300s</span><br><span class="line">程序的输出会被记录, 用于用户界面或者报警, 默认 512 bytes(可以通过 set limits 修改)</span><br></pre></td></tr></table></figure>

<blockquote>
<ol start="9">
<li>Network</li>
</ol>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">CHECK NETWORK &lt;unique name&gt; &lt;ADDRESS &lt;ipaddress&gt; | INTERFACE &lt;name&gt;&gt;</span><br><span class="line"></span><br><span class="line"># &lt;ipaddress&gt; 是被监控的 IPv4/IPv6 网卡地址. 用 eth0 也是可以的</span><br></pre></td></tr></table></figure>

<p>更多配置信息可以参考Monit官方文档和实例</p>
<p><a target="_blank" rel="noopener" href="https://mmonit.com/documentation/">https://mmonit.com/documentation/</a></p>
<p><a target="_blank" rel="noopener" href="https://mmonit.com/wiki/Monit/ConfigurationExamples">https://mmonit.com/wiki/Monit/ConfigurationExamples</a></p>
<h2 id="Monit配置实践"><a href="#Monit配置实践" class="headerlink" title="Monit配置实践"></a>Monit配置实践</h2><ol>
<li>创建templates模板，利用python生成monit配置文件</li>
<li>使用ansible推送到目标服务器中</li>
</ol>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 创建通用配置，配置日志，邮件告警</span></span><br><span class="line">vim basic.j2</span><br><span class="line"></span><br><span class="line"><span class="comment"># log to monit.log</span></span><br><span class="line"><span class="built_in">set</span> logfile /var/log/monit.log</span><br><span class="line"></span><br><span class="line"><span class="built_in">set</span> daemon &#123;&#123; monit_poll_interval &#125;&#125;</span><br><span class="line"></span><br><span class="line"><span class="built_in">set</span> eventqueue basedir /var/lib/monit/events slots 5000</span><br><span class="line"></span><br><span class="line"><span class="built_in">set</span> mailserver smtp.xxx.com port 465</span><br><span class="line"></span><br><span class="line"><span class="built_in">set</span> alert xxx@xxx.com &#123; nonexist, <span class="built_in">timeout</span>, resource &#125;</span><br><span class="line"></span><br><span class="line"><span class="built_in">set</span> mail-format &#123;</span><br><span class="line">  from: xxx@xxx.com</span><br><span class="line">  subject: monit alert -- <span class="variable">$SERVICE</span> <span class="variable">$EVENT</span> at <span class="variable">$DATE</span></span><br><span class="line">  message: <span class="variable">$EVENT</span> Service <span class="variable">$SERVICE</span></span><br><span class="line">                Date:        <span class="variable">$DATE</span></span><br><span class="line">                Action:      <span class="variable">$ACTION</span></span><br><span class="line">                Host:        <span class="variable">$HOST</span></span><br><span class="line">                Description: <span class="variable">$DESCRIPTION</span></span><br><span class="line"></span><br><span class="line">           Your faithful employee,</span><br><span class="line">           Monit</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 创建标准应用监控</span></span><br><span class="line">vim daemon_set.j2</span><br><span class="line"></span><br><span class="line">check process xxx with pidfile /run/xxx/daemon.pid</span><br><span class="line">    start program = <span class="string">&quot;/usr/bin/python2  /bin/xxx restart&quot;</span></span><br><span class="line">    stop program = <span class="string">&quot;/usr/bin/python2 /bin/xxx stop&quot;</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> 10 restarts within 10 cycles <span class="keyword">then</span> unmonitor</span><br><span class="line"></span><br><span class="line">check process xxxx with matching xxxx</span><br><span class="line">	start program = <span class="string">&quot;/etc/init.d/xxxx start&quot;</span></span><br><span class="line">	stop program = <span class="string">&quot;/etc/init.d/xxxx stop&quot;</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> 10 restarts within 10 cycles <span class="keyword">then</span> unmonitor</span><br><span class="line"></span><br><span class="line"><span class="comment"># 创建非标准应用监控</span></span><br><span class="line">vim logic_service.j2</span><br><span class="line"></span><br><span class="line">check process &#123;&#123; service_name &#125;&#125; with pidfile &#123;&#123; root_dir &#125;&#125;/&#123;&#123; service_name &#125;&#125;/deploy/&#123;&#123; monit_name &#125;&#125;.pid</span><br><span class="line">    start program = <span class="string">&quot;/bin/bash -c &#x27;cd &#123;&#123; root_dir &#125;&#125;/&#123;&#123; service_name &#125;&#125;/deploy &amp;&amp; ./start.sh &amp;&gt;start.log &#x27;&quot;</span></span><br><span class="line">    stop program = <span class="string">&quot;/bin/bash -c &#x27;cd &#123;&#123; root_dir &#125;&#125;/&#123;&#123; service_name &#125;&#125;/deploy &amp;&amp; ./stop.sh &amp;&gt;stop.log &#x27;&quot;</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> 5 restarts within 15 cycles <span class="keyword">then</span> unmonitor</span><br><span class="line">    &#123;% <span class="keyword">if</span> memory_usage is defined %&#125;</span><br><span class="line">    <span class="keyword">if</span> total memory usage &gt; &#123;&#123; memory_usage &#125;&#125; <span class="keyword">for</span> 10 cycles <span class="keyword">then</span> restart</span><br><span class="line">    &#123;% endif %&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="参考文章"><a href="#参考文章" class="headerlink" title="参考文章"></a>参考文章</h2><p><a target="_blank" rel="noopener" href="https://mmonit.com/monit/documentation/monit.html">Monit Document</a></p>
<p><a target="_blank" rel="noopener" href="https://github.com/freeaquar/notebook/blob/master/%E8%BF%90%E7%BB%B4%E7%9B%B8%E5%85%B3/Monit-%E7%AC%94%E8%AE%B0.md">Monit 笔记</a></p>
<p><a target="_blank" rel="noopener" href="https://blog.csdn.net/u010039418/article/details/83784195">Docker容器内多进程管理——supervisor VS monit</a></p>
  
	</div>
		<footer class="article-footer clearfix">
<div class="article-catetags">

<div class="article-categories">
  <span></span>
  <a class="article-category-link" href="/categories/%E5%AD%A6%E4%B9%A0-Study/">学习 | Study</a>
</div>


</div>



	<div class="article-share" id="share">
	
	  <div data-url="https://wsgzao.github.io/post/monit/" data-title="使用Monit替代Supervisor自动化管理和监控服务小结 | HelloDog" data-tsina="" class="share clearfix">
	  </div>
	
	</div>


</footer>

   	       
	</article>
	
<nav class="article-nav clearfix">
 
 <div class="prev" >
 <a href="/post/vscode/" title="Visual Studio Code使用小结">
  <strong>上一篇：</strong><br/>
  <span>
  Visual Studio Code使用小结</span>
</a>
</div>


<div class="next">
<a href="/post/yaml/"  title="YAML入门教程">
 <strong>下一篇：</strong><br/> 
 <span>YAML入门教程
</span>
</a>
</div>

</nav>

	

<section id="comments" class="comment">
  <div id="disqus_thread">
    <noscript>Please enable JavaScript to view the <a target="_blank" rel="noopener" href="//disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
  </div>
</section>



</div>  
      <div class="openaside"><a class="navbutton" href="#" title="显示侧边栏"></a></div>

  <div id="toc" class="toc-aside">
  <strong class="toc-title">文章目录</strong>
 
 <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%89%8D%E8%A8%80"><span class="toc-number">1.</span> <span class="toc-text">前言</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%9B%B4%E6%96%B0%E5%8E%86%E5%8F%B2"><span class="toc-number">2.</span> <span class="toc-text">更新历史</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Monit%E4%BB%8B%E7%BB%8D"><span class="toc-number">3.</span> <span class="toc-text">Monit介绍</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Supervisor%E4%BB%8B%E7%BB%8D"><span class="toc-number">4.</span> <span class="toc-text">Supervisor介绍</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Supervisor-A-Process-Control-System"><span class="toc-number"></span> <span class="toc-text">Supervisor: A Process Control System</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#Monit-VS-Supervisor"><span class="toc-number">1.</span> <span class="toc-text">Monit VS Supervisor</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Monit%E6%98%AF%E4%BB%80%E4%B9%88"><span class="toc-number">1.1.</span> <span class="toc-text">Monit是什么</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%BA%E4%BB%80%E4%B9%88%E9%80%89%E6%8B%A9Monit"><span class="toc-number">1.2.</span> <span class="toc-text">为什么选择Monit</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Supervisor%E4%BC%98%E7%BC%BA%E7%82%B9"><span class="toc-number">1.3.</span> <span class="toc-text">Supervisor优缺点</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Monit%E4%BC%98%E7%BC%BA%E7%82%B9"><span class="toc-number">1.4.</span> <span class="toc-text">Monit优缺点</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Monit%E5%9F%BA%E6%9C%AC%E7%94%A8%E6%B3%95"><span class="toc-number">2.</span> <span class="toc-text">Monit基本用法</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Monit%E5%B8%B8%E7%94%A8%E5%91%BD%E4%BB%A4"><span class="toc-number">2.1.</span> <span class="toc-text">Monit常用命令</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Monit%E6%9C%8D%E5%8A%A1%E7%9B%91%E6%8E%A7%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6%E6%A0%BC%E5%BC%8F"><span class="toc-number">2.2.</span> <span class="toc-text">Monit服务监控配置文件格式</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Monit%E9%85%8D%E7%BD%AE%E5%AE%9E%E8%B7%B5"><span class="toc-number">3.</span> <span class="toc-text">Monit配置实践</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%8F%82%E8%80%83%E6%96%87%E7%AB%A0"><span class="toc-number">4.</span> <span class="toc-text">参考文章</span></a></li></ol>
 
  </div>

<div id="asidepart">
<div class="closeaside"><a class="closebutton" href="#" title="隐藏侧边栏"></a></div>
<aside class="clearfix">

  
<div class="github-card">
<p class="asidetitle">Github 名片</p>
<div class="github-card" data-github="wsgzao" data-theme="medium"></div>
<script type="text/javascript" src="//lab.lepture.com/github-cards/widget.js" ></script>
</div>



  
<div class="categorieslist">
	<p class="asidetitle">分类</p>
		<ul>
		
		  
			<li><a href="/categories/Hexo/" title="Hexo">Hexo<sup>6</sup></a></li>
		  
		
		  
			<li><a href="/categories/学习-Study/" title="学习 | Study">学习 | Study<sup>191</sup></a></li>
		  
		
		  
			<li><a href="/categories/生活-Life/" title="生活 | Life">生活 | Life<sup>26</sup></a></li>
		  
		
		  
			<li><a href="/categories/软件-Soft/" title="软件 | Soft">软件 | Soft<sup>5</sup></a></li>
		  
		
		</ul>
</div>


  <div class="linkslist">
  <p class="asidetitle">友情链接</p>
    <ul>
        
          <li>
            
            	<a href="http://wuchong.me" target="_blank" title="Jark&#39;s Blog">Jark&#39;s Blog</a>
            
          </li>
        
          <li>
            
            	<a href="https://www.linkedin.com/in/aowang" target="_blank" title="LinkedIn">LinkedIn</a>
            
          </li>
        
    </ul>
</div>

  <div class="rsspart">
	<a href="/atom.xml" target="_blank" title="rss">RSS 订阅</a>
</div>

</aside>
</div>
    </div>
    <footer><div id="footer" >
	
	<div class="line">
		<span></span>
		<div class="author"></div>
	</div>
	
	
	<section class="info">
		<p> Hello, I&#39;m OX. This is my blog on GitHub. <br/>
			Keep Calm and Carry On.</p>
	</section>
	 
	<div class="social-font" class="clearfix">
		
		
		<a href="https://github.com/wsgzao" target="_blank" class="icon-github" title="github"></a>
		
		
		
		
		
		<a href="https://www.linkedin.com/in/aowang" target="_blank" class="icon-linkedin" title="linkedin"></a>
		
		
		
		
		
	</div>
			
		

		<p class="copyright">
		Powered by <a href="http://hexo.io" target="_blank" title="hexo">hexo</a> and Theme by <a href="https://github.com/wuchong/jacman" target="_blank" title="Jacman">Jacman</a> © 2023 
		
		<a href="/about" target="_blank" title="wsgzao">wsgzao</a>
		
		
		</p>
</div>
</footer>
    <script src="/js/jquery-2.0.3.min.js"></script>
<script src="/js/jquery.imagesloaded.min.js"></script>
<script src="/js/gallery.js"></script>
<script src="/js/jquery.qrcode-0.12.0.min.js"></script>

<script type="text/javascript">
$(document).ready(function(){ 
  $('.navbar').click(function(){
    $('header nav').toggleClass('shownav');
  });
  var myWidth = 0;
  function getSize(){
    if( typeof( window.innerWidth ) == 'number' ) {
      myWidth = window.innerWidth;
    } else if( document.documentElement && document.documentElement.clientWidth) {
      myWidth = document.documentElement.clientWidth;
    };
  };
  var m = $('#main'),
      a = $('#asidepart'),
      c = $('.closeaside'),
      o = $('.openaside');
  c.click(function(){
    a.addClass('fadeOut').css('display', 'none');
    o.css('display', 'block').addClass('fadeIn');
    m.addClass('moveMain');
  });
  o.click(function(){
    o.css('display', 'none').removeClass('beforeFadeIn');
    a.css('display', 'block').removeClass('fadeOut').addClass('fadeIn');      
    m.removeClass('moveMain');
  });
  $(window).scroll(function(){
    o.css("top",Math.max(80,260-$(this).scrollTop()));
  });
  
        getSize();
        if (myWidth >= 1024) {
          c.click();
        }
  
  $(window).resize(function(){
    getSize(); 
    if (myWidth >= 1024) {
      $('header nav').removeClass('shownav');
    }else{
      m.removeClass('moveMain');
      a.css('display', 'block').removeClass('fadeOut');
      o.css('display', 'none');
      
      $('#toc.toc-aside').css('display', 'none');
        
    }
  });
});
</script>

<script type="text/javascript">
$(document).ready(function(){ 
  var ai = $('.article-content>iframe'),
      ae = $('.article-content>embed'),
      t  = $('#toc'),
      ta = $('#toc.toc-aside'),
      o  = $('.openaside'),
      c  = $('.closeaside');
  if(ai.length>0){
    ai.wrap('<div class="video-container" />');
  };
  if(ae.length>0){
   ae.wrap('<div class="video-container" />');
  };
  c.click(function(){
    ta.css('display', 'block').addClass('fadeIn');
  });
  o.click(function(){
    ta.css('display', 'none');
  });
  $(window).scroll(function(){
    ta.css("top",Math.max(140,320-$(this).scrollTop()));
  });
});
</script>


<script type="text/javascript">
$(document).ready(function(){ 
  var $this = $('.share'),
      url = $this.attr('data-url'),
      encodedUrl = encodeURIComponent(url),
      title = $this.attr('data-title'),
      tsina = $this.attr('data-tsina'),
      description = $this.attr('description');
  var html = [
  '<div class="hoverqrcode clearfix"></div>',
  '<a class="overlay" id="qrcode"></a>',
  '<a href="https://www.facebook.com/sharer.php?u=' + encodedUrl + '" class="article-share-facebook" target="_blank" title="Facebook"></a>',
  '<a href="https://twitter.com/intent/tweet?url=' + encodedUrl + '" class="article-share-twitter" target="_blank" title="Twitter"></a>',
  '<a href="#qrcode" class="article-share-qrcode" title="微信"></a>',
  '<a href="http://widget.renren.com/dialog/share?resourceUrl=' + encodedUrl + '&srcUrl=' + encodedUrl + '&title=' + title +'" class="article-share-renren" target="_blank" title="人人"></a>',
  '<a href="http://service.weibo.com/share/share.php?title='+title+'&url='+encodedUrl +'&ralateUid='+ tsina +'&searchPic=true&style=number' +'" class="article-share-weibo" target="_blank" title="微博"></a>',
  '<span title="Share to"></span>'
  ].join('');
  $this.append(html);

  $('.hoverqrcode').hide();

  var myWidth = 0;
  function updatehoverqrcode(){
    if( typeof( window.innerWidth ) == 'number' ) {
      myWidth = window.innerWidth;
    } else if( document.documentElement && document.documentElement.clientWidth) {
      myWidth = document.documentElement.clientWidth;
    };
    var qrsize = myWidth > 1024 ? 200:100;
    var options = {render: 'image', size: qrsize, fill: '#2ca6cb', text: url, radius: 0.5, quiet: 1};
    var p = $('.article-share-qrcode').position();
    $('.hoverqrcode').empty().css('width', qrsize).css('height', qrsize)
                          .css('left', p.left-qrsize/2+20).css('top', p.top-qrsize-10)
                          .qrcode(options);
  };
  $(window).resize(function(){
    $('.hoverqrcode').hide();
  });
  $('.article-share-qrcode').click(function(){
    updatehoverqrcode();
    $('.hoverqrcode').toggle();
  });
  $('.article-share-qrcode').hover(function(){}, function(){
      $('.hoverqrcode').hide();
  });
});   
</script>




<script type="text/javascript">

var disqus_shortname = 'wsgzao';

(function(){
  var dsq = document.createElement('script');
  dsq.type = 'text/javascript';
  dsq.async = true;
  dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
  (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
}());
(function(){
  var dsq = document.createElement('script');
  dsq.type = 'text/javascript';
  dsq.async = true;
  dsq.src = '//' + disqus_shortname + '.disqus.com/count.js';
  (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
}());
</script>








<link rel="stylesheet" href="/fancybox/jquery.fancybox.css" media="screen" type="text/css">
<script src="/fancybox/jquery.fancybox.pack.js"></script>
<script type="text/javascript">
$(document).ready(function(){ 
  $('.article-content').each(function(i){
    $(this).find('img').each(function(){
      if ($(this).parent().hasClass('fancybox')) return;
      var alt = this.alt;
      if (alt) $(this).after('<span class="caption">' + alt + '</span>');
      $(this).wrap('<a href="' + this.src + '" title="' + alt + '" class="fancybox"></a>');
    });
    $(this).find('.fancybox').each(function(){
      $(this).attr('rel', 'article' + i);
    });
  });
  if($.fancybox){
    $('.fancybox').fancybox();
  }
}); 
</script>



<!-- Analytics Begin -->

<script type="text/javascript">
(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','//www.google-analytics.com/analytics.js','ga');
ga('create', 'UA-77732745-1', 'wsgzao.github.io');  
ga('send', 'pageview');
</script>



<script>
var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = "//hm.baidu.com/hm.js?c2c5fc7d844d0973d9f77abd87f49c3c";
  var s = document.getElementsByTagName("script")[0]; 
  s.parentNode.insertBefore(hm, s);
})();
</script>



<!-- Analytics End -->

<!-- Totop Begin -->

	<div id="totop">
	<a title="返回顶部"><img src="/img/scrollup.png"/></a>
	</div>
	<script src="/js/totop.js"></script>

<!-- Totop End -->

<!-- MathJax Begin -->
<!-- mathjax config similar to math.stackexchange -->


<!-- MathJax End -->

<!-- swiftype Begin -->

<script type="text/javascript">
  (function(w,d,t,u,n,s,e){w['SwiftypeObject']=n;w[n]=w[n]||function(){
  (w[n].q=w[n].q||[]).push(arguments);};s=d.createElement(t);
  e=d.getElementsByTagName(t)[0];s.async=1;s.src=u;e.parentNode.insertBefore(s,e);
  })(window,document,'script','//s.swiftypecdn.com/install/v2/st.js','_st');

  _st('install','_4qDmKrBPn9Es3UvQHT4','2.0.0');
</script>

<!-- swiftype End -->

  </body>
</html>
