
 <!DOCTYPE HTML>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <script type="text/javascript">
    var host = "wsgzao.github.io";
    if ((host == window.location.host) && (window.location.protocol != "https:"))
        window.location.protocol = "https";
  </script> 
<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-LJ3PMGPVCK"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-LJ3PMGPVCK');
</script>
  
    <title>netperf和iperf网络性能测试小结 | HelloDog</title>
    <meta name="viewport" content="width=device-width, initial-scale=1,user-scalable=no">
    
    <meta name="author" content="wsgzao">
    

    
    <meta name="description" content="netperf和iperf网络性能测试小结">
<meta property="og:type" content="article">
<meta property="og:title" content="netperf和iperf网络性能测试小结">
<meta property="og:url" content="https://wsgzao.github.io/post/netperf/index.html">
<meta property="og:site_name" content="HelloDog">
<meta property="og:description" content="netperf和iperf网络性能测试小结">
<meta property="og:locale" content="zh_CN">
<meta property="article:published_time" content="2019-06-27T06:59:49.000Z">
<meta property="article:modified_time" content="2023-02-27T05:33:06.000Z">
<meta property="article:author" content="wsgzao">
<meta name="twitter:card" content="summary">

    
    <link rel="alternative" href="/atom.xml" title="HelloDog" type="application/atom+xml">
    
    
    <link rel="icon" href="/img/favicon.ico">
    
    
    <link rel="apple-touch-icon" href="/img/jacman.jpg">
    <link rel="apple-touch-icon-precomposed" href="/img/jacman.jpg">
    
    
<link rel="stylesheet" href="/css/style.css">

<meta name="generator" content="Hexo 6.3.0"></head>

  <body>
    <header>
      
<div>
		
			<div id="imglogo">
				<a href="/"><img src="/img/logo.png" alt="HelloDog" title="HelloDog"/></a>
			</div>
			
			<div id="textlogo">
				<h1 class="site-name"><a href="/" title="HelloDog">HelloDog</a></h1>
				<h2 class="blog-motto">Keep Calm and Carry On</h2>
			</div>
			<div class="navbar"><a class="navbutton navmobile" href="#" title="菜单">
			</a></div>
			<nav class="animated">
				<ul>
					<ul>
					 
						<li><a href="/">主页 | Home</a></li>
					
						<li><a href="/index/">索引 | Index</a></li>
					
						<li><a href="/archives/">归档 | Archives</a></li>
					
						<li><a href="/about/">简介 | About</a></li>
					
					<li>
 					
						<form class="search">
							<label>Search</label>
						<input type="text" id="search" class="st-default-search-input" name="q" size="30" placeholder="搜索"><br>
						</form>
					
					</li>
				</ul>
			</nav>			
</div>
    </header>
    <div id="container">
      <div id="main" class="post" itemscope itemprop="blogPost">
  
	<article itemprop="articleBody"> 
		<header class="article-info clearfix">
  <h1 itemprop="name">
    
      <a href="/post/netperf/" title="netperf和iperf网络性能测试小结" itemprop="url">netperf和iperf网络性能测试小结</a>
  </h1>
  <p class="article-author">By
       
		<a href="/about" title="wsgzao" target="_blank" itemprop="author">wsgzao</a>
		
  <p class="article-time">
    <time datetime="2019-06-27T06:59:49.000Z" itemprop="datePublished"> 发表于 2019-06-27</time>
    
  </p>
</header>
	<div class="article-content">
<!-- 		
		<div id="toc" class="toc-article">
			<strong class="toc-title">文章目录</strong>
		
			<ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%89%8D%E8%A8%80"><span class="toc-number">1.</span> <span class="toc-text">前言</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%9B%B4%E6%96%B0%E5%8E%86%E5%8F%B2"><span class="toc-number">2.</span> <span class="toc-text">更新历史</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%BD%91%E7%BB%9C%E6%80%A7%E8%83%BD%E6%B5%8B%E9%87%8F%E7%9A%84%E4%BA%94%E9%A1%B9%E6%8C%87%E6%A0%87"><span class="toc-number">3.</span> <span class="toc-text">网络性能测量的五项指标</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8F%AF%E7%94%A8%E6%80%A7"><span class="toc-number">3.1.</span> <span class="toc-text">可用性</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%93%8D%E5%BA%94%E6%97%B6%E9%97%B4"><span class="toc-number">3.2.</span> <span class="toc-text">响应时间</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%BD%91%E7%BB%9C%E5%88%A9%E7%94%A8%E7%8E%87"><span class="toc-number">3.3.</span> <span class="toc-text">网络利用率</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%BD%91%E7%BB%9C%E5%90%9E%E5%90%90%E9%87%8F"><span class="toc-number">3.4.</span> <span class="toc-text">网络吞吐量</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%BD%91%E7%BB%9C%E5%B8%A6%E5%AE%BD%E5%AE%B9%E9%87%8F"><span class="toc-number">3.5.</span> <span class="toc-text">网络带宽容量</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%94%B6%E9%9B%86%E7%BD%91%E7%BB%9C%E6%80%A7%E8%83%BD%E6%95%B0%E6%8D%AE%E7%9A%84%E6%96%B9%E5%BC%8F"><span class="toc-number">3.6.</span> <span class="toc-text">收集网络性能数据的方式</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Netperf"><span class="toc-number">4.</span> <span class="toc-text">Netperf</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#iperf"><span class="toc-number">5.</span> <span class="toc-text">iperf</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AE%9E%E4%BE%8B"><span class="toc-number">5.1.</span> <span class="toc-text">实例</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Netperf-%E6%B5%8B%E8%AF%95%E5%AE%9E%E8%B7%B5"><span class="toc-number">6.</span> <span class="toc-text">Netperf 测试实践</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%8F%82%E8%80%83%E6%96%87%E7%AB%A0"><span class="toc-number">7.</span> <span class="toc-text">参考文章</span></a></li></ol>
		
		</div>
		 -->
		<h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>为了解决LVS ksoftirqd CPU使用率100%软中断导致网卡丢包的问题，我们使用netperf来测试网络性能，目的是尽可能复现问题，在研究的过程中顺便记录自己使用netperf的过程，除了netperf之外还可以使用iperf作为TCP&#x2F;UDP压力测试工具。</p>
<blockquote>
<p>netperf和iperf网络性能测试小结</p>
</blockquote>
<h2 id="更新历史"><a href="#更新历史" class="headerlink" title="更新历史"></a>更新历史</h2><p>2019年06月27日 - 初稿</p>
<p>阅读原文 - <a href="https://wsgzao.github.io/post/netperf/">https://wsgzao.github.io/post/netperf/</a></p>
<p><strong>扩展阅读</strong></p>
<p>netperf - <a target="_blank" rel="noopener" href="https://github.com/HewlettPackard/netperf">https://github.com/HewlettPackard/netperf</a><br>iperf - <a target="_blank" rel="noopener" href="https://github.com/esnet/iperf">https://github.com/esnet/iperf</a></p>
<hr>
<h2 id="网络性能测量的五项指标"><a href="#网络性能测量的五项指标" class="headerlink" title="网络性能测量的五项指标"></a>网络性能测量的五项指标</h2><p>可用性（availability）<br>响应时间（response time）<br>网络利用率（network utilization）<br>网络吞吐量（network throughput）<br>网络带宽容量（network bandwidth capacity）</p>
<h3 id="可用性"><a href="#可用性" class="headerlink" title="可用性"></a>可用性</h3><p>测试网络性能的第一步是确定网络是否正常工作，最简单的方法是使用 ping 命令。通过向远端的机器发送 icmp echo request，并等待接收 icmp echo reply 来判断远端的机器是否连通，网络是否正常工作。</p>
<p>Ping 命令有非常丰富的命令选项，比如 -c 可以指定发送 echo request 的个数，-s 可以指定每次发送的 ping 包大小。</p>
<p>网络设备内部一般有多个缓冲池，不同的缓冲池使用不同的缓冲区大小，分别用来处理不同大小的分组（packet）。例如交换机中通常具有三种类型的包缓冲：一类针对小的分组，一类针对中等大小的分组，还有一类针对大的分组。为了测试这样的网络设备，测试工具必须要具有发送不同大小分组的能力。Ping 命令的 -s 就可以使用在这种场合。</p>
<h3 id="响应时间"><a href="#响应时间" class="headerlink" title="响应时间"></a>响应时间</h3><p>Ping 命令的 echo request&#x2F;reply 一次往返所花费时间就是响应时间。有很多因素会影响到响应时间，如网段的负荷，网络主机的负荷，广播风暴，工作不正常的网络设备等等。</p>
<p>在网络工作正常时，记录下正常的响应时间。当用户抱怨网络的反应时间慢时，就可以将现在的响应时间与正常的响应时间对比，如果两者差值的波动很大，就能说明网络设备存在故障。</p>
<h3 id="网络利用率"><a href="#网络利用率" class="headerlink" title="网络利用率"></a>网络利用率</h3><p>网络利用率是指网络被使用的时间占总时间（即被使用的时间 + 空闲的时间）的比例。比如，Ethernet 虽然是共享的，但同时却只能有一个报文在传输。因此在任一时刻，Ethernet 或者是 100% 的利用率，或者是 0% 的利用率。</p>
<p>计算一个网段的网络利用率相对比较容易，但是确定一个网络的利用率就比较复杂。因此，网络测试工具一般使用网络吞吐量和网络带宽容量来确定网络中两个节点之间的性能。</p>
<h3 id="网络吞吐量"><a href="#网络吞吐量" class="headerlink" title="网络吞吐量"></a>网络吞吐量</h3><p>网络吞吐量是指在某个时刻，在网络中的两个节点之间，提供给网络应用的剩余带宽。</p>
<p>网络吞吐量可以帮助寻找网络路径中的瓶颈。比如，即使 client 和 server 都被分别连接到各自的 100M Ethernet 上，但是如果这两个 100M 的 Ethernet 被 10M 的 Ethernet 连接起来，那么 10M 的 Ethernet 就是网络的瓶颈。</p>
<p>网络吞吐量非常依赖于当前的网络负载情况。因此，为了得到正确的网络吞吐量，最好在不同时间（一天中的不同时刻，或者一周中不同的天）分别进行测试，只有这样才能得到对网络吞吐量的全面认识。</p>
<p>有些网络应用程序在开发过程的测试中能够正常运行，但是到实际的网络环境中却无法正常工作（由于没有足够的网络吞吐量）。这是因为测试只是在空闲的网络环境中，没有考虑到实际的网络环境中还存在着其它的各种网络流量。所以，网络吞吐量定义为剩余带宽是有实际意义的。</p>
<h3 id="网络带宽容量"><a href="#网络带宽容量" class="headerlink" title="网络带宽容量"></a>网络带宽容量</h3><p>与网络吞吐量不同，网络带宽容量指的是在网络的两个节点之间的最大可用带宽。这是由组成网络的设备的能力所决定的。</p>
<p>测试网络带宽容量有两个困难之处：在网络存在其它网络流量的时候，如何得知网络的最大可用带宽；在测试过程中，如何对现有的网络流量不造成影响。网络测试工具一般采用 packet pairs 和 packet trains 技术来克服这样的困难。</p>
<h3 id="收集网络性能数据的方式"><a href="#收集网络性能数据的方式" class="headerlink" title="收集网络性能数据的方式"></a>收集网络性能数据的方式</h3><p>当确定了网络性能的测试指标以后，就需要使用网络测试工具收集相应的性能数据，分别有三种从网络获取数据的方式：</p>
<ol>
<li>通过 snmp 协议直接到网络设备中获取，如 net-snmp 工具</li>
<li>侦听相关的网络性能数据，典型的工具是 tcpdump</li>
<li>自行产生相应的测试数据，即本文中介绍的 iperf、netperf 等工具</li>
</ol>
<h2 id="Netperf"><a href="#Netperf" class="headerlink" title="Netperf"></a>Netperf</h2><p>Netperf 是一种网络性能的测量工具，主要针对基于 TCP 或 UDP 的传输。Netperf 根据应用的不同，可以进行不同模式的网络性能测试，即批量数据传输（bulk data transfer）模式和请求 &#x2F; 应答（request&#x2F;reponse）模式。</p>
<table>
<thead>
<tr>
<th>参数</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td>-H host</td>
<td>指定远端运行 netserver 的 server IP 地址</td>
</tr>
<tr>
<td>-l testlen</td>
<td>指定测试的时间长度 (秒)</td>
</tr>
<tr>
<td>-t testname</td>
<td>指定进行的测试类型 (TCP_STREAM，UDP_STREAM，TCP_RR，TCP_CRR，UDP_RR)</td>
</tr>
</tbody></table>
<p>可选参数有如下几个：</p>
<table>
<thead>
<tr>
<th>参数</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td>-s size</td>
<td>设置本地系统的 socket 发送与接收缓冲大小</td>
</tr>
<tr>
<td>-S size</td>
<td>设置远端系统的 socket 发送与接收缓冲大小</td>
</tr>
<tr>
<td>-m size</td>
<td>设置本地系统发送测试分组的大小</td>
</tr>
<tr>
<td>-M size</td>
<td>设置远端系统接收测试分组的大小</td>
</tr>
<tr>
<td>-D</td>
<td>对本地与远端系统的 socket 设置 TCP_NODELAY 选项</td>
</tr>
<tr>
<td>-r req,resp</td>
<td>设置 request 和 reponse 分组的大小</td>
</tr>
</tbody></table>
<p><strong>实例：</strong></p>
<p>服务器端：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">#./netserver</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>客户端：</p>
<p><strong>1、批量 (bulk) 网络流量的性能</strong></p>
<p><strong>1）TCP_STREAM</strong></p>
<p>Netperf 缺省情况下进行 TCP 批量传输，即 - t TCP_STREAM。测试过程中，netperf 向 netserver 发送批量的 TCP 数据分组，以确定数据传输过程中的吞吐量：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">#./netperf -H 192.168.0.28 -l 60</span><br><span class="line">TCP STREAM TEST to 192.168.0.28</span><br><span class="line">Recv   Send    Send</span><br><span class="line">Socket Socket  Message  Elapsed</span><br><span class="line">Size   Size    Size     Time     Throughput</span><br><span class="line">bytes  bytes   bytes    secs.    10^6bits/sec</span><br><span class="line">87380  16384  16384    60.00      88.00</span><br></pre></td></tr></table></figure>

<p>从 netperf 的结果输出中，我们可以知道以下的一些信息：</p>
<ol>
<li>远端系统（即 server）使用大小为 87380 字节的 socket 接收缓冲</li>
<li>本地系统（即 client）使用大小为 16384 字节的 socket 发送缓冲</li>
<li>向远端系统发送的测试分组大小为 16384 字节</li>
<li>测试经历的时间为 60 秒</li>
<li>吞吐量的测试结果表明，TCP 带宽为 88Mbits &#x2F; 秒</li>
</ol>
<p>通过修改可选参数，并观察结果的变化，我们可以确定是什么因素影响了连接的吞吐量。例如，如果怀疑路由器由于缺乏足够的缓冲区空间，使得转发大的分组时存在问题，就可以增加测试分组（-m）的大小，以观察吞吐量的变化：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">#./netperf -H 192.168.0.28 -l 60 -- -m 2048</span><br><span class="line">TCP STREAM TEST to 192.168.0.28</span><br><span class="line">Recv   Send    Send</span><br><span class="line">Socket Socket  Message  Elapsed</span><br><span class="line">Size   Size    Size     Time     Throughput</span><br><span class="line">bytes  bytes   bytes    secs.    10^6bits/sec</span><br><span class="line">87380  16384   2048    60.00      87.62</span><br></pre></td></tr></table></figure>

<p>在这里，测试分组的大小减少到 2048 字节，而吞吐量却没有很大的变化（与前面例子中测试分组大小为 16K 字节相比）。相反，如果吞吐量有了较大的提升，则说明在网络中间的路由器确实存在缓冲区的问题。</p>
<p><strong>2）UDP_STREAM</strong></p>
<p>UDP_STREAM 用来测试进行 UDP 批量传输时的网络性能。需要特别注意的是，此时测试分组的大小不得大于 socket 的发送与接收缓冲大小，否则 netperf 会报出错提示：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">#./netperf -t UDP_STREAM -H 192.168.0.28 -l 60</span><br><span class="line">UDP UNIDIRECTIONAL SEND TEST to 192.168.0.28</span><br><span class="line">udp_send: data send error: Message too long</span><br></pre></td></tr></table></figure>

<p>为了避免这样的情况，可以通过命令行参数限定测试分组的大小，或者增加 socket 的发送 &#x2F; 接收缓冲大小。UDP_STREAM 方式使用与 TCP_STREAM 方式相同的局部命令行参数，因此，这里可以使用 - m 来修改测试中使用分组的大小：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">#./netperf -t UDP_STREAM -H 192.168.0.28 -- -m 1024</span><br><span class="line">UDP UNIDIRECTIONAL SEND TEST to 192.168.0.28</span><br><span class="line">Socket  Message  Elapsed      Messages</span><br><span class="line">Size    Size     Time         Okay Errors   Throughput</span><br><span class="line">bytes   bytes    secs            #      #   10^6bits/sec</span><br><span class="line">65535    1024    9.99        114127     0      93.55</span><br><span class="line">65535             9.99        114122            93.54</span><br></pre></td></tr></table></figure>

<p>UDP_STREAM 方式的结果中有两行测试数据<br>第一行显示的是本地系统的发送统计，这里的吞吐量表示 netperf 向本地 socket 发送分组的能力。但是，我们知道，UDP 是不可靠的传输协议，发送出去的分组数量不一定等于接收到的分组数量。</p>
<p>第二行显示的就是远端系统接收的情况，由于 client 与 server 直接连接在一起，而且网络中没有其它的流量，所以本地系统发送过去的分组几乎都被远端系统正确的接收了，远端系统的吞吐量也几乎等于本地系统的发送吞吐量。但是，在实际环境中，一般远端系统的 socket 缓冲大小不同于本地系统的 socket 缓冲区大小，而且由于 UDP 协议的不可靠性，远端系统的接收吞吐量要远远小于发送出去的吞吐量。</p>
<p><strong>2、请求 &#x2F; 应答 (request&#x2F;response) 网络流量的性能</strong></p>
<p>另一类常见的网络流量类型是应用在 client&#x2F;server 结构中的 request&#x2F;response 模式。在每次交易（transaction）中，client 向 server 发出小的查询分组，server 接收到请求，经处理后返回大的结果数据。</p>
<p><strong>1） TCP_RR</strong></p>
<p>TCP_RR 方式的测试对象是多次 TCP request 和 response 的交易过程，但是它们发生在同一个 TCP 连接中，这种模式常常出现在数据库应用中。数据库的 client 程序与 server 程序建立一个 TCP 连接以后，就在这个连接中传送数据库的多次交易过程。 用户可以通过 - r 参数来改变 request 和 response 分组的大小，进行更有实际意义的测试：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">#./netperf -t TCP_RR -H 192.168.0.28 -- -r 32,1024</span><br><span class="line">TCP REQUEST/RESPONSE TEST to 192.168.0.28</span><br><span class="line">Local /Remote</span><br><span class="line">Socket Size   Request  Resp.   Elapsed  Trans.</span><br><span class="line">Send   Recv   Size     Size    Time     Rate</span><br><span class="line">bytes  Bytes  bytes    bytes   secs.    per sec</span><br><span class="line">16384  87380  32       1024    10.00    4945.97</span><br><span class="line">16384  87380</span><br></pre></td></tr></table></figure>

<p>从结果中可以看出，增加 request&#x2F;reponse 分组的大小，会导致交易率明显的下降。<br>注：相对于实际的系统，这里交易率的计算没有充分考虑到交易过程中的应用程序处理时延，因此结果往往会高于实际情况</p>
<p><strong>2） TCP_CRR</strong></p>
<p>与 TCP_RR 不同，TCP_CRR 为每次交易建立一个新的 TCP 连接。最典型的应用就是 HTTP，每次 HTTP 交易是在一条单独的 TCP 连接中进行的。因此，由于需要不停地建立新的 TCP 连接，并且在交易结束后拆除 TCP 连接，交易率一定会受到很大的影响。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">#./netperf -t TCP_CRR -H 192.168.0.28</span><br><span class="line">TCP Connect/Request/Response TEST to 192.168.0.28</span><br><span class="line">Local /Remote</span><br><span class="line">Socket Size   Request  Resp.   Elapsed  Trans.</span><br><span class="line">Send   Recv   Size     Size    Time     Rate</span><br><span class="line">bytes  Bytes  bytes    bytes   secs.    per sec</span><br><span class="line">131070 131070 1        1       9.99     2662.20</span><br><span class="line">16384  87380</span><br></pre></td></tr></table></figure>

<p>即使是使用一个字节的 request&#x2F;response 分组，交易率也明显的降低了，只有 2662.20 次 &#x2F; 秒。</p>
<p><strong>3） UDP_RR</strong></p>
<p>UDP_RR 方式使用 UDP 分组进行 request&#x2F;response 的交易过程。由于没有 TCP 连接所带来的负担，所以我们推测交易率一定会有相应的提升。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">#./netperf -t UDP_RR -H 192.168.0.28</span><br><span class="line">UDP REQUEST/RESPONSE TEST to 192.168.0.28</span><br><span class="line">Local /Remote</span><br><span class="line">Socket Size   Request  Resp.   Elapsed  Trans.</span><br><span class="line">Send   Recv   Size     Size    Time     Rate</span><br><span class="line">bytes  Bytes  bytes    bytes   secs.    per sec</span><br><span class="line">65535  65535  1        1       9.99     10141.16</span><br><span class="line">65535  65535</span><br></pre></td></tr></table></figure>

<p>结果证实了我们的推测，交易率为 10141.16 次 &#x2F; 秒，高过 TCP_RR 的数值。不过，如果出现了相反的结果，即交易率反而降低了，也不需要担心，因为这说明了在网络中，路由器或其它的网络设备对 UDP 采用了与 TCP 不同的缓冲区空间和处理技术。</p>
<h2 id="iperf"><a href="#iperf" class="headerlink" title="iperf"></a>iperf</h2><p>iperf 是一个网络性能测试工具。iperf 可以测试最大 TCP 和 UDP 带宽性能，具有多种参数和 UDP 特性，可以根据需要调整，可以报告带宽、延迟抖动和数据包丢失。<br>0<br><strong>客户端与服务器共用选项</strong></p>
<table>
<thead>
<tr>
<th>命令行选项</th>
<th>描述</th>
</tr>
</thead>
<tbody><tr>
<td>-u</td>
<td>–udp：使用 UDP 方式而不是 TCP 方式。需要客户端与服务器端同时使用此参数。</td>
</tr>
<tr>
<td>-p</td>
<td>–port : 设置端口，与服务器端的监听端口一致。默认是 5001 端口。</td>
</tr>
<tr>
<td>-l</td>
<td>–len : 设置读写缓冲区的长度。TCP 方式默认为 8KB，UDP 方式默认为 1470 字节。</td>
</tr>
<tr>
<td>-w</td>
<td>–window : 设置套接字缓冲区为指定大小。对于 TCP 方式，此设置为 TCP 窗口大小。对于 UDP 方式，此设置为接受 UDP 数据包的缓冲区大小，限制可以接受数据包的最大值。</td>
</tr>
<tr>
<td>-m</td>
<td>–print_mss : 输出 TCP MSS 值（通过 TCP_MAXSEG 支持）。MSS 值一般比 MTU 值小 40 字节。通常情况</td>
</tr>
</tbody></table>
<p><strong>服务器端专用选项</strong></p>
<table>
<thead>
<tr>
<th>命令行选项</th>
<th>描述</th>
</tr>
</thead>
<tbody><tr>
<td>-s</td>
<td>–server : iperf 服务器模式</td>
</tr>
<tr>
<td>-c</td>
<td>–client host : 如果 iperf 运行在服务器模式，并且用 - c 参数指定一个主机，那么 iperf 将只接受指定主机的连接。此参数不能工作于 UDP 模式。</td>
</tr>
<tr>
<td>-P</td>
<td>–parallel： 服务器关闭之前保持的连接数。默认是 0，这意味着永远接受连接。</td>
</tr>
</tbody></table>
<p><strong>客户端端专用选项</strong></p>
<table>
<thead>
<tr>
<th>命令行选项</th>
<th>描述</th>
</tr>
</thead>
<tbody><tr>
<td>-c</td>
<td>–client host ： 运行 iperf 的客户端模式，连接到指定的 iperf 服务器端。</td>
</tr>
<tr>
<td>-b</td>
<td>–bandwidth ：UDP 模式使用的带宽，必须配合 - u 参数，默认值是 1 Mbit&#x2F;sec。</td>
</tr>
<tr>
<td>-d</td>
<td>–dualtest ： 运行双测试模式。这将使服务器端反向连接到客户端，使用 - L 参数中指定的端口（或默认使用客户端连接到服务器端的端口）。这些在操作的同时就立即完成了。如果你想要一个交互的测试，请尝试 - r 参数。</td>
</tr>
<tr>
<td>-r</td>
<td>–tradeoff ： 往复测试模式。当客户端到服务器端的测试结束时，服务器端通过 - l 选项指定的端口（或默认为客户端连接到服务器端的端口），反向连接至客户端。当客户端连接终止时，反向连接随即开始。如果需要同时进行双向测试，请尝试 - d 参数。</td>
</tr>
<tr>
<td>-L</td>
<td>–listenport ： 指指定服务端反向连接到客户端时使用的端口。默认使用客户端连接至服务端的端口。</td>
</tr>
<tr>
<td>-t</td>
<td>–time ： 设置传输的总时间。iperf 在指定的时间内，重复的发送指定长度的数据包。默认是 10 秒钟。</td>
</tr>
<tr>
<td>-P</td>
<td>–parallel： 线程数。指定客户端与服务端之间使用的线程数。默认是 1 线程。需要客户端与服务器端同时使用此参数。</td>
</tr>
</tbody></table>
<h3 id="实例"><a href="#实例" class="headerlink" title="实例"></a>实例</h3><p>带宽测试通常采用 UDP 模式，因为能测出极限带宽、时延抖动、丢包率。在进行测试时，首先以链路理论带宽作为数据发送速率进行测试，例如，从客户端到服务器之间的链路的理论带宽为 100Mbps，先用 - b 100M 进行测试，然后根据测试结果（包括实际带宽，时延抖动和丢包率），再以实际带宽作为数据发送速率进行测试，会发现时延抖动和丢包率比第一次好很多，重复测试几次，就能得出稳定的实际带宽。</p>
<p><strong>UDP 模式</strong></p>
<p>服务器端：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">iperf -u -s</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>客户端：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">/*在udp模式下，以100Mbps为数据发送速率，客户端到服务器192.168.1.1上传带宽测试，测试时间为60秒*/</span><br><span class="line">iperf -u -c 192.168.1.1 -b 100M -t 60</span><br><span class="line"></span><br><span class="line">/*客户端以5Mbps为数据发送速率,同时向服务器端发起30个连接线程*/</span><br><span class="line">iperf -u -c 192.168.1.1 -b 5M -P 30 -t 60</span><br><span class="line"></span><br><span class="line">/*以100M为数据发送速率，进行上下行带宽测试,-L参数指定本端双测试监听的端口*/</span><br><span class="line">iperf -u -c 192.168.1.1 -b 100M -d -t 60 -L 30000</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><strong>TCP 模式</strong></p>
<p>服务器端：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">iperf -s</span><br></pre></td></tr></table></figure>

<p>客户端：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">/*在tcp模式下，客户端到服务器192.168.1.1上传带宽测试，测试时间为60秒*/</span><br><span class="line">iperf -c 192.168.1.1 -t 60</span><br><span class="line"></span><br><span class="line">/*进行上下行带宽测试*/</span><br><span class="line">iperf -c 192.168.1.1 -d -t 60</span><br><span class="line"></span><br><span class="line">/*测试单线程TCP*/</span><br><span class="line">iperf –c 192.168.1.1 –p 12345 –i 1 –t 10 –w 20K</span><br><span class="line"></span><br><span class="line">-c：客户端模式，后接服务器ip</span><br><span class="line">-p：后接服务端监听的端口</span><br><span class="line">-i：设置带宽报告的时间间隔，单位为秒</span><br><span class="line">-t：设置测试的时长，单位为秒</span><br><span class="line">-w：设置tcp窗口大小，一般可以不用设置，默认即可</span><br><span class="line"></span><br><span class="line">对应服务器端：</span><br><span class="line">iperf –s –p 12345 –i 1 –t 10 –m -y</span><br><span class="line"></span><br><span class="line">/*测试多线程TCP: 客户端同时向服务器端发起30个连接线程*/</span><br><span class="line">iperf -c 192.168.1.1 -P 30 -t 60</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>发包完成后，可以通过 ifconfig ethx 和 ethtool -S ethx 查看对应收发包情况，确定发包数、包长、是否丢包等。</p>
<h2 id="Netperf-测试实践"><a href="#Netperf-测试实践" class="headerlink" title="Netperf 测试实践"></a>Netperf 测试实践</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># install netperf</span></span><br><span class="line">wget -c <span class="string">&quot;https://codeload.github.com/HewlettPackard/netperf/tar.gz/netperf-2.7.0&quot;</span> -O netperf-2.7.0.tar.gz</span><br><span class="line">tar -zxvf netperf-2.7.0.tar.gz</span><br><span class="line"><span class="built_in">cd</span> netperf-netperf-2.7.0</span><br><span class="line">./configure &amp;&amp; make &amp;&amp; make install</span><br><span class="line"></span><br><span class="line"><span class="comment"># add path</span></span><br><span class="line">vim ~/.bash_profile</span><br><span class="line">PATH=<span class="variable">$PATH</span>:/usr/local/bin/</span><br><span class="line"></span><br><span class="line"><span class="built_in">source</span> ~/.bash_profile</span><br><span class="line"></span><br><span class="line"><span class="comment"># test</span></span><br><span class="line"><span class="built_in">cd</span> src</span><br><span class="line">netperf -h</span><br><span class="line">netserver -h</span><br><span class="line"></span><br><span class="line"><span class="comment"># server</span></span><br><span class="line">netserver -4 -p 7777</span><br><span class="line">ps -ef | grep netserver</span><br><span class="line"></span><br><span class="line"><span class="comment"># client</span></span><br><span class="line">netperf -H 10.71.14.122 -p 7777 -l 60</span><br><span class="line"></span><br><span class="line">netperf -t TCP_RR -H 10.71.14.122 -p 7777 -c -C -l 60</span><br><span class="line">netperf -t TCP_RR -H 10.71.14.122 -p 7777 -c -C -l 60 -- -r256,256</span><br><span class="line"></span><br><span class="line"><span class="comment"># check result</span></span><br><span class="line">bmon</span><br><span class="line">mpstat -P ALL 2</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<h2 id="参考文章"><a href="#参考文章" class="headerlink" title="参考文章"></a>参考文章</h2><p><a target="_blank" rel="noopener" href="https://www.ibm.com/developerworks/cn/linux/l-netperf/">netperf 与网络性能测量</a><br><a target="_blank" rel="noopener" href="https://www.alibabacloud.com/help/zh/faq-detail/55757.htm">网络性能测试方法</a></p>
  
	</div>
		<footer class="article-footer clearfix">
<div class="article-catetags">

<div class="article-categories">
  <span></span>
  <a class="article-category-link" href="/categories/%E5%AD%A6%E4%B9%A0-Study/">学习 | Study</a>
</div>


</div>



	<div class="article-share" id="share">
	
	  <div data-url="https://wsgzao.github.io/post/netperf/" data-title="netperf和iperf网络性能测试小结 | HelloDog" data-tsina="" class="share clearfix">
	  </div>
	
	</div>


</footer>

   	       
	</article>
	
<nav class="article-nav clearfix">
 
 <div class="prev" >
 <a href="/post/mpstat/" title="mpstat使用介绍和输出参数详解">
  <strong>上一篇：</strong><br/>
  <span>
  mpstat使用介绍和输出参数详解</span>
</a>
</div>


<div class="next">
<a href="/post/sre-vs-devops/"  title="SRE和DevOps">
 <strong>下一篇：</strong><br/> 
 <span>SRE和DevOps
</span>
</a>
</div>

</nav>

	

<section id="comments" class="comment">
  <div id="disqus_thread">
    <noscript>Please enable JavaScript to view the <a target="_blank" rel="noopener" href="//disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
  </div>
</section>



</div>  
      <div class="openaside"><a class="navbutton" href="#" title="显示侧边栏"></a></div>

  <div id="toc" class="toc-aside">
  <strong class="toc-title">文章目录</strong>
 
 <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%89%8D%E8%A8%80"><span class="toc-number">1.</span> <span class="toc-text">前言</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%9B%B4%E6%96%B0%E5%8E%86%E5%8F%B2"><span class="toc-number">2.</span> <span class="toc-text">更新历史</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%BD%91%E7%BB%9C%E6%80%A7%E8%83%BD%E6%B5%8B%E9%87%8F%E7%9A%84%E4%BA%94%E9%A1%B9%E6%8C%87%E6%A0%87"><span class="toc-number">3.</span> <span class="toc-text">网络性能测量的五项指标</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8F%AF%E7%94%A8%E6%80%A7"><span class="toc-number">3.1.</span> <span class="toc-text">可用性</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%93%8D%E5%BA%94%E6%97%B6%E9%97%B4"><span class="toc-number">3.2.</span> <span class="toc-text">响应时间</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%BD%91%E7%BB%9C%E5%88%A9%E7%94%A8%E7%8E%87"><span class="toc-number">3.3.</span> <span class="toc-text">网络利用率</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%BD%91%E7%BB%9C%E5%90%9E%E5%90%90%E9%87%8F"><span class="toc-number">3.4.</span> <span class="toc-text">网络吞吐量</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%BD%91%E7%BB%9C%E5%B8%A6%E5%AE%BD%E5%AE%B9%E9%87%8F"><span class="toc-number">3.5.</span> <span class="toc-text">网络带宽容量</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%94%B6%E9%9B%86%E7%BD%91%E7%BB%9C%E6%80%A7%E8%83%BD%E6%95%B0%E6%8D%AE%E7%9A%84%E6%96%B9%E5%BC%8F"><span class="toc-number">3.6.</span> <span class="toc-text">收集网络性能数据的方式</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Netperf"><span class="toc-number">4.</span> <span class="toc-text">Netperf</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#iperf"><span class="toc-number">5.</span> <span class="toc-text">iperf</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AE%9E%E4%BE%8B"><span class="toc-number">5.1.</span> <span class="toc-text">实例</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Netperf-%E6%B5%8B%E8%AF%95%E5%AE%9E%E8%B7%B5"><span class="toc-number">6.</span> <span class="toc-text">Netperf 测试实践</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%8F%82%E8%80%83%E6%96%87%E7%AB%A0"><span class="toc-number">7.</span> <span class="toc-text">参考文章</span></a></li></ol>
 
  </div>

<div id="asidepart">
<div class="closeaside"><a class="closebutton" href="#" title="隐藏侧边栏"></a></div>
<aside class="clearfix">

  
<div class="github-card">
<p class="asidetitle">Github 名片</p>
<div class="github-card" data-github="wsgzao" data-theme="medium"></div>
<script type="text/javascript" src="//lab.lepture.com/github-cards/widget.js" ></script>
</div>



  
<div class="categorieslist">
	<p class="asidetitle">分类</p>
		<ul>
		
		  
			<li><a href="/categories/Hexo/" title="Hexo">Hexo<sup>6</sup></a></li>
		  
		
		  
			<li><a href="/categories/学习-Study/" title="学习 | Study">学习 | Study<sup>196</sup></a></li>
		  
		
		  
			<li><a href="/categories/生活-Life/" title="生活 | Life">生活 | Life<sup>31</sup></a></li>
		  
		
		  
			<li><a href="/categories/软件-Soft/" title="软件 | Soft">软件 | Soft<sup>5</sup></a></li>
		  
		
		</ul>
</div>


  <div class="linkslist">
  <p class="asidetitle">友情链接</p>
    <ul>
        
          <li>
            
            	<a href="http://wuchong.me" target="_blank" title="Jark&#39;s Blog">Jark&#39;s Blog</a>
            
          </li>
        
          <li>
            
            	<a href="https://www.linkedin.com/in/aowang" target="_blank" title="LinkedIn">LinkedIn</a>
            
          </li>
        
    </ul>
</div>

  <div class="rsspart">
	<a href="/atom.xml" target="_blank" title="rss">RSS 订阅</a>
</div>

</aside>
</div>
    </div>
    <footer><div id="footer" >
	
	<div class="line">
		<span></span>
		<div class="author"></div>
	</div>
	
	
	<section class="info">
		<p> Hello, I&#39;m OX. This is my blog on GitHub. <br/>
			Keep Calm and Carry On.</p>
	</section>
	 
	<div class="social-font" class="clearfix">
		
		
		<a href="https://github.com/wsgzao" target="_blank" class="icon-github" title="github"></a>
		
		
		
		
		
		<a href="https://www.linkedin.com/in/aowang" target="_blank" class="icon-linkedin" title="linkedin"></a>
		
		
		
		
		
	</div>
			
		

		<p class="copyright">
		Powered by <a href="http://hexo.io" target="_blank" title="hexo">hexo</a> and Theme by <a href="https://github.com/wuchong/jacman" target="_blank" title="Jacman">Jacman</a> © 2024 
		
		<a href="/about" target="_blank" title="wsgzao">wsgzao</a>
		
		
		</p>
</div>
</footer>
    <script src="/js/jquery-3.6.4.min.js"></script>
<script src="/js/jquery.imagesloaded.min.js"></script>
<script src="/js/gallery.js"></script>
<script src="/js/jquery-qrcode-0.18.0.min.js"></script>

<script type="text/javascript">
$(document).ready(function(){ 
  $('.navbar').click(function(){
    $('header nav').toggleClass('shownav');
  });
  var myWidth = 0;
  function getSize(){
    if( typeof( window.innerWidth ) == 'number' ) {
      myWidth = window.innerWidth;
    } else if( document.documentElement && document.documentElement.clientWidth) {
      myWidth = document.documentElement.clientWidth;
    };
  };
  var m = $('#main'),
      a = $('#asidepart'),
      c = $('.closeaside'),
      o = $('.openaside');
  c.click(function(){
    a.addClass('fadeOut').css('display', 'none');
    o.css('display', 'block').addClass('fadeIn');
    m.addClass('moveMain');
  });
  o.click(function(){
    o.css('display', 'none').removeClass('beforeFadeIn');
    a.css('display', 'block').removeClass('fadeOut').addClass('fadeIn');      
    m.removeClass('moveMain');
  });
  $(window).scroll(function(){
    o.css("top",Math.max(80,260-$(this).scrollTop()));
  });
  
        getSize();
        if (myWidth >= 1024) {
          c.click();
        }
  
  $(window).resize(function(){
    getSize(); 
    if (myWidth >= 1024) {
      $('header nav').removeClass('shownav');
    }else{
      m.removeClass('moveMain');
      a.css('display', 'block').removeClass('fadeOut');
      o.css('display', 'none');
      
      $('#toc.toc-aside').css('display', 'none');
        
    }
  });
});
</script>

<script type="text/javascript">
$(document).ready(function(){ 
  var ai = $('.article-content>iframe'),
      ae = $('.article-content>embed'),
      t  = $('#toc'),
      ta = $('#toc.toc-aside'),
      o  = $('.openaside'),
      c  = $('.closeaside');
  if(ai.length>0){
    ai.wrap('<div class="video-container" />');
  };
  if(ae.length>0){
   ae.wrap('<div class="video-container" />');
  };
  c.click(function(){
    ta.css('display', 'block').addClass('fadeIn');
  });
  o.click(function(){
    ta.css('display', 'none');
  });
  $(window).scroll(function(){
    ta.css("top",Math.max(140,320-$(this).scrollTop()));
  });
});
</script>


<script type="text/javascript">
$(document).ready(function(){ 
  var $this = $('.share'),
      url = $this.attr('data-url'),
      encodedUrl = encodeURIComponent(url),
      title = $this.attr('data-title'),
      tsina = $this.attr('data-tsina'),
      description = $this.attr('description');
  var html = [
  '<div class="hoverqrcode clearfix"></div>',
  '<a class="overlay" id="qrcode"></a>',
  '<a href="https://www.facebook.com/sharer.php?u=' + encodedUrl + '" class="article-share-facebook" target="_blank" title="Facebook"></a>',
  '<a href="https://twitter.com/intent/tweet?url=' + encodedUrl + '" class="article-share-twitter" target="_blank" title="Twitter"></a>',
  '<a href="#qrcode" class="article-share-qrcode" title="微信"></a>',
  '<a href="http://widget.renren.com/dialog/share?resourceUrl=' + encodedUrl + '&srcUrl=' + encodedUrl + '&title=' + title +'" class="article-share-renren" target="_blank" title="人人"></a>',
  '<a href="http://service.weibo.com/share/share.php?title='+title+'&url='+encodedUrl +'&ralateUid='+ tsina +'&searchPic=true&style=number' +'" class="article-share-weibo" target="_blank" title="微博"></a>',
  '<span title="Share to"></span>'
  ].join('');
  $this.append(html);

  $('.hoverqrcode').hide();

  var myWidth = 0;
  function updatehoverqrcode(){
    if( typeof( window.innerWidth ) == 'number' ) {
      myWidth = window.innerWidth;
    } else if( document.documentElement && document.documentElement.clientWidth) {
      myWidth = document.documentElement.clientWidth;
    };
    var qrsize = myWidth > 1024 ? 200:100;
    var options = {render: 'image', size: qrsize, fill: '#2ca6cb', text: url, radius: 0.5, quiet: 1};
    var p = $('.article-share-qrcode').position();
    $('.hoverqrcode').empty().css('width', qrsize).css('height', qrsize)
                          .css('left', p.left-qrsize/2+20).css('top', p.top-qrsize-10)
                          .qrcode(options);
  };
  $(window).resize(function(){
    $('.hoverqrcode').hide();
  });
  $('.article-share-qrcode').click(function(){
    updatehoverqrcode();
    $('.hoverqrcode').toggle();
  });
  $('.article-share-qrcode').hover(function(){}, function(){
      $('.hoverqrcode').hide();
  });
});   
</script>




<script type="text/javascript">

var disqus_shortname = 'wsgzao';

(function(){
  var dsq = document.createElement('script');
  dsq.type = 'text/javascript';
  dsq.async = true;
  dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
  (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
}());
(function(){
  var dsq = document.createElement('script');
  dsq.type = 'text/javascript';
  dsq.async = true;
  dsq.src = '//' + disqus_shortname + '.disqus.com/count.js';
  (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
}());
</script>








<link rel="stylesheet" href="/fancybox/jquery.fancybox.css" media="screen" type="text/css">
<script src="/fancybox/jquery.fancybox.pack.js"></script>
<script type="text/javascript">
$(document).ready(function(){ 
  $('.article-content').each(function(i){
    $(this).find('img').each(function(){
      if ($(this).parent().hasClass('fancybox')) return;
      var alt = this.alt;
      if (alt) $(this).after('<span class="caption">' + alt + '</span>');
      $(this).wrap('<a href="' + this.src + '" title="' + alt + '" class="fancybox"></a>');
    });
    $(this).find('.fancybox').each(function(){
      $(this).attr('rel', 'article' + i);
    });
  });
  if($.fancybox){
    $('.fancybox').fancybox();
  }
}); 
</script>



<!-- Analytics Begin -->

<script type="text/javascript">
(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','//www.google-analytics.com/analytics.js','ga');
ga('create', 'UA-77732745-1', 'wsgzao.github.io');  
ga('send', 'pageview');
</script>



<script>
var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = "//hm.baidu.com/hm.js?c2c5fc7d844d0973d9f77abd87f49c3c";
  var s = document.getElementsByTagName("script")[0]; 
  s.parentNode.insertBefore(hm, s);
})();
</script>



<!-- Analytics End -->

<!-- Totop Begin -->

	<div id="totop">
	<a title="返回顶部"><img src="/img/scrollup.png"/></a>
	</div>
	<script src="/js/totop.js"></script>

<!-- Totop End -->

<!-- MathJax Begin -->
<!-- mathjax config similar to math.stackexchange -->


<!-- MathJax End -->

<!-- swiftype Begin -->

<script type="text/javascript">
  (function(w,d,t,u,n,s,e){w['SwiftypeObject']=n;w[n]=w[n]||function(){
  (w[n].q=w[n].q||[]).push(arguments);};s=d.createElement(t);
  e=d.getElementsByTagName(t)[0];s.async=1;s.src=u;e.parentNode.insertBefore(s,e);
  })(window,document,'script','//s.swiftypecdn.com/install/v2/st.js','_st');

  _st('install','_4qDmKrBPn9Es3UvQHT4','2.0.0');
</script>

<!-- swiftype End -->

  </body>
</html>
