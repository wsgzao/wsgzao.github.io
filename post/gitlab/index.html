
 <!DOCTYPE HTML>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <script type="text/javascript">
    var host = "wsgzao.github.io";
    if ((host == window.location.host) && (window.location.protocol != "https:"))
        window.location.protocol = "https";
  </script> 
<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-LJ3PMGPVCK"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-LJ3PMGPVCK');
</script>
  
    <title>RHEL7/CentOS7在线和离线安装GitLab配置使用实践 | HelloDog</title>
    <meta name="viewport" content="width=device-width, initial-scale=1,user-scalable=no">
    
    <meta name="author" content="wsgzao">
    

    
    <meta name="description" content="RHEL7&#x2F;CentOS7在线和离线安装GitLab配置实践，GitLab汉化配置使用小结">
<meta property="og:type" content="article">
<meta property="og:title" content="RHEL7&#x2F;CentOS7在线和离线安装GitLab配置使用实践">
<meta property="og:url" content="https://wsgzao.github.io/post/gitlab/index.html">
<meta property="og:site_name" content="HelloDog">
<meta property="og:description" content="RHEL7&#x2F;CentOS7在线和离线安装GitLab配置实践，GitLab汉化配置使用小结">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="http://docs-aliyun.cn-hangzhou.oss.aliyun-inc.com/assets/pic/52857/cn_zh/1492756915645/%E5%9B%BE%E7%89%878.png">
<meta property="og:image" content="https://www.ilanni.com/wp-content/uploads/2018/04/clip_image011_thumb-1.png">
<meta property="article:published_time" content="2018-04-19T08:40:53.000Z">
<meta property="article:modified_time" content="2023-02-27T05:33:06.000Z">
<meta property="article:author" content="wsgzao">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="http://docs-aliyun.cn-hangzhou.oss.aliyun-inc.com/assets/pic/52857/cn_zh/1492756915645/%E5%9B%BE%E7%89%878.png">

    
    <link rel="alternative" href="/atom.xml" title="HelloDog" type="application/atom+xml">
    
    
    <link rel="icon" href="/img/favicon.ico">
    
    
    <link rel="apple-touch-icon" href="/img/jacman.jpg">
    <link rel="apple-touch-icon-precomposed" href="/img/jacman.jpg">
    
    
<link rel="stylesheet" href="/css/style.css">

<meta name="generator" content="Hexo 6.3.0"></head>

  <body>
    <header>
      
<div>
		
			<div id="imglogo">
				<a href="/"><img src="/img/logo.png" alt="HelloDog" title="HelloDog"/></a>
			</div>
			
			<div id="textlogo">
				<h1 class="site-name"><a href="/" title="HelloDog">HelloDog</a></h1>
				<h2 class="blog-motto">Keep Calm and Carry On</h2>
			</div>
			<div class="navbar"><a class="navbutton navmobile" href="#" title="菜单">
			</a></div>
			<nav class="animated">
				<ul>
					<ul>
					 
						<li><a href="/">主页 | Home</a></li>
					
						<li><a href="/index/">索引 | Index</a></li>
					
						<li><a href="/archives/">归档 | Archives</a></li>
					
						<li><a href="/about/">简介 | About</a></li>
					
					<li>
 					
						<form class="search">
							<label>Search</label>
						<input type="text" id="search" class="st-default-search-input" name="q" size="30" placeholder="搜索"><br>
						</form>
					
					</li>
				</ul>
			</nav>			
</div>
    </header>
    <div id="container">
      <div id="main" class="post" itemscope itemprop="blogPost">
  
	<article itemprop="articleBody"> 
		<header class="article-info clearfix">
  <h1 itemprop="name">
    
      <a href="/post/gitlab/" title="RHEL7/CentOS7在线和离线安装GitLab配置使用实践" itemprop="url">RHEL7/CentOS7在线和离线安装GitLab配置使用实践</a>
  </h1>
  <p class="article-author">By
       
		<a href="/about" title="wsgzao" target="_blank" itemprop="author">wsgzao</a>
		
  <p class="article-time">
    <time datetime="2018-04-19T08:40:53.000Z" itemprop="datePublished"> 发表于 2018-04-19</time>
    
  </p>
</header>
	<div class="article-content">
<!-- 		
		<div id="toc" class="toc-article">
			<strong class="toc-title">文章目录</strong>
		
			<ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%89%8D%E8%A8%80"><span class="toc-number">1.</span> <span class="toc-text">前言</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%9B%B4%E6%96%B0%E8%AE%B0%E5%BD%95"><span class="toc-number">2.</span> <span class="toc-text">更新记录</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#GitLab%E7%AE%80%E4%BB%8B"><span class="toc-number">3.</span> <span class="toc-text">GitLab简介</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Gitlab%E7%9A%84%E6%9C%8D%E5%8A%A1%E6%9E%84%E6%88%90"><span class="toc-number">3.1.</span> <span class="toc-text">Gitlab的服务构成</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#GitLab%E5%B7%A5%E4%BD%9C%E6%B5%81%E7%A8%8B"><span class="toc-number">3.2.</span> <span class="toc-text">GitLab工作流程</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#GitLab%E5%AE%89%E8%A3%85"><span class="toc-number">4.</span> <span class="toc-text">GitLab安装</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%9F%BA%E7%A1%80%E4%BE%9D%E8%B5%96"><span class="toc-number">4.1.</span> <span class="toc-text">基础依赖</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%9C%A8%E7%BA%BF%E5%AE%89%E8%A3%85gitlab-ce"><span class="toc-number">4.2.</span> <span class="toc-text">在线安装gitlab-ce</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%A6%BB%E7%BA%BF%E5%AE%89%E8%A3%85gitlab-ce"><span class="toc-number">4.3.</span> <span class="toc-text">离线安装gitlab-ce</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#GitLab%E6%B1%89%E5%8C%96"><span class="toc-number">5.</span> <span class="toc-text">GitLab汉化</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#GitLab-%E5%B8%B8%E7%94%A8%E5%91%BD%E4%BB%A4"><span class="toc-number">6.</span> <span class="toc-text">GitLab 常用命令</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%85%AC%E7%BD%91%E9%82%AE%E7%AE%B1%E9%85%8D%E7%BD%AE"><span class="toc-number">7.</span> <span class="toc-text">公网邮箱配置</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#QQ%E4%BC%81%E4%B8%9A%E9%82%AE%E7%AE%B1"><span class="toc-number">7.1.</span> <span class="toc-text">QQ企业邮箱</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#163%E9%82%AE%E7%AE%B1"><span class="toc-number">7.2.</span> <span class="toc-text">163邮箱</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%98%BF%E9%87%8C%E4%BA%91%E4%BC%81%E4%B8%9A%E9%82%AE%E7%AE%B1"><span class="toc-number">7.3.</span> <span class="toc-text">阿里云企业邮箱</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#GitLab%E4%BD%BF%E7%94%A8"><span class="toc-number">8.</span> <span class="toc-text">GitLab使用</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%99%BB%E5%BD%95GitLab"><span class="toc-number">8.1.</span> <span class="toc-text">登录GitLab</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%9B%E5%BB%BAProject"><span class="toc-number">8.2.</span> <span class="toc-text">创建Project</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%AE%80%E5%8D%95%E9%85%8D%E7%BD%AE"><span class="toc-number">8.3.</span> <span class="toc-text">简单配置</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%85%8D%E7%BD%AE-GitLab"><span class="toc-number">9.</span> <span class="toc-text">配置 GitLab</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%AE%BE%E7%BD%AE%E5%A4%96%E9%83%A8%E8%AE%BF%E9%97%AE%E9%93%BE%E6%8E%A5"><span class="toc-number">9.1.</span> <span class="toc-text">设置外部访问链接</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#HTTPS-%E9%85%8D%E7%BD%AE"><span class="toc-number">9.2.</span> <span class="toc-text">HTTPS 配置</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%BA%94%E7%94%A8%E9%85%8D%E7%BD%AE"><span class="toc-number">9.3.</span> <span class="toc-text">应用配置</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#GitLab-%E5%A4%87%E4%BB%BD%E5%8D%87%E7%BA%A7%E8%BF%81%E7%A7%BB"><span class="toc-number">10.</span> <span class="toc-text">GitLab 备份升级迁移</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#GitLab-%E5%A4%87%E4%BB%BD"><span class="toc-number">10.1.</span> <span class="toc-text">GitLab 备份</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#GitLab-%E5%8D%87%E7%BA%A7"><span class="toc-number">10.2.</span> <span class="toc-text">GitLab 升级</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#GitLab-%E8%BF%81%E7%A7%BB"><span class="toc-number">10.3.</span> <span class="toc-text">GitLab 迁移</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#GitLab-%E5%B8%B8%E8%A7%81%E9%97%AE%E9%A2%98"><span class="toc-number">11.</span> <span class="toc-text">GitLab 常见问题</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%9B%B4%E6%94%B9%E7%AE%A1%E7%90%86%E5%91%98%E5%AF%86%E7%A0%81"><span class="toc-number">11.1.</span> <span class="toc-text">更改管理员密码</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#The-requested-URL-returned-error-401-while-accessing"><span class="toc-number">11.2.</span> <span class="toc-text">The requested URL returned error: 401 while accessing</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#webhooks%E4%B8%8D%E7%94%9F%E6%95%88"><span class="toc-number">11.3.</span> <span class="toc-text">webhooks不生效</span></a></li></ol></li></ol>
		
		</div>
		 -->
		<h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>GitLab Community Edition 新版本已经集成了CI&#x2F;CD的支持，从某种程度上来说可以告别对于Jenkins的依赖，我本来计划是写基于Docker部署GitLab但感觉还是有点重，对于内网离线环境来说基于容器部署也未必是合理的方案，这里沿用传统的部署方式介绍简单且长期有效的GitLab部署方案供大家参考，或许未来会增加基于容器的部署方案和CI&#x2F;CD的分享，因需而变。</p>
<blockquote>
<p>RHEL7&#x2F;CentOS7在线和离线安装GitLab配置实践，GitLab汉化配置使用小结</p>
</blockquote>
<h2 id="更新记录"><a href="#更新记录" class="headerlink" title="更新记录"></a>更新记录</h2><p>2018年04月19日 - 完善内容<br>2018年04月10日 - 初稿</p>
<p>阅读原文 - <a href="https://wsgzao.github.io/post/gitlab/">https://wsgzao.github.io/post/gitlab/</a></p>
<p><strong>扩展阅读</strong></p>
<p>GitLab Installation - <a target="_blank" rel="noopener" href="https://about.gitlab.com/installation">https://about.gitlab.com/installation</a></p>
<h2 id="GitLab简介"><a href="#GitLab简介" class="headerlink" title="GitLab简介"></a>GitLab简介</h2><p>GitLab是利用Ruby On Rails开发的一个开源版本管理系统，实现了一个自托管的Git项目仓库，是集代码托管，测试，部署于一体的开源git仓库管理软件，可通过web界面来进行访问公开的或私人项目。与Github类似，GitLab能够浏览代码，管理缺陷和注释。可以管理团队对仓库的访问，它非常易于浏览提交过的版本，并提供一个文件历史库。它还提供一个代码片段收集功能可以轻松实现代码复用，便于日后需要的时候查找。</p>
<blockquote>
<p>Git的家族成员</p>
</blockquote>
<ul>
<li>Git：是一种版本控制系统，是一个命令，是一种工具。</li>
<li>Gitlib：是用于实现Git功能的开发库。</li>
<li>Github：是一个基于Git实现的在线代码托管仓库，公开项目是免费的，也可以付费创建私人项目。</li>
<li>GitLab：是一个基于Git实现的在线代码仓库托管软件，可以用GitLab搭建一套类似Github的系统。</li>
</ul>
<p>GitLab对硬件还是有一定要求的，1核心的CPU基本上可以满足需求，大概支撑100个左右的用户，不过在运行GitLab网站的同时还需要运行多个后台job，就会显得有点捉襟见肘了。需要至少4GB的可寻址内存（RAM交换）来安装和使用GitLab，操作系统和任何其他正在运行的应用程序也将使用内存，因此请记住，在运行GitLab之前，您至少需要4GB的可用空间。如果使用更少的内存，GitLab将在重新配置运行期间给出奇怪的错误，我用虚拟机来分别新建1G,2G内存的CentOS系统来装GitLab，确实非常捉襟见肘啊，伤不起。</p>
<h3 id="Gitlab的服务构成"><a href="#Gitlab的服务构成" class="headerlink" title="Gitlab的服务构成"></a>Gitlab的服务构成</h3><ul>
<li>Nginx：静态web服务器</li>
<li>gitlab-shell：用于处理Git命令和修改authorized keys列表</li>
<li>gitlab-workhorse: 轻量级的反向代理服务器</li>
<li>logrotate：日志文件管理工具</li>
<li>postgresql：数据库</li>
<li>redis：缓存数据库</li>
<li>sidekiq：用于在后台执行队列任务（异步执行）</li>
<li>unicorn：An HTTP server for Rack applications，GitLab Rails应用是托管在这个服务器上面的</li>
</ul>
<h3 id="GitLab工作流程"><a href="#GitLab工作流程" class="headerlink" title="GitLab工作流程"></a>GitLab工作流程</h3><p><img src="http://docs-aliyun.cn-hangzhou.oss.aliyun-inc.com/assets/pic/52857/cn_zh/1492756915645/%E5%9B%BE%E7%89%878.png"></p>
<h2 id="GitLab安装"><a href="#GitLab安装" class="headerlink" title="GitLab安装"></a>GitLab安装</h2><h3 id="基础依赖"><a href="#基础依赖" class="headerlink" title="基础依赖"></a>基础依赖</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">yum install curl policycoreutils openssh-server openssh-clients -y</span><br><span class="line">systemctl <span class="built_in">enable</span> sshd</span><br><span class="line">systemctl start sshd</span><br><span class="line">yum install postfix</span><br><span class="line">systemctl <span class="built_in">enable</span> postfix</span><br><span class="line"></span><br><span class="line"><span class="comment"># 检查修改邮件下面2项配置，不配置可以跳过</span></span><br><span class="line">vim /etc/postfix/main.cf </span><br><span class="line"></span><br><span class="line">inet_interfaces = all</span><br><span class="line">inet_protocols = ipv4</span><br><span class="line"></span><br><span class="line">systemctl start postfix</span><br></pre></td></tr></table></figure>

<h3 id="在线安装gitlab-ce"><a href="#在线安装gitlab-ce" class="headerlink" title="在线安装gitlab-ce"></a>在线安装gitlab-ce</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 安装必要的依赖包，如果不需要可以考虑跳过</span></span><br><span class="line">yum install pygpgme yum-utils</span><br><span class="line"><span class="comment"># On CentOS 7 (and RedHat/Oracle/Scientific Linux 7), the commands below will also open HTTP and SSH access in the system firewall.</span></span><br><span class="line">sudo yum install -y curl policycoreutils-python openssh-server</span><br><span class="line">sudo systemctl <span class="built_in">enable</span> sshd</span><br><span class="line">sudo systemctl start sshd</span><br><span class="line">sudo firewall-cmd --permanent --add-service=http</span><br><span class="line">sudo systemctl reload firewalld</span><br><span class="line"><span class="comment"># Next, install Postfix to send notification emails. If you want to use another solution to send emails please skip this step and configure an external SMTP server after GitLab has been installed.</span></span><br><span class="line">sudo yum install postfix</span><br><span class="line">sudo systemctl <span class="built_in">enable</span> postfix</span><br><span class="line">sudo systemctl start postfix</span><br><span class="line"></span><br><span class="line"><span class="comment"># 使用阿里云作加速</span></span><br><span class="line"><span class="built_in">cd</span> /etc/yum.repos.d/ &amp;&amp; <span class="built_in">rm</span> -f *.repo</span><br><span class="line">wget -O /etc/yum.repos.d/epel.repo http://mirrors.aliyun.com/repo/epel-7.repo</span><br><span class="line">wget -O /etc/yum.repos.d/CentOS-Base.repo http://mirrors.aliyun.com/repo/Centos-7.repo</span><br><span class="line"></span><br><span class="line"><span class="comment"># 添加GitLab镜像源并安装，建议切换国内资源加速访问</span></span><br><span class="line">curl https://packages.gitlab.com/install/repositories/gitlab/gitlab-ce/script.rpm.sh | sudo bash</span><br><span class="line"></span><br><span class="line"><span class="comment"># 创建gitlab-ce的repo，使用清华大学加速</span></span><br><span class="line">vim /etc/yum.repos.d/gitlab_gitlab-ce.repo</span><br><span class="line"></span><br><span class="line">[gitlab-ce]</span><br><span class="line">name=gitlab-ce</span><br><span class="line">baseurl=http://mirrors.tuna.tsinghua.edu.cn/gitlab-ce/yum/el7</span><br><span class="line">repo_gpgcheck=0</span><br><span class="line">gpgcheck=0</span><br><span class="line">enabled=1</span><br><span class="line">gpgkey=https://packages.gitlab.com/gpg.key</span><br><span class="line"></span><br><span class="line"><span class="comment">#配置并启动 GitLab</span></span><br><span class="line">gitlab-ctl reconfigure</span><br><span class="line"></span><br><span class="line"><span class="comment"># 第一次访问GitLab，系统会重定向页面到重定向到重置密码页面，你需要输入初始化管理员账号的密码，管理员的用户名为root，重置密码后新密码即为刚输入的密码。</span></span><br><span class="line">0.0.0.0:80</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h3 id="离线安装gitlab-ce"><a href="#离线安装gitlab-ce" class="headerlink" title="离线安装gitlab-ce"></a>离线安装gitlab-ce</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 使用阿里云作加速</span></span><br><span class="line"><span class="built_in">cd</span> /etc/yum.repos.d/ &amp;&amp; <span class="built_in">rm</span> -f *.repo</span><br><span class="line">wget -O /etc/yum.repos.d/epel.repo http://mirrors.aliyun.com/repo/epel-7.repo</span><br><span class="line">wget -O /etc/yum.repos.d/CentOS-Base.repo http://mirrors.aliyun.com/repo/Centos-7.repo</span><br><span class="line"></span><br><span class="line"><span class="comment"># 添加GitLab镜像源并安装，建议切换国内资源加速访问</span></span><br><span class="line">curl https://packages.gitlab.com/install/repositories/gitlab/gitlab-ce/script.rpm.sh | sudo bash</span><br><span class="line"></span><br><span class="line"><span class="comment"># 创建gitlab-ce的repo，使用清华大学加速</span></span><br><span class="line">vim /etc/yum.repos.d/gitlab_gitlab-ce.repo</span><br><span class="line"></span><br><span class="line">[gitlab-ce]</span><br><span class="line">name=gitlab-ce</span><br><span class="line">baseurl=http://mirrors.tuna.tsinghua.edu.cn/gitlab-ce/yum/el7</span><br><span class="line">repo_gpgcheck=0</span><br><span class="line">gpgcheck=0</span><br><span class="line">enabled=1</span><br><span class="line">gpgkey=https://packages.gitlab.com/gpg.key</span><br><span class="line"></span><br><span class="line"><span class="comment">#安装yum-plugin-downloadonly插件</span></span><br><span class="line">yum install -y yum-plugin-downloadonly</span><br><span class="line"></span><br><span class="line"><span class="comment"># 下载gitlab-ce相关rpm到指定目录</span></span><br><span class="line"><span class="built_in">mkdir</span> -p /tmp/repo/gitlab-ce/</span><br><span class="line">yum install --downloadonly --downloaddir=/tmp/repo/gitlab-ce/ gitlab-ce</span><br><span class="line"></span><br><span class="line"><span class="comment"># 拷贝文件至内网离线安装</span></span><br><span class="line">rpm -ivh /tmp/repo/gitlab-ce/*</span><br><span class="line"></span><br><span class="line"><span class="comment">#配置并启动 GitLab</span></span><br><span class="line">gitlab-ctl reconfigure</span><br><span class="line"></span><br><span class="line"><span class="comment"># 第一次访问GitLab，系统会重定向页面到重定向到重置密码页面，你需要输入初始化管理员账号的密码，管理员的用户名为root，重置密码后新密码即为刚输入的密码。</span></span><br><span class="line">0.0.0.0:80</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="GitLab汉化"><a href="#GitLab汉化" class="headerlink" title="GitLab汉化"></a>GitLab汉化</h2><blockquote>
<p>如果团队里英文水平都不错的话，是没必要汉化的，我个人的建议是坚持使用原版不做汉化</p>
</blockquote>
<p>我这边测试GitLab 10.6.3 新版本中官方已经集成了简体中文，虽然不完整但应该是一个好的开端，设置方式如下<br>右上角用户头像-Settings-Profile-Main settings-Preferred language-简体中文<br>保存选择Update profile settings，然后Sign out重新登录就可以看到效果了<br>当然我还是希望大家习惯English界面，Trouble Shooting也方便</p>
<p>GitLab中文社区的项目，v7-v8.8是由Larry Li发起的“GitLab中文社区版项目”<br><a target="_blank" rel="noopener" href="https://gitlab.com/larryli/gitlab">https://gitlab.com/larryli/gitlab</a></p>
<p>从v8.9之后由@xhang开始继续汉化项目<br><a target="_blank" rel="noopener" href="https://gitlab.com/xhang/gitlab">https://gitlab.com/xhang/gitlab</a></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 如没安装git，需提前安装</span></span><br><span class="line">yum install -y git</span><br><span class="line"></span><br><span class="line"><span class="comment"># 创建gitlba汉化包下载目录</span></span><br><span class="line"><span class="built_in">mkdir</span> -p /tmp/gitlab</span><br><span class="line"><span class="built_in">cd</span> /tmp/gitlab</span><br><span class="line"></span><br><span class="line"><span class="comment"># 下载最新的汉化包</span></span><br><span class="line">git <span class="built_in">clone</span> https://gitlab.com/xhang/gitlab.git</span><br><span class="line"></span><br><span class="line"><span class="comment"># 如果是要下载老版本的汉化包，需要加上老版本的分支，如果想下载10.0.2，可以运行如下语句</span></span><br><span class="line">git <span class="built_in">clone</span> https://gitlab.com/xhang/gitlab.git -b v10.0.2-zh</span><br><span class="line"></span><br><span class="line"><span class="comment"># 停止GitLab并执行如下语句</span></span><br><span class="line">gitlab-ctl stop</span><br><span class="line"><span class="built_in">cp</span> /tmp/gitlab/gitlab/* /opt/gitlab/embedded/service/gitlab-rails/ -rf</span><br><span class="line"></span><br><span class="line"><span class="comment"># 复制时可能不断提示是否要覆盖，这时可能是系统每次执行cp命令时，其实是执行了cp -i命令的别名。出现这种情况可以修改~/.bashrc，在“alias cp=’cp-i’”前加#注释即可。使用命令或者注销登录即可</span></span><br><span class="line"><span class="built_in">source</span> ~/.bashrc</span><br><span class="line"></span><br><span class="line"><span class="comment"># 接下来可以重新配置和启动</span></span><br><span class="line">gitlab-ctl reconfigure</span><br><span class="line">gitlab-ctl restart</span><br></pre></td></tr></table></figure>

<h2 id="GitLab-常用命令"><a href="#GitLab-常用命令" class="headerlink" title="GitLab 常用命令"></a>GitLab 常用命令</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 语法</span></span><br><span class="line">gitlab-ctl <span class="built_in">command</span> (subcommand)</span><br><span class="line"></span><br><span class="line">Service Management Commands</span><br><span class="line"></span><br><span class="line">start <span class="comment"># 启动所有服务</span></span><br><span class="line">stop <span class="comment"># 关闭所有服务</span></span><br><span class="line">restart <span class="comment"># 重启所有服务</span></span><br><span class="line">status <span class="comment"># 查看所有服务状态</span></span><br><span class="line"><span class="built_in">tail</span> <span class="comment"># 查看日志信息</span></span><br><span class="line">service-list <span class="comment"># 列举所有启动服务</span></span><br><span class="line">graceful-kill <span class="comment"># 平稳停止一个服务</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 启动所有服务</span></span><br><span class="line">gitlab-ctl start </span><br><span class="line"><span class="comment"># 启动单独一个服务</span></span><br><span class="line">gitlab-ctl start nginx</span><br><span class="line"><span class="comment">#查看日志，查看所有日志</span></span><br><span class="line">gitlab-ctl <span class="built_in">tail</span></span><br><span class="line"><span class="comment">#查看具体一个日志,类似tail -f</span></span><br><span class="line">gitlab-ctl <span class="built_in">tail</span> nginx</span><br><span class="line"></span><br><span class="line">General Commands</span><br><span class="line"></span><br><span class="line"><span class="built_in">help</span> <span class="comment"># 帮助</span></span><br><span class="line">reconfigure <span class="comment"># 修改配置文件之后，需要重新加载下</span></span><br><span class="line">show-config <span class="comment"># 查看所有服务配置文件信息</span></span><br><span class="line">uninstall <span class="comment"># 卸载这个软件</span></span><br><span class="line">cleanse <span class="comment"># 删除gitlab数据，重新白手起家</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 显示所有服务配置文件</span></span><br><span class="line">gitlab-ctl show-config</span><br><span class="line"></span><br><span class="line"><span class="comment"># 卸载gitlab</span></span><br><span class="line">gitlab-ctl uninstall</span><br></pre></td></tr></table></figure>

<h2 id="公网邮箱配置"><a href="#公网邮箱配置" class="headerlink" title="公网邮箱配置"></a>公网邮箱配置</h2><p>默认情况下，GitLab用qq邮箱注册是发不出确认邮件的。查看了网上很多邮箱配置的教程，大部分都是误导的。像这类软件，归根到底总结为一句话：一切以官网文档为准。QQ邮箱最好用企业邮箱，本人用个人邮箱进行测试是有些小问题的，正确配置如下：</p>
<p>其他邮箱可以参考官方给出的 SMTP 配置 SMTP Setting<br><a target="_blank" rel="noopener" href="https://docs.gitlab.com/omnibus/settings/smtp.html">https://docs.gitlab.com/omnibus/settings/smtp.html</a></p>
<h3 id="QQ企业邮箱"><a href="#QQ企业邮箱" class="headerlink" title="QQ企业邮箱"></a>QQ企业邮箱</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 编辑gitlab.rb</span></span><br><span class="line">vim /etc/gitlab/gitlab.rb</span><br><span class="line"></span><br><span class="line">gitlab_rails[<span class="string">&#x27;smtp_enable&#x27;</span>] = <span class="literal">true</span></span><br><span class="line">gitlab_rails[<span class="string">&#x27;smtp_address&#x27;</span>] = <span class="string">&quot;smtp.exmail.qq.com&quot;</span></span><br><span class="line">gitlab_rails[<span class="string">&#x27;smtp_port&#x27;</span>] = 465</span><br><span class="line">gitlab_rails[<span class="string">&#x27;smtp_user_name&#x27;</span>] = <span class="string">&quot;xxxx@xx.com&quot;</span></span><br><span class="line">gitlab_rails[<span class="string">&#x27;smtp_password&#x27;</span>] = <span class="string">&quot;password&quot;</span></span><br><span class="line">gitlab_rails[<span class="string">&#x27;smtp_authentication&#x27;</span>] = <span class="string">&quot;login&quot;</span></span><br><span class="line">gitlab_rails[<span class="string">&#x27;smtp_enable_starttls_auto&#x27;</span>] = <span class="literal">true</span></span><br><span class="line">gitlab_rails[<span class="string">&#x27;smtp_tls&#x27;</span>] = <span class="literal">true</span></span><br><span class="line">gitlab_rails[<span class="string">&#x27;gitlab_email_from&#x27;</span>] = <span class="string">&#x27;xxxx@xx.com&#x27;</span></span><br></pre></td></tr></table></figure>

<h3 id="163邮箱"><a href="#163邮箱" class="headerlink" title="163邮箱"></a>163邮箱</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 编辑gitlab.rb</span></span><br><span class="line">vim /etc/gitlab/gitlab.rb</span><br><span class="line"></span><br><span class="line">gitlab_rails[<span class="string">&#x27;smtp_enable&#x27;</span>] = <span class="literal">true</span></span><br><span class="line">gitlab_rails[<span class="string">&#x27;smtp_address&#x27;</span>] = <span class="string">&quot;smtp.163.com&quot;</span></span><br><span class="line">gitlab_rails[<span class="string">&#x27;smtp_port&#x27;</span>] = 25</span><br><span class="line">gitlab_rails[<span class="string">&#x27;smtp_user_name&#x27;</span>] = <span class="string">&quot;gitlab@163.com&quot;</span></span><br><span class="line">gitlab_rails[<span class="string">&#x27;smtp_password&#x27;</span>] = <span class="string">&quot;123456&quot;</span></span><br><span class="line">gitlab_rails[<span class="string">&#x27;smtp_domain&#x27;</span>] = <span class="string">&quot;163.com&quot;</span></span><br><span class="line">gitlab_rails[<span class="string">&#x27;smtp_authentication&#x27;</span>] = <span class="string">&quot;login&quot;</span></span><br><span class="line">gitlab_rails[<span class="string">&#x27;smtp_enable_starttls_auto&#x27;</span>] = <span class="literal">true</span></span><br><span class="line">gitlab_rails[<span class="string">&#x27;gitlab_email_from&#x27;</span>] = <span class="string">&#x27;gitlab@163.com&#x27;</span></span><br><span class="line">gitlab_rails[<span class="string">&#x27;smtp_tls&#x27;</span>] = <span class="literal">false</span></span><br><span class="line">gitlab_rails[<span class="string">&#x27;smtp_openssl_verify_mode&#x27;</span>] = <span class="literal">false</span></span><br></pre></td></tr></table></figure>

<h3 id="阿里云企业邮箱"><a href="#阿里云企业邮箱" class="headerlink" title="阿里云企业邮箱"></a>阿里云企业邮箱</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 编辑gitlab.rb</span></span><br><span class="line">vim /etc/gitlab/gitlab.rb</span><br><span class="line"></span><br><span class="line">gitlab_rails[<span class="string">&#x27;smtp_enable&#x27;</span>] = <span class="literal">true</span></span><br><span class="line">gitlab_rails[<span class="string">&#x27;smtp_address&#x27;</span>] = <span class="string">&quot;smtp.mxhichina.com&quot;</span></span><br><span class="line">gitlab_rails[<span class="string">&#x27;smtp_port&#x27;</span>] = 465</span><br><span class="line">gitlab_rails[<span class="string">&#x27;smtp_user_name&#x27;</span>] = <span class="string">&quot;gitlab@aliyun.com&quot;</span></span><br><span class="line">gitlab_rails[<span class="string">&#x27;smtp_password&#x27;</span>] = <span class="string">&quot;************&quot;</span></span><br><span class="line">gitlab_rails[<span class="string">&#x27;smtp_domain&#x27;</span>] = <span class="string">&quot;aliyun.com&quot;</span></span><br><span class="line">gitlab_rails[<span class="string">&#x27;smtp_authentication&#x27;</span>] = <span class="string">&quot;login&quot;</span></span><br><span class="line">gitlab_rails[<span class="string">&#x27;smtp_enable_starttls_auto&#x27;</span>] = <span class="literal">true</span></span><br><span class="line">gitlab_rails[<span class="string">&#x27;gitlab_email_from&#x27;</span>] = <span class="string">&#x27;gitlab@aliyun.com&#x27;</span></span><br></pre></td></tr></table></figure>


<h2 id="GitLab使用"><a href="#GitLab使用" class="headerlink" title="GitLab使用"></a>GitLab使用</h2><h3 id="登录GitLab"><a href="#登录GitLab" class="headerlink" title="登录GitLab"></a>登录GitLab</h3><ol>
<li>在浏览器的地址栏中输入IP即可登录GitLab的界面，老版本第一次登录使用的用户名和密码为 <code>root</code> 和 <code>5iveL!fe</code></li>
<li>首次登录会强制用户修改密码。密码修改成功后，输入新密码进行登录</li>
</ol>
<h3 id="创建Project"><a href="#创建Project" class="headerlink" title="创建Project"></a>创建Project</h3><p>1.安装Git工具linux：安装Git，使用自带的源安装</p>
<pre><code>yum install git
</code></pre>
<p>2.生成密钥文件：使用ssh-keygen生成密钥文件.ssh&#x2F;id_rsa.pub。</p>
<pre><code>ssh-keygen -t rsa
</code></pre>
<p>3.在GitLab的主页中新建一个Project</p>
<p>4.添加ssh key导入步骤2中生成的密钥文件内容：</p>
<pre><code>Profile Settings =&gt; SSH Keys =&gt; Add SSH key
</code></pre>
<h3 id="简单配置"><a href="#简单配置" class="headerlink" title="简单配置"></a>简单配置</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 配置使用Git仓库的人员姓名</span></span><br><span class="line">git config --global user.name <span class="string">&quot;wangao&quot;</span> </span><br><span class="line"><span class="comment"># 配置使用Git仓库的人员email，填写自己的公司邮箱</span></span><br><span class="line">git config --global user.email <span class="string">&quot;wangao@test.com&quot;</span> </span><br><span class="line"><span class="comment"># 克隆项目，在本地生成同名目录，并且目录中会有所有的项目文件</span></span><br><span class="line">git <span class="built_in">clone</span> git@172.28.70.126:root/test.git</span><br><span class="line"><span class="comment"># 进入到项目目录</span></span><br><span class="line"><span class="built_in">cd</span> <span class="built_in">test</span>/ </span><br><span class="line"><span class="comment"># 创建需要上传到GitLab中的目标文件</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;test&quot;</span> &gt; test.sh</span><br><span class="line"><span class="comment"># 将test.sh文件加入到索引中</span></span><br><span class="line">git add test.sh</span><br><span class="line"><span class="comment"># 将test.sh提交到本地仓库</span></span><br><span class="line">git commit -m <span class="string">&quot;test.sh&quot;</span></span><br><span class="line"><span class="comment"># 将文件同步到GitLab服务器上</span></span><br><span class="line">git push -u origin master</span><br><span class="line"><span class="comment"># 在网页中查看上传的test.sh文件已经同步到GitLab中</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="配置-GitLab"><a href="#配置-GitLab" class="headerlink" title="配置 GitLab"></a>配置 GitLab</h2><h3 id="设置外部访问链接"><a href="#设置外部访问链接" class="headerlink" title="设置外部访问链接"></a>设置外部访问链接</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 编辑 /etc/gitlab/gitlab.rb</span></span><br><span class="line">vim /etc/gitlab/gitlab.rb</span><br><span class="line"></span><br><span class="line"><span class="comment"># 修改第 13 行，改成 http(s)://ip(: 端口) 或者 http(s):// 域名 (: 端口)，（如果云主机上存在 Web 服务占用了 80,443 端口，则 GitLab 不能适用 80,443），比如：</span></span><br><span class="line">external_url <span class="string">&quot;https://repo.gitlab.com&quot;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h3 id="HTTPS-配置"><a href="#HTTPS-配置" class="headerlink" title="HTTPS 配置"></a>HTTPS 配置</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 第513行开始，将SSL证书以及密钥放入/etc/gitlab/ssl/</span></span><br><span class="line">nginx[<span class="string">&#x27;enable&#x27;</span>] = <span class="literal">true</span></span><br><span class="line">nginx[<span class="string">&#x27;redirect_http_to_https&#x27;</span>] = <span class="literal">true</span></span><br><span class="line">nginx[<span class="string">&#x27;ssl_certificate&#x27;</span>] = <span class="string">&quot;/etc/gitlab/ssl/server.crt&quot;</span></span><br><span class="line">nginx[<span class="string">&#x27;ssl_certificate_key&#x27;</span>] = <span class="string">&quot;/etc/gitlab/ssl/server.key&quot;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h3 id="应用配置"><a href="#应用配置" class="headerlink" title="应用配置"></a>应用配置</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 使配置生效</span></span><br><span class="line">sudo gitlab-ctl reconfigure</span><br><span class="line"></span><br><span class="line"><span class="comment"># 开启gitlab</span></span><br><span class="line">sudo gitlab-ctl start</span><br><span class="line"></span><br><span class="line"><span class="comment"># 查看状态</span></span><br><span class="line">sudo gitlab-ctl status</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="GitLab-备份升级迁移"><a href="#GitLab-备份升级迁移" class="headerlink" title="GitLab 备份升级迁移"></a>GitLab 备份升级迁移</h2><h3 id="GitLab-备份"><a href="#GitLab-备份" class="headerlink" title="GitLab 备份"></a>GitLab 备份</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line">ansible-rhel7.4@JQ/opt/gitlab/etc<span class="comment">#gitlab-rake gitlab:backup:create</span></span><br><span class="line">Dumping database ... </span><br><span class="line">Dumping PostgreSQL database gitlabhq_production ... [DONE]</span><br><span class="line"><span class="keyword">done</span></span><br><span class="line">Dumping repositories ...</span><br><span class="line"> * root/ansible ... [DONE]</span><br><span class="line"> * root/ansible.wiki ...  [SKIPPED]</span><br><span class="line"><span class="keyword">done</span></span><br><span class="line">Dumping uploads ... </span><br><span class="line"><span class="keyword">done</span></span><br><span class="line">Dumping builds ... </span><br><span class="line"><span class="keyword">done</span></span><br><span class="line">Dumping artifacts ... </span><br><span class="line"><span class="keyword">done</span></span><br><span class="line">Dumping pages ... </span><br><span class="line"><span class="keyword">done</span></span><br><span class="line">Dumping lfs objects ... </span><br><span class="line"><span class="keyword">done</span></span><br><span class="line">Dumping container registry images ... </span><br><span class="line">[DISABLED]</span><br><span class="line">Creating backup archive: 1524016954_2018_04_18_10.6.3_gitlab_backup.tar ... <span class="keyword">done</span></span><br><span class="line">Uploading backup archive to remote storage  ... skipped</span><br><span class="line">Deleting tmp directories ... <span class="keyword">done</span></span><br><span class="line"><span class="keyword">done</span></span><br><span class="line"><span class="keyword">done</span></span><br><span class="line"><span class="keyword">done</span></span><br><span class="line"><span class="keyword">done</span></span><br><span class="line"><span class="keyword">done</span></span><br><span class="line"><span class="keyword">done</span></span><br><span class="line"><span class="keyword">done</span></span><br><span class="line">Deleting old backups ... skipping</span><br><span class="line"></span><br><span class="line">ansible-rhel7.4@JQ/opt/gitlab<span class="comment">#cd /var/opt/gitlab/backups</span></span><br><span class="line">ansible-rhel7.4@JQ/var/opt/gitlab/backups<span class="comment">#ll</span></span><br><span class="line">total 22372</span><br><span class="line">-rw------- 1 git git 22906880 Apr 18 10:02 1524016954_2018_04_18_10.6.3_gitlab_backup.tar</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h3 id="GitLab-升级"><a href="#GitLab-升级" class="headerlink" title="GitLab 升级"></a>GitLab 升级</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 停止gitlab相关服务</span></span><br><span class="line">gitlab-ctl stop</span><br><span class="line"></span><br><span class="line"><span class="comment"># 下载离线包升级gitlab，建议不要跨3个以上大版本升级，具体升级方案请参考官方文档</span></span><br><span class="line">rpm -Uvh gitlab-ce-10.6.3-ce.0.el7.x86_64.rpm</span><br><span class="line"></span><br><span class="line"><span class="comment"># 重新配置gitlab</span></span><br><span class="line">gitlab-ctl reconfigure</span><br><span class="line"></span><br><span class="line"><span class="comment"># 启动gitlab</span></span><br><span class="line">gitlab-ctl start</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h3 id="GitLab-迁移"><a href="#GitLab-迁移" class="headerlink" title="GitLab 迁移"></a>GitLab 迁移</h3><ol>
<li>GitLab 迁移的前提是新旧机器GitLab版本必须一致</li>
<li>在旧机器备份,默认会在&#x2F;var&#x2F;opt&#x2F;gitlab&#x2F;backups&#x2F; 创建备份文件#gitlab-rake gitlab:backup:create</li>
<li>复制备份文件到新机器 &#x2F;var&#x2F;opt&#x2F;gitlab&#x2F;backups&#x2F;</li>
<li>在新机器运行下面命令,停止相关数据连接服务,然后从备份文件恢复</li>
<li>启动gitlab</li>
</ol>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 停止gitlab</span></span><br><span class="line">gitlab-ctl stop</span><br><span class="line"><span class="comment"># 从1524016954编号备份中恢复</span></span><br><span class="line">gitlab-rake gitlab:backup:restore BACKUP=1524016954 </span><br><span class="line"><span class="comment"># 启动gitlab</span></span><br><span class="line">gitlab-ctl start</span><br></pre></td></tr></table></figure>

<h2 id="GitLab-常见问题"><a href="#GitLab-常见问题" class="headerlink" title="GitLab 常见问题"></a>GitLab 常见问题</h2><h3 id="更改管理员密码"><a href="#更改管理员密码" class="headerlink" title="更改管理员密码"></a>更改管理员密码</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">gitlab-rails console production</span><br><span class="line"></span><br><span class="line">Loading production environment (Rails 4.8.5.2)</span><br><span class="line">irb(main):001:0&gt; user = User.<span class="built_in">where</span>(<span class="built_in">id</span>: 1).first</span><br><span class="line">=&gt; <span class="comment">#&lt;User id: 1, email: &quot;admin@example.com&quot;, ...</span></span><br><span class="line">irb(main):002:0&gt; user.password=123456</span><br><span class="line">=&gt; 123456</span><br><span class="line">irb(main):003:0&gt; user.password_confirmation=123456</span><br><span class="line">=&gt; 123456</span><br><span class="line">irb(main):004:0&gt; user.save!</span><br><span class="line">=&gt; <span class="literal">true</span></span><br><span class="line">irb(main):005:0&gt; quit</span><br></pre></td></tr></table></figure>

<h3 id="The-requested-URL-returned-error-401-while-accessing"><a href="#The-requested-URL-returned-error-401-while-accessing" class="headerlink" title="The requested URL returned error: 401 while accessing"></a>The requested URL returned error: 401 while accessing</h3><blockquote>
<p>这里遇到的问题是因为需要在参数里增加授权后的用户名和密码，不排除可能因为其它问题引起相同报错，如果是403可能是私有仓库没有授权导致</p>
</blockquote>
<p>(ox-zRbE61dW) test101@JQ&#x2F;home&#x2F;ox&#x2F;git$git clone <a target="_blank" rel="noopener" href="http://172.31.96.248/wangao/ansible.git">http://172.31.96.248/wangao/ansible.git</a><br>Initialized empty Git repository in &#x2F;home&#x2F;ox&#x2F;git&#x2F;ansible&#x2F;.git&#x2F;<br>error: The requested URL returned error: 401 while accessing <a target="_blank" rel="noopener" href="http://172.31.96.248/wangao/ansible.git/info/refs">http://172.31.96.248/wangao/ansible.git/info/refs</a></p>
<p>fatal: HTTP request failed<br>(ox-zRbE61dW) test101@JQ&#x2F;home&#x2F;ox&#x2F;git$git clone <a target="_blank" rel="noopener" href="http://guest:xxxxxx@172.31.96.248/wangao/ansible.git">http://guest:xxxxxx@172.31.96.248/wangao/ansible.git</a><br>Initialized empty Git repository in &#x2F;home&#x2F;ox&#x2F;git&#x2F;ansible&#x2F;.git&#x2F;<br>remote: Counting objects: 257, done.<br>remote: Compressing objects: 100% (153&#x2F;153), done.<br>remote: Total 257 (delta 91), reused 254 (delta 91)<br>Receiving objects: 100% (257&#x2F;257), 21.77 MiB | 19.18 MiB&#x2F;s, done.<br>Resolving deltas: 100% (91&#x2F;91), done.<br>(ox-zRbE61dW) test101@JQ&#x2F;home&#x2F;ox&#x2F;git$</p>
<h3 id="webhooks不生效"><a href="#webhooks不生效" class="headerlink" title="webhooks不生效"></a>webhooks不生效</h3><p><a target="_blank" rel="noopener" href="https://gitlab.com/gitlab-org/gitlab-ce/issues/45334">https://gitlab.com/gitlab-org/gitlab-ce/issues/45334</a><br><a target="_blank" rel="noopener" href="https://gitlab.com/gitlab-org/omnibus-gitlab/issues/3307#note_64245578">https://gitlab.com/gitlab-org/omnibus-gitlab/issues/3307#note_64245578</a></p>
<p>Admin Area - Settings - Outbound request - 勾选以下内容<br>Allow request to the local network from hooks and services</p>
<p><img src="https://www.ilanni.com/wp-content/uploads/2018/04/clip_image011_thumb-1.png"></p>
  
	</div>
		<footer class="article-footer clearfix">
<div class="article-catetags">

<div class="article-categories">
  <span></span>
  <a class="article-category-link" href="/categories/%E5%AD%A6%E4%B9%A0-Study/">学习 | Study</a>
</div>


</div>



	<div class="article-share" id="share">
	
	  <div data-url="https://wsgzao.github.io/post/gitlab/" data-title="RHEL7/CentOS7在线和离线安装GitLab配置使用实践 | HelloDog" data-tsina="" class="share clearfix">
	  </div>
	
	</div>


</footer>

   	       
	</article>
	
<nav class="article-nav clearfix">
 
 <div class="prev" >
 <a href="/post/hexo-jacman/" title="Jacman基于Pacman修改的Hexo主题">
  <strong>上一篇：</strong><br/>
  <span>
  Jacman基于Pacman修改的Hexo主题</span>
</a>
</div>


<div class="next">
<a href="/post/pypiserver/"  title="使用pypiserver快速搭建内网离线pypi仓库实践">
 <strong>下一篇：</strong><br/> 
 <span>使用pypiserver快速搭建内网离线pypi仓库实践
</span>
</a>
</div>

</nav>

	

<section id="comments" class="comment">
  <div id="disqus_thread">
    <noscript>Please enable JavaScript to view the <a target="_blank" rel="noopener" href="//disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
  </div>
</section>



</div>  
      <div class="openaside"><a class="navbutton" href="#" title="显示侧边栏"></a></div>

  <div id="toc" class="toc-aside">
  <strong class="toc-title">文章目录</strong>
 
 <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%89%8D%E8%A8%80"><span class="toc-number">1.</span> <span class="toc-text">前言</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%9B%B4%E6%96%B0%E8%AE%B0%E5%BD%95"><span class="toc-number">2.</span> <span class="toc-text">更新记录</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#GitLab%E7%AE%80%E4%BB%8B"><span class="toc-number">3.</span> <span class="toc-text">GitLab简介</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Gitlab%E7%9A%84%E6%9C%8D%E5%8A%A1%E6%9E%84%E6%88%90"><span class="toc-number">3.1.</span> <span class="toc-text">Gitlab的服务构成</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#GitLab%E5%B7%A5%E4%BD%9C%E6%B5%81%E7%A8%8B"><span class="toc-number">3.2.</span> <span class="toc-text">GitLab工作流程</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#GitLab%E5%AE%89%E8%A3%85"><span class="toc-number">4.</span> <span class="toc-text">GitLab安装</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%9F%BA%E7%A1%80%E4%BE%9D%E8%B5%96"><span class="toc-number">4.1.</span> <span class="toc-text">基础依赖</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%9C%A8%E7%BA%BF%E5%AE%89%E8%A3%85gitlab-ce"><span class="toc-number">4.2.</span> <span class="toc-text">在线安装gitlab-ce</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%A6%BB%E7%BA%BF%E5%AE%89%E8%A3%85gitlab-ce"><span class="toc-number">4.3.</span> <span class="toc-text">离线安装gitlab-ce</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#GitLab%E6%B1%89%E5%8C%96"><span class="toc-number">5.</span> <span class="toc-text">GitLab汉化</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#GitLab-%E5%B8%B8%E7%94%A8%E5%91%BD%E4%BB%A4"><span class="toc-number">6.</span> <span class="toc-text">GitLab 常用命令</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%85%AC%E7%BD%91%E9%82%AE%E7%AE%B1%E9%85%8D%E7%BD%AE"><span class="toc-number">7.</span> <span class="toc-text">公网邮箱配置</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#QQ%E4%BC%81%E4%B8%9A%E9%82%AE%E7%AE%B1"><span class="toc-number">7.1.</span> <span class="toc-text">QQ企业邮箱</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#163%E9%82%AE%E7%AE%B1"><span class="toc-number">7.2.</span> <span class="toc-text">163邮箱</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%98%BF%E9%87%8C%E4%BA%91%E4%BC%81%E4%B8%9A%E9%82%AE%E7%AE%B1"><span class="toc-number">7.3.</span> <span class="toc-text">阿里云企业邮箱</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#GitLab%E4%BD%BF%E7%94%A8"><span class="toc-number">8.</span> <span class="toc-text">GitLab使用</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%99%BB%E5%BD%95GitLab"><span class="toc-number">8.1.</span> <span class="toc-text">登录GitLab</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%9B%E5%BB%BAProject"><span class="toc-number">8.2.</span> <span class="toc-text">创建Project</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%AE%80%E5%8D%95%E9%85%8D%E7%BD%AE"><span class="toc-number">8.3.</span> <span class="toc-text">简单配置</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%85%8D%E7%BD%AE-GitLab"><span class="toc-number">9.</span> <span class="toc-text">配置 GitLab</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%AE%BE%E7%BD%AE%E5%A4%96%E9%83%A8%E8%AE%BF%E9%97%AE%E9%93%BE%E6%8E%A5"><span class="toc-number">9.1.</span> <span class="toc-text">设置外部访问链接</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#HTTPS-%E9%85%8D%E7%BD%AE"><span class="toc-number">9.2.</span> <span class="toc-text">HTTPS 配置</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%BA%94%E7%94%A8%E9%85%8D%E7%BD%AE"><span class="toc-number">9.3.</span> <span class="toc-text">应用配置</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#GitLab-%E5%A4%87%E4%BB%BD%E5%8D%87%E7%BA%A7%E8%BF%81%E7%A7%BB"><span class="toc-number">10.</span> <span class="toc-text">GitLab 备份升级迁移</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#GitLab-%E5%A4%87%E4%BB%BD"><span class="toc-number">10.1.</span> <span class="toc-text">GitLab 备份</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#GitLab-%E5%8D%87%E7%BA%A7"><span class="toc-number">10.2.</span> <span class="toc-text">GitLab 升级</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#GitLab-%E8%BF%81%E7%A7%BB"><span class="toc-number">10.3.</span> <span class="toc-text">GitLab 迁移</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#GitLab-%E5%B8%B8%E8%A7%81%E9%97%AE%E9%A2%98"><span class="toc-number">11.</span> <span class="toc-text">GitLab 常见问题</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%9B%B4%E6%94%B9%E7%AE%A1%E7%90%86%E5%91%98%E5%AF%86%E7%A0%81"><span class="toc-number">11.1.</span> <span class="toc-text">更改管理员密码</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#The-requested-URL-returned-error-401-while-accessing"><span class="toc-number">11.2.</span> <span class="toc-text">The requested URL returned error: 401 while accessing</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#webhooks%E4%B8%8D%E7%94%9F%E6%95%88"><span class="toc-number">11.3.</span> <span class="toc-text">webhooks不生效</span></a></li></ol></li></ol>
 
  </div>

<div id="asidepart">
<div class="closeaside"><a class="closebutton" href="#" title="隐藏侧边栏"></a></div>
<aside class="clearfix">

  
<div class="github-card">
<p class="asidetitle">Github 名片</p>
<div class="github-card" data-github="wsgzao" data-theme="medium"></div>
<script type="text/javascript" src="//lab.lepture.com/github-cards/widget.js" ></script>
</div>



  
<div class="categorieslist">
	<p class="asidetitle">分类</p>
		<ul>
		
		  
			<li><a href="/categories/Hexo/" title="Hexo">Hexo<sup>6</sup></a></li>
		  
		
		  
			<li><a href="/categories/学习-Study/" title="学习 | Study">学习 | Study<sup>197</sup></a></li>
		  
		
		  
			<li><a href="/categories/生活-Life/" title="生活 | Life">生活 | Life<sup>33</sup></a></li>
		  
		
		  
			<li><a href="/categories/软件-Soft/" title="软件 | Soft">软件 | Soft<sup>5</sup></a></li>
		  
		
		</ul>
</div>


  <div class="linkslist">
  <p class="asidetitle">友情链接</p>
    <ul>
        
          <li>
            
            	<a href="http://wuchong.me" target="_blank" title="Jark&#39;s Blog">Jark&#39;s Blog</a>
            
          </li>
        
          <li>
            
            	<a href="https://www.linkedin.com/in/aowang" target="_blank" title="LinkedIn">LinkedIn</a>
            
          </li>
        
    </ul>
</div>

  <div class="rsspart">
	<a href="/atom.xml" target="_blank" title="rss">RSS 订阅</a>
</div>

</aside>
</div>
    </div>
    <footer><div id="footer" >
	
	<div class="line">
		<span></span>
		<div class="author"></div>
	</div>
	
	
	<section class="info">
		<p> Hello, I&#39;m OX. This is my blog on GitHub. <br/>
			Keep Calm and Carry On.</p>
	</section>
	 
	<div class="social-font" class="clearfix">
		
		
		<a href="https://github.com/wsgzao" target="_blank" class="icon-github" title="github"></a>
		
		
		
		
		
		<a href="https://www.linkedin.com/in/aowang" target="_blank" class="icon-linkedin" title="linkedin"></a>
		
		
		
		
		
	</div>
			
		

		<p class="copyright">
		Powered by <a href="http://hexo.io" target="_blank" title="hexo">hexo</a> and Theme by <a href="https://github.com/wuchong/jacman" target="_blank" title="Jacman">Jacman</a> © 2025 
		
		<a href="/about" target="_blank" title="wsgzao">wsgzao</a>
		
		
		</p>
</div>
</footer>
    <script src="/js/jquery-3.6.4.min.js"></script>
<script src="/js/jquery.imagesloaded.min.js"></script>
<script src="/js/gallery.js"></script>
<script src="/js/jquery-qrcode-0.18.0.min.js"></script>

<script type="text/javascript">
$(document).ready(function(){ 
  $('.navbar').click(function(){
    $('header nav').toggleClass('shownav');
  });
  var myWidth = 0;
  function getSize(){
    if( typeof( window.innerWidth ) == 'number' ) {
      myWidth = window.innerWidth;
    } else if( document.documentElement && document.documentElement.clientWidth) {
      myWidth = document.documentElement.clientWidth;
    };
  };
  var m = $('#main'),
      a = $('#asidepart'),
      c = $('.closeaside'),
      o = $('.openaside');
  c.click(function(){
    a.addClass('fadeOut').css('display', 'none');
    o.css('display', 'block').addClass('fadeIn');
    m.addClass('moveMain');
  });
  o.click(function(){
    o.css('display', 'none').removeClass('beforeFadeIn');
    a.css('display', 'block').removeClass('fadeOut').addClass('fadeIn');      
    m.removeClass('moveMain');
  });
  $(window).scroll(function(){
    o.css("top",Math.max(80,260-$(this).scrollTop()));
  });
  
        getSize();
        if (myWidth >= 1024) {
          c.click();
        }
  
  $(window).resize(function(){
    getSize(); 
    if (myWidth >= 1024) {
      $('header nav').removeClass('shownav');
    }else{
      m.removeClass('moveMain');
      a.css('display', 'block').removeClass('fadeOut');
      o.css('display', 'none');
      
      $('#toc.toc-aside').css('display', 'none');
        
    }
  });
});
</script>

<script type="text/javascript">
$(document).ready(function(){ 
  var ai = $('.article-content>iframe'),
      ae = $('.article-content>embed'),
      t  = $('#toc'),
      ta = $('#toc.toc-aside'),
      o  = $('.openaside'),
      c  = $('.closeaside');
  if(ai.length>0){
    ai.wrap('<div class="video-container" />');
  };
  if(ae.length>0){
   ae.wrap('<div class="video-container" />');
  };
  c.click(function(){
    ta.css('display', 'block').addClass('fadeIn');
  });
  o.click(function(){
    ta.css('display', 'none');
  });
  $(window).scroll(function(){
    ta.css("top",Math.max(140,320-$(this).scrollTop()));
  });
});
</script>


<script type="text/javascript">
$(document).ready(function(){ 
  var $this = $('.share'),
      url = $this.attr('data-url'),
      encodedUrl = encodeURIComponent(url),
      title = $this.attr('data-title'),
      tsina = $this.attr('data-tsina'),
      description = $this.attr('description');
  var html = [
  '<div class="hoverqrcode clearfix"></div>',
  '<a class="overlay" id="qrcode"></a>',
  '<a href="https://www.facebook.com/sharer.php?u=' + encodedUrl + '" class="article-share-facebook" target="_blank" title="Facebook"></a>',
  '<a href="https://twitter.com/intent/tweet?url=' + encodedUrl + '" class="article-share-twitter" target="_blank" title="Twitter"></a>',
  '<a href="#qrcode" class="article-share-qrcode" title="微信"></a>',
  '<a href="http://widget.renren.com/dialog/share?resourceUrl=' + encodedUrl + '&srcUrl=' + encodedUrl + '&title=' + title +'" class="article-share-renren" target="_blank" title="人人"></a>',
  '<a href="http://service.weibo.com/share/share.php?title='+title+'&url='+encodedUrl +'&ralateUid='+ tsina +'&searchPic=true&style=number' +'" class="article-share-weibo" target="_blank" title="微博"></a>',
  '<span title="Share to"></span>'
  ].join('');
  $this.append(html);

  $('.hoverqrcode').hide();

  var myWidth = 0;
  function updatehoverqrcode(){
    if( typeof( window.innerWidth ) == 'number' ) {
      myWidth = window.innerWidth;
    } else if( document.documentElement && document.documentElement.clientWidth) {
      myWidth = document.documentElement.clientWidth;
    };
    var qrsize = myWidth > 1024 ? 200:100;
    var options = {render: 'image', size: qrsize, fill: '#2ca6cb', text: url, radius: 0.5, quiet: 1};
    var p = $('.article-share-qrcode').position();
    $('.hoverqrcode').empty().css('width', qrsize).css('height', qrsize)
                          .css('left', p.left-qrsize/2+20).css('top', p.top-qrsize-10)
                          .qrcode(options);
  };
  $(window).resize(function(){
    $('.hoverqrcode').hide();
  });
  $('.article-share-qrcode').click(function(){
    updatehoverqrcode();
    $('.hoverqrcode').toggle();
  });
  $('.article-share-qrcode').hover(function(){}, function(){
      $('.hoverqrcode').hide();
  });
});   
</script>




<script type="text/javascript">

var disqus_shortname = 'wsgzao';

(function(){
  var dsq = document.createElement('script');
  dsq.type = 'text/javascript';
  dsq.async = true;
  dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
  (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
}());
(function(){
  var dsq = document.createElement('script');
  dsq.type = 'text/javascript';
  dsq.async = true;
  dsq.src = '//' + disqus_shortname + '.disqus.com/count.js';
  (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
}());
</script>








<link rel="stylesheet" href="/fancybox/jquery.fancybox.css" media="screen" type="text/css">
<script src="/fancybox/jquery.fancybox.pack.js"></script>
<script type="text/javascript">
$(document).ready(function(){ 
  $('.article-content').each(function(i){
    $(this).find('img').each(function(){
      if ($(this).parent().hasClass('fancybox')) return;
      var alt = this.alt;
      if (alt) $(this).after('<span class="caption">' + alt + '</span>');
      $(this).wrap('<a href="' + this.src + '" title="' + alt + '" class="fancybox"></a>');
    });
    $(this).find('.fancybox').each(function(){
      $(this).attr('rel', 'article' + i);
    });
  });
  if($.fancybox){
    $('.fancybox').fancybox();
  }
}); 
</script>



<!-- Analytics Begin -->

<script type="text/javascript">
(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','//www.google-analytics.com/analytics.js','ga');
ga('create', 'UA-77732745-1', 'wsgzao.github.io');  
ga('send', 'pageview');
</script>



<script>
var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = "//hm.baidu.com/hm.js?c2c5fc7d844d0973d9f77abd87f49c3c";
  var s = document.getElementsByTagName("script")[0]; 
  s.parentNode.insertBefore(hm, s);
})();
</script>



<!-- Analytics End -->

<!-- Totop Begin -->

	<div id="totop">
	<a title="返回顶部"><img src="/img/scrollup.png"/></a>
	</div>
	<script src="/js/totop.js"></script>

<!-- Totop End -->

<!-- MathJax Begin -->
<!-- mathjax config similar to math.stackexchange -->


<!-- MathJax End -->

<!-- swiftype Begin -->

<script type="text/javascript">
  (function(w,d,t,u,n,s,e){w['SwiftypeObject']=n;w[n]=w[n]||function(){
  (w[n].q=w[n].q||[]).push(arguments);};s=d.createElement(t);
  e=d.getElementsByTagName(t)[0];s.async=1;s.src=u;e.parentNode.insertBefore(s,e);
  })(window,document,'script','//s.swiftypecdn.com/install/v2/st.js','_st');

  _st('install','_4qDmKrBPn9Es3UvQHT4','2.0.0');
</script>

<!-- swiftype End -->

  </body>
</html>
