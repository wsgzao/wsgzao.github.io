
 <!DOCTYPE HTML>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <script type="text/javascript">
    var host = "wsgzao.github.io";
    if ((host == window.location.host) && (window.location.protocol != "https:"))
        window.location.protocol = "https";
  </script> 
<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-LJ3PMGPVCK"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-LJ3PMGPVCK');
</script>
  
    <title>如何使用 MTR 诊断网络问题 | HelloDog</title>
    <meta name="viewport" content="width=device-width, initial-scale=1,user-scalable=no">
    
    <meta name="author" content="wsgzao">
    

    
    <meta name="description" content="使用 MTR 诊断网络问题">
<meta property="og:type" content="article">
<meta property="og:title" content="如何使用 MTR 诊断网络问题">
<meta property="og:url" content="https://wsgzao.github.io/post/mtr/index.html">
<meta property="og:site_name" content="HelloDog">
<meta property="og:description" content="使用 MTR 诊断网络问题">
<meta property="og:locale" content="zh-CN">
<meta property="og:updated_time" content="2019-10-23T09:18:09.000Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="如何使用 MTR 诊断网络问题">
<meta name="twitter:description" content="使用 MTR 诊断网络问题">

    
    <link rel="alternative" href="/atom.xml" title="HelloDog" type="application/atom+xml">
    
    
    <link rel="icon" href="/img/favicon.ico">
    
    
    <link rel="apple-touch-icon" href="/img/jacman.jpg">
    <link rel="apple-touch-icon-precomposed" href="/img/jacman.jpg">
    
    <link rel="stylesheet" href="/css/style.css">
</head>

  <body>
    <header>
      
<div>
		
			<div id="imglogo">
				<a href="/"><img src="/img/logo.png" alt="HelloDog" title="HelloDog"/></a>
			</div>
			
			<div id="textlogo">
				<h1 class="site-name"><a href="/" title="HelloDog">HelloDog</a></h1>
				<h2 class="blog-motto">Keep Calm and Carry On</h2>
			</div>
			<div class="navbar"><a class="navbutton navmobile" href="#" title="菜单">
			</a></div>
			<nav class="animated">
				<ul>
					<ul>
					 
						<li><a href="/">主页 | Home</a></li>
					
						<li><a href="/index/">索引 | Index</a></li>
					
						<li><a href="/archives/">归档 | Archives</a></li>
					
						<li><a href="/about/">简介 | About</a></li>
					
					<li>
 					
						<form class="search">
							<label>Search</label>
						<input type="text" id="search" class="st-default-search-input" name="q" size="30" placeholder="搜索"><br>
						</form>
					
					</li>
				</ul>
			</nav>			
</div>
    </header>
    <div id="container">
      <div id="main" class="post" itemscope itemprop="blogPost">
  
	<article itemprop="articleBody"> 
		<header class="article-info clearfix">
  <h1 itemprop="name">
    
      <a href="/post/mtr/" title="如何使用 MTR 诊断网络问题" itemprop="url">如何使用 MTR 诊断网络问题</a>
  </h1>
  <p class="article-author">By
       
		<a href="/about" title="wsgzao" target="_blank" itemprop="author">wsgzao</a>
		
  <p class="article-time">
    <time datetime="2019-10-22T06:59:49.000Z" itemprop="datePublished"> 发表于 2019-10-22</time>
    
  </p>
</header>
	<div class="article-content">
<!-- 		
		<div id="toc" class="toc-article">
			<strong class="toc-title">文章目录</strong>
		
			<ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#前言"><span class="toc-number">1.</span> <span class="toc-text">前言</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#更新历史"><span class="toc-number">2.</span> <span class="toc-text">更新历史</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#网络诊断相关的背景知识"><span class="toc-number">3.</span> <span class="toc-text">网络诊断相关的背景知识</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#名词解释"><span class="toc-number">4.</span> <span class="toc-text">名词解释</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#ping"><span class="toc-number">5.</span> <span class="toc-text">ping</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#安装-MTR"><span class="toc-number">6.</span> <span class="toc-text">安装 MTR</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#如何读懂-MTR-报告"><span class="toc-number">7.</span> <span class="toc-text">如何读懂 MTR 报告</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#分析-MTR-报告"><span class="toc-number">8.</span> <span class="toc-text">分析 MTR 报告</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#确定丢包率"><span class="toc-number">8.1.</span> <span class="toc-text">确定丢包率</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#读懂网络延迟"><span class="toc-number">8.2.</span> <span class="toc-text">读懂网络延迟</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#常见的-MTR-报告类型"><span class="toc-number">9.</span> <span class="toc-text">常见的 MTR 报告类型</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#目的主机网络配置不当"><span class="toc-number">9.1.</span> <span class="toc-text">目的主机网络配置不当</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#家庭或办公室路由器的原因"><span class="toc-number">9.2.</span> <span class="toc-text">家庭或办公室路由器的原因</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#运营商的路由器没有正确配置"><span class="toc-number">9.3.</span> <span class="toc-text">运营商的路由器没有正确配置</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#ICMP-速率限制"><span class="toc-number">9.4.</span> <span class="toc-text">ICMP 速率限制</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#超时"><span class="toc-number">9.5.</span> <span class="toc-text">超时</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#MTR-客户端"><span class="toc-number">10.</span> <span class="toc-text">MTR 客户端</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#MTR-使用小结"><span class="toc-number">11.</span> <span class="toc-text">MTR 使用小结</span></a></li></ol>
		
		</div>
		 -->
		<h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>MTR 是一款强大的网络诊断工具，网络管理员使用 MTR 可以诊断和隔离网络问题，并且为上游 ISP 提供有用的网络状态报告。MTR 是传统 traceroute 命令的进化版，并且可以提供强大的数据样本，因为他集合了 traceroute 和 ping 这两个命令的精华。本文带您深入了解 MTR ，从数据如何生成，到如果正确理解报告样本并得出相应的结论。</p>
<blockquote>
<p>使用 MTR 诊断网络问题</p>
</blockquote>
<h2 id="更新历史"><a href="#更新历史" class="headerlink" title="更新历史"></a>更新历史</h2><p>2019 年 10 月 23 日 - 增加 iOS 和 Android 客户端的 MTR APP<br>2019 年 01 月 22 日 - 初稿</p>
<p>阅读原文 - <a href="https://wsgzao.github.io/post/mtr/">https://wsgzao.github.io/post/mtr/</a></p>
<p><strong> 扩展阅读 </strong></p>
<p>MTR - <a href="http://www.bitwizard.nl/mtr/" target="_blank" rel="noopener">http://www.bitwizard.nl/mtr/</a><br>Diagnosing Network Issues with MTR - <a href="https://www.linode.com/docs/networking/diagnostics/diagnosing-network-issues-with-mtr/" target="_blank" rel="noopener">https://www.linode.com/docs/networking/diagnostics/diagnosing-network-issues-with-mtr/</a></p>
<hr>
<h2 id="网络诊断相关的背景知识"><a href="#网络诊断相关的背景知识" class="headerlink" title="网络诊断相关的背景知识"></a>网络诊断相关的背景知识</h2><p>Networking diagnostic tools including ping, traceroute, and mtr use Internet Control Message Protocol (ICMP) packets to test contention and traffic between two points on the Internet. When a user pings a host on the Internet, a series of ICMP packets are sent to the host, which responds by sending packets in return. The user’s client is then able to compute the round trip time between two points on the Internet.</p>
<p>In contrast, tools such as traceroute and MTR send ICMP packets with incrementally increasing TTLs in order to view the route or series of hops that the packet makes between the origin and its destination. The TTL, or time to live, controls how many hops a packet will make before “dying” and returning to the host. By sending a series of packets and causing them to return after one hop, then two, then three, MTR is able to assemble the route that traffic takes between hosts on the Internet.</p>
<p>Rather than provide a simple outline of the route that traffic takes across the Internet, MTR collects additional information regarding the state, connection, and responsiveness of the intermediate hosts. Because of this additional information, MTR can provide a complete overview of the connection between two hosts on the Internet. The following sections outline how to install the MTR software and how to interpret the results provided by this tool.</p>
<p>网络诊断工具 例如 ping traceroute mtr 都使用的 “ICMP” 包来测试 Internet 两点之间的网络连接状况。当用户使用 ping 命令 ping 网络上的主机后， ICMP 包将会发送到目的主机，然后在目的主机返回响应。这样，就可以得知本机到目的主机 ICMP 包传输所使用的往返时间。</p>
<p>相对于其他命令仅仅收集传输路径或响应时间，MTR 工具会收集更多的信息，比如 连接状态，连接可用性，以及传输路径中主机的响应性。由于这些额外的信息，我们建议您尽可能完整的展现 Internet 两个主机之间的网络连接信息。接下来我们讲述如何安装 MTR 软件，以及如何看懂这款软件的输出结果。</p>
<p>Diagnostics and Testing - <a href="https://www.linode.com/docs/networking/diagnostics/" target="_blank" rel="noopener">https://www.linode.com/docs/networking/diagnostics/</a></p>
<h2 id="名词解释"><a href="#名词解释" class="headerlink" title="名词解释"></a>名词解释</h2><p>ICMP(Internet Control Message Protocol)<br>IP 协议族的一员，主要用于网络设备间发送错误指示信息, 一般不用于传输数据，常见部署在用户端网络程序中，诸如 traceroute 或 ping 等程序</p>
<p>TTL(Time To Live)<br>此处的 Time 表示的是次数，而不是时间，表达的是一个包在结束之前还能经过的跳数</p>
<p>Hop<br>跳数: 网络中两个端路径上的节点，路由器的数目</p>
<p>ISP(Internet Service Provider)<br>互联网服务提供商</p>
<h2 id="ping"><a href="#ping" class="headerlink" title="ping"></a>ping</h2><p>ping send ICMP ECHO_REQUEST to network hosts</p>
<p>ICMP 是（Internet Control Message Protocol）Internet 控制报文协议。它是 TCP/IP 协议族的一个子协议，用于在 IP 主机、路由器之间传递控制消息。控制消息是指网络通不通、主机是否可达、路由是否可用等网络本身的消息。这些控制消息虽然并不传输用户数据，但是对于用户数据的传递起着重要的作用。</p>
<p>使用 ping 检查连通性有六个步骤：</p>
<ol>
<li>使用 ifconfig 观察本地网络设置是否正确；</li>
<li>ping 127.0.0.1，127.0.0.1 回送地址 Ping 回送地址是为了检查本地的 TCP/IP 协议有没有设置好；</li>
<li>ping 本机 IP 地址，这样是为了检查本机的 IP 地址是否设置有误；</li>
<li>ping 本网网关或本网 IP 地址，这样的是为了检查硬件设备是否有问题，也可以检查本机与本地网络连接是否正常；(在非局域网中这一步骤可以忽略)</li>
<li>ping 本地 DNS 地址，这样做是为了检查 DNS 是否能够将 IP 正确解析。注: /etc/resolv.conf 文件，”nameserver 8.8.8.8” 指定了 dns 服务器的地址，如果启用了 NetworkManager 要注意网卡重启或服务器重启配置被覆盖的问题；</li>
<li>ping 远程 IP 地址，这主要是检查本网或本机与外部的连接是否正常。</li>
</ol>
<h2 id="安装-MTR"><a href="#安装-MTR" class="headerlink" title="安装 MTR"></a>安装 MTR</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># CentOS</span></span><br><span class="line">yum install mtr</span><br><span class="line"><span class="comment"># Ubuntu</span></span><br><span class="line">apt-get install mtr</span><br><span class="line"><span class="comment"># macOS</span></span><br><span class="line">brew install mtr</span><br><span class="line"><span class="comment"># Windows</span></span><br><span class="line">BestTrace - https://www.ipip.net/product/client.html</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Usage:</span><br><span class="line"> mtr [options] hostname</span><br><span class="line"></span><br><span class="line"> -F, --filename FILE        <span class="built_in">read</span> hostname(s) from a file</span><br><span class="line"> -4                         use IPv4 only</span><br><span class="line"> -6                         use IPv6 only</span><br><span class="line"> -u, --udp                  use UDP instead of ICMP <span class="built_in">echo</span></span><br><span class="line"> -T, --tcp                  use TCP instead of ICMP <span class="built_in">echo</span></span><br><span class="line"> -a, --address ADDRESS      <span class="built_in">bind</span> the outgoing socket to ADDRESS</span><br><span class="line"> -f, --first-ttl NUMBER     <span class="built_in">set</span> what TTL to start</span><br><span class="line"> -m, --max-ttl NUMBER       maximum number of hops</span><br><span class="line"> -U, --max-unknown NUMBER   maximum unknown host</span><br><span class="line"> -P, --port PORT            target port number <span class="keyword">for</span> TCP, SCTP, or UDP</span><br><span class="line"> -L, --localport LOCALPORT  <span class="built_in">source</span> port number <span class="keyword">for</span> UDP</span><br><span class="line"> -s, --psize PACKETSIZE     <span class="built_in">set</span> the packet size used <span class="keyword">for</span> probing</span><br><span class="line"> -B, --bitpattern NUMBER    <span class="built_in">set</span> bit pattern to use <span class="keyword">in</span> payload</span><br><span class="line"> -i, --interval SECONDS     ICMP <span class="built_in">echo</span> request interval</span><br><span class="line"> -G, --gracetime SECONDS    number of seconds to <span class="built_in">wait</span> <span class="keyword">for</span> responses</span><br><span class="line"> -Q, --tos NUMBER           <span class="built_in">type</span> of service field <span class="keyword">in</span> IP header</span><br><span class="line"> -e, --mpls                 display information from ICMP extensions</span><br><span class="line"> -Z, --timeout SECONDS      seconds to keep probe sockets open</span><br><span class="line"> -r, --report               output using report mode</span><br><span class="line"> -w, --report-wide          output wide report</span><br><span class="line"> -c, --report-cycles COUNT  <span class="built_in">set</span> the number of pings sent</span><br><span class="line"> -j, --json                 output json</span><br><span class="line"> -x, --xml                  output xml</span><br><span class="line"> -C, --csv                  output comma separated values</span><br><span class="line"> -l, --raw                  output raw format</span><br><span class="line"> -p, --split                split output</span><br><span class="line"> -t, --curses               use curses terminal interface</span><br><span class="line">     --displaymode MODE     select initial display mode</span><br><span class="line"> -n, --no-dns               <span class="keyword">do</span> not resove host names</span><br><span class="line"> -b, --show-ips             show IP numbers and host names</span><br><span class="line"> -o, --order FIELDS         select output fields</span><br><span class="line"> -y, --ipinfo NUMBER        select IP information <span class="keyword">in</span> output</span><br><span class="line"> -z, --aslookup             display AS number</span><br><span class="line"> -h, --<span class="built_in">help</span>                 display this <span class="built_in">help</span> and <span class="built_in">exit</span></span><br><span class="line"> -v, --version              output version information and <span class="built_in">exit</span></span><br></pre></td></tr></table></figure>
<h2 id="如何读懂-MTR-报告"><a href="#如何读懂-MTR-报告" class="headerlink" title="如何读懂 MTR 报告"></a>如何读懂 MTR 报告</h2><p>因为 MTR 报告包括了丰富的信息，新手第一次阅读有点困难。下面是我本地到 google.com 的测试报告</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">[root@sg-gop-10-65-200-186 wangao]<span class="comment"># mtr -r google.com</span></span><br><span class="line">Start: Wed Jan 23 16:00:30 2019</span><br><span class="line">HOST: sg-gop-10-65-200-186        Loss%   Snt   Last   Avg  Best  Wrst StDev</span><br><span class="line">  1.|-- 10.65.200.20               0.0%    10    0.3   0.3   0.3   0.5   0.0</span><br><span class="line">  2.|-- ns9.webhostsg.com          0.0%    10    1.0   0.9   0.9   1.0   0.0</span><br><span class="line">  3.|-- 192.168.3.33               0.0%    10    0.9   0.9   0.8   0.9   0.0</span><br><span class="line">  4.|-- vlan242-s4rsm.starhub.net  0.0%    10    1.6   1.8   1.6   1.9   0.0</span><br><span class="line">  5.|-- ancoretl02.starhub.net.sg  0.0%    10    2.0   2.0   1.9   2.1   0.0</span><br><span class="line">  6.|-- anutli12.starhub.net.sg    0.0%    10    1.9   2.1   1.9   3.1   0.3</span><br><span class="line">  7.|-- 72.14.194.0                0.0%    10    2.5   2.7   2.4   4.3   0.5</span><br><span class="line">  8.|-- 74.125.242.35              0.0%    10    2.5   2.5   2.4   2.7   0.0</span><br><span class="line">  9.|-- 216.239.49.74              0.0%    10    3.4   4.4   3.3  12.0   2.6</span><br><span class="line"> 10.|-- 74.125.252.254             0.0%    10    3.7   3.7   3.5   3.9   0.0</span><br><span class="line"> 11.|-- 108.170.233.49             0.0%    10    4.4   4.2   4.0   4.7   0.0</span><br><span class="line"> 12.|-- ???                       100.0    10    0.0   0.0   0.0   0.0   0.0</span><br></pre></td></tr></table></figure>
<p>返回结果各列数据说明：</p>
<p>第一列: 显示的是 IP 地址或本机域名，这点和 traceroute 很像</p>
<p>第二列: Loss% 到达此节点的数据包丢包率，显示的每个对应 IP 的丢包率。</p>
<p>第三列: Snt:100 设置发送数据包的数量，默认值是 10 通过参数 -c 来自定义数量。</p>
<p>第四列: Last 显示的最近一次的返回时延</p>
<p>第五列: Avg 平均值这个应该是发送 ping 包的平均时延</p>
<p>第六列: Best 最好或者说时延最低的</p>
<p>第七列: Wrst 最差或者说时延最大的</p>
<p>第八列: StDev 是标准偏差</p>
<p>使用 mtr –report google.com 命令来输出这篇报告。使用 report 选项可以给 google.com 主机发送 10 个 ICMP 包，然后输出报告。如果我们不使用 –report 参数， mtr 会不断的动态运行。在动态模式下， mtr 的输出结果表述每个主机的往返时间。大多数情况下，使用 –report 参数就可以提供足够的数据了。</p>
<p>在命令下面，就是 MTR 产生的输出报告 。在通常情况下， MTR 需要几秒钟的时间来输出报告，但是偶尔可能需要更长的时间。MTR 报告是由一系列跳数组成的（在上述例子中是 12 跳）。“跳” 意味着节点，或路由器，数据包通过它们才能到达目的主机。在上面例子中，数据包经过本地网络的 “内层” 和 “外层”，然后再到一系列的域名主机。主机的域名是通过反向 DNS 查找确定的。如果您想忽略 DNS 查找，您可以使用 –no-dns 参数，使用 –no-dns 参数后，报告结果如下：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">[root@sg-gop-10-65-200-186 wangao]<span class="comment"># mtr -rn google.com</span></span><br><span class="line">Start: Wed Jan 23 16:01:02 2019</span><br><span class="line">HOST: sg-gop-10-65-200-186        Loss%   Snt   Last   Avg  Best  Wrst StDev</span><br><span class="line">  1.|-- 10.65.200.20               0.0%    10    0.2   0.3   0.2   0.3   0.0</span><br><span class="line">  2.|-- 203.117.178.28             0.0%    10    0.8   0.9   0.8   1.1   0.0</span><br><span class="line">  3.|-- 192.168.3.33               0.0%    10    0.8   0.8   0.7   0.9   0.0</span><br><span class="line">  4.|-- 203.117.6.21               0.0%    10    1.8   1.8   1.6   1.9   0.0</span><br><span class="line">  5.|-- 203.118.15.177             0.0%    10    1.8   1.9   1.8   2.1   0.0</span><br><span class="line">  6.|-- 203.118.12.10              0.0%    10    1.9   1.9   1.8   2.1   0.0</span><br><span class="line">  7.|-- 72.14.194.0                0.0%    10    2.4   2.5   2.4   2.7   0.0</span><br><span class="line">  8.|-- 74.125.242.35              0.0%    10    2.6   4.7   2.5  12.6   3.8</span><br><span class="line">  9.|-- 216.239.49.74              0.0%    10    3.5   3.5   3.3   4.0   0.0</span><br><span class="line"> 10.|-- 74.125.252.254             0.0%    10    3.7   4.1   3.7   6.6   0.8</span><br><span class="line"> 11.|-- 108.170.233.49             0.0%    10    4.3   4.4   4.2   4.7   0.0</span><br><span class="line"> 12.|-- ???                       100.0    10    0.0   0.0   0.0   0.0   0.0</span><br></pre></td></tr></table></figure>
<p>当我们研究 MTR 报告时候，最好找出每一跳的任何问题。除了可以查看两个服务器之间的路径之外，MTR 在它的七列数据中提供了很多有价值的数据统计报告。 Loss% 列展示了数据包在每一跳的丢失率。 Snt 列记录的多少个数据包被送出。 使用 –report 参数默认会送出 10 个数据包。如果使用 –report-cycles=[number-of-packets] 选项，MTR 就会按照 [number-of-packets] 指定的数量发出 ICMP 数据包。</p>
<p>Last, Avg, Best 和 Wrst 列都标识数据包往返的时间，使用的是毫秒（ ms ）单位表示。 Last 表示最后一个数据包所用的时间， Avg 表示评价时间， Best 和 Wrst 表示最小和最大时间。在大多数情况下，平均时间（ Avg）列需要我们特别注意。</p>
<p>最后一列 StDev 提供了数据包在每个主机的标准偏差。如果标准偏差越高，说明数据包在这个节点的延时越不相同。标准偏差会让您了解到平均延时是否是真的延时时间的中心点，或者测量数据受到某些问题的干扰。</p>
<p>例如，如果标准偏差很大，说明数据包的延迟是不确定的。一些数据包延迟很小（例如：25ms），另一些数据包延迟很大（例如：350ms）。当 10 个数据包全部发出后，得到的平均延迟可能是正常的，但是平均延迟是不能很好的反应实际情况的。如果标准偏差很高，使用最好和最坏的延迟来确定平均延迟是一个较好的方案。</p>
<p>在大多数情况下，您可以把 MTR 的输出分成三大块。根据配置，第二或第三跳一般都是您的本地 ISP，倒数第二或第三跳一般为您目的主机的 ISP。中间的节点是数据包经过的路由器。</p>
<h2 id="分析-MTR-报告"><a href="#分析-MTR-报告" class="headerlink" title="分析 MTR 报告"></a>分析 MTR 报告</h2><p>核心的两个参数:</p>
<ul>
<li>loss 丢包率</li>
<li>latency 延迟</li>
</ul>
<h3 id="确定丢包率"><a href="#确定丢包率" class="headerlink" title="确定丢包率"></a>确定丢包率</h3><p>当分析 MTR 的输出时，您需要注意两点： loss 和 latency。首先，让我们讨论一下 loss。如果您在任何一跳上看到 loss 的百分比，这就说明这一跳上可能有问题了。当然，很多服务提供商人为限制 ICMP 发送的速率，这也会导致此问题。那么如何才能指定是人为的限制 ICMP 传输还是确定有丢包的现象？我们需要查看下一跳。如果下一跳没有丢包现象，说明上一条是人为限制的。如下示例：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">root@localhost:~<span class="comment"># mtr --report www.google.com</span></span><br><span class="line">HOST: example               Loss%   Snt   Last   Avg  Best  Wrst StDev</span><br><span class="line">1. 63.247.74.43                  0.0%    10    0.3   0.6   0.3   1.2   0.3</span><br><span class="line">2. 63.247.64.157                50.0%    10    0.4   1.0   0.4   6.1   1.8</span><br><span class="line">3. 209.51.130.213                0.0%    10    0.8   2.7   0.8  19.0   5.7</span><br><span class="line">4. aix.pr1.atl.google.com        0.0%    10    6.7   6.8   6.7   6.9   0.1</span><br><span class="line">5. 72.14.233.56                  0.0%    10    7.2   8.3   7.1  16.4   2.9</span><br><span class="line">6. 209.85.254.247                0.0%    10   39.1  39.4  39.1  39.7   0.2</span><br><span class="line">7. 64.233.174.46                 0.0%    10   39.6  40.4  39.4  46.9   2.3</span><br><span class="line">8. gw-in-f147.1e100.net          0.0%    10   39.6  40.5  39.5  46.7   2.2</span><br></pre></td></tr></table></figure>
<p>在此例中，第二跳发生了丢包现象，但是接下来几条都没任何丢包现象，说明第二跳的丢包是人为限制的。如果在接下来的几条中都有丢包，那就可能是第二跳有问题了。请记住，ICMP 包的速率限制和丢失可能会同时发生。如果发生包的丢失情况，我们要用最低百分比来衡量时间情况。为什么这么说呢？请看如下示例：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">root@localhost:~<span class="comment"># mtr --report www.google.com</span></span><br><span class="line">HOST: localhost                   Loss%   Snt   Last   Avg  Best  Wrst StDev</span><br><span class="line">1. 63.247.74.43                   0.0%    10    0.3   0.6   0.3   1.2   0.3</span><br><span class="line">2. 63.247.64.157                  0.0%    10    0.4   1.0   0.4   6.1   1.8</span><br><span class="line">3. 209.51.130.213                60.0%    10    0.8   2.7   0.8  19.0   5.7</span><br><span class="line">4. aix.pr1.atl.google.com        60.0%    10    6.7   6.8   6.7   6.9   0.1</span><br><span class="line">5. 72.14.233.56                  50.0%   10    7.2   8.3   7.1  16.4   2.9</span><br><span class="line">6. 209.85.254.247                40.0%   10   39.1  39.4  39.1  39.7   0.2</span><br><span class="line">7. 64.233.174.46                 40.0%   10   39.6  40.4  39.4  46.9   2.3</span><br><span class="line">8. gw-in-f147.1e100.net          40.0%   10   39.6  40.5  39.5  46.7   2.2</span><br></pre></td></tr></table></figure>
<p>在这个例子中，您可以看打 第 3 跳和第 4 跳都有 60% 的丢包率，从接下来的几跳都有丢包现象，所以不像是人为限制 ICMP 速率的原因。但是最后几跳都是 40% 的丢包率，我们可以猜测到 60% 的丢包率除了网络糟糕的原因之前还有人为限制 ICMP。所以，当我们看到不同的丢包率时，通常要以最后几跳为准。</p>
<p>还有很多时候问题是在数据包返回途中发生的。数据包可以成功的到达目的主机，但是返回过程中遇到 “困难” 了。所以，当问题发生后，我们通常需要收集反方向的 MTR 报告。</p>
<p>此外，互联网设施的维护或短暂的网络拥挤可能会带来短暂的丢包率，当出现短暂的 10% 丢包率时候，不必担心，应用层的程序会弥补这点损失。</p>
<h3 id="读懂网络延迟"><a href="#读懂网络延迟" class="headerlink" title="读懂网络延迟"></a>读懂网络延迟</h3><p>除了可以通过 MTR 报告看到丢包率，我们还可以看到本地到目的主机之间的延时。因为不同的物理位置，延迟通常随着跳数的增加而增加。所以，延迟通常取决于节点之间的物理距离和线路质量。</p>
<p>例如，在同样的传输距离下，dial-up 连接比 cable modem 连接有更大的延迟。如下示例中显示 MTR 报告：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">root@localhost:~<span class="comment"># mtr --report www.google.com</span></span><br><span class="line">HOST: localhost                   Loss%   Snt   Last   Avg  Best  Wrst StDev</span><br><span class="line">1. 63.247.74.43                  0.0%    10    0.3   0.6   0.3   1.2   0.3</span><br><span class="line">2. 63.247.64.157                 0.0%    10    0.4   1.0   0.4   6.1   1.8</span><br><span class="line">3. 209.51.130.213                0.0%    10    0.8   2.7   0.8  19.0   5.7</span><br><span class="line">4. aix.pr1.atl.google.com        0.0%    10  388.0 360.4 342.1 396.7   0.2</span><br><span class="line">5. 72.14.233.56                  0.0%    10  390.6 360.4 342.1 396.7   0.2</span><br><span class="line">6. 209.85.254.247                0.0%    10  391.6 360.4 342.1 396.7   0.4</span><br><span class="line">7. 64.233.174.46                 0.0%    10  391.8 360.4 342.1 396.7   2.1</span><br><span class="line">8. gw-in-f147.1e100.net          0.0%    10  392.0 360.4 342.1 396.7   1.2</span><br></pre></td></tr></table></figure>
<p>在这份报告中，从第三跳到第四跳的延迟猛增，直接导致了后面的延迟也很大。这可能是因为第四跳的路由器配置不当，或者线路很拥堵的原因。</p>
<p>然而，高延迟并不一定意味着当前路由器有问题。这份报告虽然看到第四跳有点问题，但是数据仍然可以正常达到目的主机并且返回给主机。延迟很大的原因也有可能是在返回过程中引发的。我这份报告我们看不到返回的路径，返回的路径可能是完全不同的线路，所以我们一般要进行双向测试了。</p>
<p>ICMP 速率限制也可能会增加延迟，如下：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">root@localhost:~<span class="comment"># mtr --report www.google.com</span></span><br><span class="line">HOST: localhost                   Loss%   Snt   Last   Avg  Best  Wrst StDev</span><br><span class="line">  1. 63.247.74.43                  0.0%    10    0.3   0.6   0.3   1.2   0.3</span><br><span class="line">  2. 63.247.64.157                 0.0%    10    0.4   1.0   0.4   6.1   1.8</span><br><span class="line">  3. 209.51.130.213                0.0%    10    0.8   2.7   0.8  19.0   5.7</span><br><span class="line">  4. aix.pr1.atl.google.com        0.0%    10    6.7   6.8   6.7   6.9   0.1</span><br><span class="line">  5. 72.14.233.56                  0.0%    10  254.2 250.3 230.1 263.4   2.9</span><br><span class="line">  6. 209.85.254.247                0.0%    10   39.1  39.4  39.1  39.7   0.2</span><br><span class="line">  7. 64.233.174.46                 0.0%    10   39.6  40.4  39.4  46.9   2.3</span><br><span class="line">  8. gw-in-f147.1e100.net          0.0%    10   39.6  40.5  39.5  46.7   2.2</span><br></pre></td></tr></table></figure>
<p>乍一看，第 4 跳和第 5 跳直接的延迟很大。但是第 5 跳之后，延迟又恢复正常了。最后的延迟差不多为 40ms。像这种情况，是不影响实际情况的。因为可能仅仅是第 5 跳设备限制了 ICMP 传输速率的原因。所以我们一般要用最后一跳的实际延迟为准。</p>
<h2 id="常见的-MTR-报告类型"><a href="#常见的-MTR-报告类型" class="headerlink" title="常见的 MTR 报告类型"></a>常见的 MTR 报告类型</h2><p>很多网络问题十分麻烦，并且需要上级网络提供商来帮助。然而，这里有很多常见的 MTR 报告所描述的网络问题。如果您正在经历一些网络问题，并且想诊断出原因，可以参考如下示例：</p>
<h3 id="目的主机网络配置不当"><a href="#目的主机网络配置不当" class="headerlink" title="目的主机网络配置不当"></a>目的主机网络配置不当</h3><p>在下面这个例子中，数据包在目的地出现了 100% 的丢包。乍一看是数据包没有到达，其实未必，很有可能是路由器或主机配置不当。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">root@meiriyitie.com:~<span class="comment"># mtr --report www.google.com</span></span><br><span class="line">HOST: localhost                   Loss%   Snt   Last   Avg  Best  Wrst StDev</span><br><span class="line">  1. 63.247.74.43                  0.0%    10    0.3   0.6   0.3   1.2   0.3</span><br><span class="line">  2. 63.247.64.157                 0.0%    10    0.4   1.0   0.4   6.1   1.8</span><br><span class="line">  3. 209.51.130.213                0.0%    10    0.8   2.7   0.8  19.0   5.7</span><br><span class="line">  4. aix.pr1.atl.google.com        0.0%    10    6.7   6.8   6.7   6.9   0.1</span><br><span class="line">  5. 72.14.233.56                  0.0%    10    7.2   8.3   7.1  16.4   2.9</span><br><span class="line">  6. 209.85.254.247                0.0%    10   39.1  39.4  39.1  39.7   0.2</span><br><span class="line">  7. 64.233.174.46                 0.0%    10   39.6  40.4  39.4  46.9   2.3</span><br><span class="line">  8. gw-in-f147.1e100.net         100.0    10    0.0   0.0   0.0   0.0   0.0</span><br></pre></td></tr></table></figure>
<p>MTR 报告数据包没有到达目的主机是因为目的主机没有发送任何应答。这可能是目的主机防火墙的原因，例如： iptables 配置丢掉 ICMP 包所致。</p>
<h3 id="家庭或办公室路由器的原因"><a href="#家庭或办公室路由器的原因" class="headerlink" title="家庭或办公室路由器的原因"></a>家庭或办公室路由器的原因</h3><p>有时候家庭路由器的原因导致 MTR 报告看起来有点误导。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">% mtr --no-dns --report google.com</span><br><span class="line">HOST: deleuze                     Loss%   Snt   Last   Avg  Best  Wrst StDev</span><br><span class="line">  1. 192.168.1.1                   0.0%    10    2.2   2.2   2.0   2.7   0.2</span><br><span class="line">  2. ???                          100.0    10    8.6  11.0   8.4  17.8   3.0</span><br><span class="line">  3. 68.86.210.126                 0.0%    10    9.1  12.1   8.5  24.3   5.2</span><br><span class="line">  4. 68.86.208.22                  0.0%    10   12.2  15.1  11.7  23.4   4.4</span><br><span class="line">  5. 68.85.192.86                  0.0%    10   17.2  14.8  13.2  17.2   1.3</span><br><span class="line">  6. 68.86.90.25                   0.0%    10   14.2  16.4  14.2  20.3   1.9</span><br><span class="line">  7. 68.86.86.194                  0.0%    10   17.6  16.8  15.5  18.1   0.9</span><br><span class="line">  8. 75.149.230.194                0.0%    10   15.0  20.1  15.0  33.8   5.6</span><br><span class="line">  9. 72.14.238.232                 0.0%    10   15.6  18.7  14.1  32.8   5.9</span><br><span class="line"> 10. 209.85.241.148                0.0%    10   16.3  16.9  14.7  21.2   2.2</span><br><span class="line"> 11. 66.249.91.104                 0.0%    10   22.2  18.6  14.2  36.0   6.5</span><br></pre></td></tr></table></figure>
<p>不要为 100% 的丢包率所吓到，这并不表明这里有问题。你可以看打在接下来几跳是没有任何丢包的。</p>
<h3 id="运营商的路由器没有正确配置"><a href="#运营商的路由器没有正确配置" class="headerlink" title="运营商的路由器没有正确配置"></a>运营商的路由器没有正确配置</h3><p>有时候您的运营商的路由器配置原因，导致 ICMP 包永远不能到达目的地，例如：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">root@meiriyitie.com:~<span class="comment"># mtr --report www.google.com</span></span><br><span class="line">HOST: localhost                   Loss%   Snt   Last   Avg  Best  Wrst StDev</span><br><span class="line">  1. 63.247.74.43                  0.0%    10    0.3   0.6   0.3   1.2   0.3</span><br><span class="line">  2. 63.247.64.157                 0.0%    10    0.4   1.0   0.4   6.1   1.8</span><br><span class="line">  3. 209.51.130.213                0.0%    10    0.8   2.7   0.8  19.0   5.7</span><br><span class="line">  4. aix.pr1.atl.google.com        0.0%    10    6.7   6.8   6.7   6.9   0.1</span><br><span class="line">  5. ???                           0.0%    10    0.0   0.0   0.0   0.0   0.0</span><br><span class="line">  6. ???                           0.0%    10    0.0   0.0   0.0   0.0   0.0</span><br><span class="line">  7. ???                           0.0%    10    0.0   0.0   0.0   0.0   0.0</span><br><span class="line">  8. ???                           0.0%    10    0.0   0.0   0.0   0.0   0.0</span><br><span class="line">  9. ???                           0.0%    10    0.0   0.0   0.0   0.0   0.0</span><br><span class="line"> 10. ???                           0.0%    10    0.0   0.0   0.0   0.0   0.0</span><br></pre></td></tr></table></figure>
<p>当没有额外的路由信息时，将会显示问号（???），下面例子也一样：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">root@meiriyitie.com:~<span class="comment"># mtr --report www.google.com</span></span><br><span class="line">HOST: localhost                   Loss%   Snt   Last   Avg  Best  Wrst StDev</span><br><span class="line">   1. 63.247.74.43                 0.0%    10    0.3   0.6   0.3   1.2   0.3</span><br><span class="line">   2. 63.247.64.157                0.0%    10    0.4   1.0   0.4   6.1   1.8</span><br><span class="line">   3. 209.51.130.213               0.0%    10    0.8   2.7   0.8  19.0   5.7</span><br><span class="line">   4. aix.pr1.atl.google.com       0.0%    10    6.7   6.8   6.7   6.9   0.1</span><br><span class="line">   5. 172.16.29.45                 0.0%    10    0.0   0.0   0.0   0.0   0.0</span><br><span class="line">   6. ???                          0.0%    10    0.0   0.0   0.0   0.0   0.0 </span><br><span class="line">   7. ???                          0.0%    10    0.0   0.0   0.0   0.0   0.0</span><br><span class="line">   8. ???                          0.0%    10    0.0   0.0   0.0   0.0   0.0</span><br><span class="line">   9. ???                          0.0%    10    0.0   0.0   0.0   0.0   0.0</span><br><span class="line">  10. ???                          0.0%    10    0.0   0.0   0.0   0.0   0.0</span><br></pre></td></tr></table></figure>
<p>有时候，一个错误配置的路由器，将会在一个环路中不断发送数据包，如下：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">root@meiriyitie.com:~<span class="comment"># mtr --report www.google.com</span></span><br><span class="line">HOST: localhost                   Loss%   Snt   Last   Avg  Best  Wrst StDev</span><br><span class="line">  1. 63.247.74.43                  0.0%    10    0.3   0.6   0.3   1.2   0.3</span><br><span class="line">  2. 63.247.64.157                 0.0%    10    0.4   1.0   0.4   6.1   1.8</span><br><span class="line">  3. 209.51.130.213                0.0%    10    0.8   2.7   0.8  19.0   5.7</span><br><span class="line">  4. aix.pr1.atl.google.com        0.0%    10    6.7   6.8   6.7   6.9   0.1</span><br><span class="line">  5. 12.34.56.79                   0.0%    10    0.0   0.0   0.0   0.0   0.0</span><br><span class="line">  6. 12.34.56.78                   0.0%    10    0.0   0.0   0.0   0.0   0.0</span><br><span class="line">  7. 12.34.56.79                   0.0%    10    0.0   0.0   0.0   0.0   0.0</span><br><span class="line">  8. 12.34.56.78                   0.0%    10    0.0   0.0   0.0   0.0   0.0</span><br><span class="line">  9. 12.34.56.79                   0.0%    10    0.0   0.0   0.0   0.0   0.0</span><br><span class="line"> 10. 12.34.56.78                   0.0%    10    0.0   0.0   0.0   0.0   0.0</span><br><span class="line"> 11. 12.34.56.79                   0.0%    10    0.0   0.0   0.0   0.0   0.0</span><br><span class="line"> 12. ???                           0.0%    10    0.0   0.0   0.0   0.0   0.0</span><br><span class="line"> 13. ???                           0.0%    10    0.0   0.0   0.0   0.0   0.0</span><br><span class="line"> 14. ???                           0.0%    10    0.0   0.0   0.0   0.0   0.0</span><br></pre></td></tr></table></figure>
<p>通过报告可以看打第 4 跳的路由器没有正确配置。如果这种状况发生了，您可以连接当地的网络管理员或 ISP 解决问题。</p>
<h3 id="ICMP-速率限制"><a href="#ICMP-速率限制" class="headerlink" title="ICMP 速率限制"></a>ICMP 速率限制</h3><p>ICMP 速率限制可引起数据包的丢失。如果数据包在这一跳有丢失，但是下面几条都正常，我们可以判断是 ICMP 速率限制的原因。如下：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">root@meiriyitie.com:~<span class="comment"># mtr --report www.google.com</span></span><br><span class="line"> HOST: localhost                   Loss%   Snt   Last   Avg  Best  Wrst StDev</span><br><span class="line">   1. 63.247.74.43                  0.0%    10    0.3   0.6   0.3   1.2   0.3</span><br><span class="line">   2. 63.247.64.157                 0.0%    10    0.4   1.0   0.4   6.1   1.8</span><br><span class="line">   3. 209.51.130.213                0.0%    10    0.8   2.7   0.8  19.0   5.7</span><br><span class="line">   4. aix.pr1.atl.google.com        0.0%    10    6.7   6.8   6.7   6.9   0.1</span><br><span class="line">   5. 72.14.233.56                 60.0%    10   27.2  25.3  23.1  26.4   2.9</span><br><span class="line">   6. 209.85.254.247                0.0%    10   39.1  39.4  39.1  39.7   0.2</span><br><span class="line">   7. 64.233.174.46                 0.0%    10   39.6  40.4  39.4  46.9   2.3</span><br><span class="line">   8. gw-in-f147.1e100.net          0.0%    10   39.6  40.5  39.5  46.7   2.2</span><br></pre></td></tr></table></figure>
<p>这种状况是没关系的。ICMP 速率限制是一种常见的手段，这样可以减少网络数据的负载，让更重要的流量先通过。</p>
<h3 id="超时"><a href="#超时" class="headerlink" title="超时"></a>超时</h3><p>在很多种情况下会发生超时现象。例如：很多路由器可能会直接丢弃 ICMP 包，这时就会导致超时（???）。另外，也有可能在数据返回的路上出现了问题。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">root@meiriyitie.com:~<span class="comment"># mtr --report www.google.com</span></span><br><span class="line">HOST: localhost                   Loss%   Snt   Last   Avg  Best  Wrst StDev</span><br><span class="line">  1. 63.247.74.43                  0.0%    10    0.3   0.6   0.3   1.2   0.3</span><br><span class="line">  2. 63.247.64.157                 0.0%    10    0.4   1.0   0.4   6.1   1.8</span><br><span class="line">  3. 209.51.130.213                0.0%    10    0.8   2.7   0.8  19.0   5.7</span><br><span class="line">  4. aix.pr1.atl.google.com        0.0%    10    6.7   6.8   6.7   6.9   0.1</span><br><span class="line">  5. ???                           0.0%    10    7.2   8.3   7.1  16.4   2.9</span><br><span class="line">  6. ???                           0.0%    10   39.1  39.4  39.1  39.7   0.2</span><br><span class="line">  7. 64.233.174.46                 0.0%    10   39.6  40.4  39.4  46.9   2.3</span><br><span class="line">  8. gw-in-f147.1e100.net          0.0%    10   39.6  40.5  39.5  46.7   2.2</span><br></pre></td></tr></table></figure>
<p>超时不一定是数据包被丢失。如上例，数据包还是安全的到达目的地并且返回。中间节点的超时可能是路由器配置丢弃 ICMP 包，或者 QoS 设置引起的原因，这个是没关系的。</p>
<h2 id="MTR-客户端"><a href="#MTR-客户端" class="headerlink" title="MTR 客户端"></a>MTR 客户端</h2><p>Windows，macOS，Linux 基本都可以很方便的下载执行 mtr 命令，但 Android 和 iOS 需要安装独立的 APP</p>
<ul>
<li>Android: <a href="https://play.google.com/store/apps/details?id=com.inflim.trp" target="_blank" rel="noopener">TracePing</a></li>
<li>iOS: <a href="https://apps.apple.com/sg/app/beenettools/id1160138136?ign-mpt=uo%3D4" target="_blank" rel="noopener">BeeNetTools</a></li>
</ul>
<h2 id="MTR-使用小结"><a href="#MTR-使用小结" class="headerlink" title="MTR 使用小结"></a>MTR 使用小结</h2><ol>
<li>mtr 的功能是检查在目的地址有丢包的情况下，查出具体在哪一跳丢包，然后反馈给机房，机房再反馈给运营商；</li>
<li>看 mtr 的截图，先看最后的目的地址是否有丢包，若最后一跳没有丢包，说明线路 ok，若最后一跳有丢包，往下看；</li>
<li>再看在路由情况，第一次丢包发生在哪一跳，对应的查这一跳的丢包情况即可；</li>
<li>如果有条件建议双向测试抓取 mtr 返回结果，对比路由是否对等；</li>
<li>整理邮件发送机房联系本地网络服务商 ISP 或者云主机服务商请求技术支持。</li>
</ol>
  
	</div>
		<footer class="article-footer clearfix">
<div class="article-catetags">

<div class="article-categories">
  <span></span>
  <a class="article-category-link" href="/categories/学习-Study/">学习 | Study</a>
</div>


</div>



	<div class="article-share" id="share">
	
	  <div data-url="https://wsgzao.github.io/post/mtr/" data-title="如何使用 MTR 诊断网络问题 | HelloDog" data-tsina="" class="share clearfix">
	  </div>
	
	</div>


</footer>

   	       
	</article>
	
<nav class="article-nav clearfix">
 
 <div class="prev" >
 <a href="/post/zabbix-ha/" title="基于 Keepalived 搭建 Zabbix Server HA 双机高可用">
  <strong>上一篇：</strong><br/>
  <span>
  基于 Keepalived 搭建 Zabbix Server HA 双机高可用</span>
</a>
</div>


<div class="next">
<a href="/post/fliggy/"  title="飞猪 F3 会员特价入住成都东大明宇豪雅饭店免费升级行政套房的体验报告">
 <strong>下一篇：</strong><br/> 
 <span>飞猪 F3 会员特价入住成都东大明宇豪雅饭店免费升级行政套房的体验报告
</span>
</a>
</div>

</nav>

	

<section id="comments" class="comment">
  <div id="disqus_thread">
    <noscript>Please enable JavaScript to view the <a href="//disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
  </div>
</section>



</div>  
      <div class="openaside"><a class="navbutton" href="#" title="显示侧边栏"></a></div>

  <div id="toc" class="toc-aside">
  <strong class="toc-title">文章目录</strong>
 
 <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#前言"><span class="toc-number">1.</span> <span class="toc-text">前言</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#更新历史"><span class="toc-number">2.</span> <span class="toc-text">更新历史</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#网络诊断相关的背景知识"><span class="toc-number">3.</span> <span class="toc-text">网络诊断相关的背景知识</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#名词解释"><span class="toc-number">4.</span> <span class="toc-text">名词解释</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#ping"><span class="toc-number">5.</span> <span class="toc-text">ping</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#安装-MTR"><span class="toc-number">6.</span> <span class="toc-text">安装 MTR</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#如何读懂-MTR-报告"><span class="toc-number">7.</span> <span class="toc-text">如何读懂 MTR 报告</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#分析-MTR-报告"><span class="toc-number">8.</span> <span class="toc-text">分析 MTR 报告</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#确定丢包率"><span class="toc-number">8.1.</span> <span class="toc-text">确定丢包率</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#读懂网络延迟"><span class="toc-number">8.2.</span> <span class="toc-text">读懂网络延迟</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#常见的-MTR-报告类型"><span class="toc-number">9.</span> <span class="toc-text">常见的 MTR 报告类型</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#目的主机网络配置不当"><span class="toc-number">9.1.</span> <span class="toc-text">目的主机网络配置不当</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#家庭或办公室路由器的原因"><span class="toc-number">9.2.</span> <span class="toc-text">家庭或办公室路由器的原因</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#运营商的路由器没有正确配置"><span class="toc-number">9.3.</span> <span class="toc-text">运营商的路由器没有正确配置</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#ICMP-速率限制"><span class="toc-number">9.4.</span> <span class="toc-text">ICMP 速率限制</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#超时"><span class="toc-number">9.5.</span> <span class="toc-text">超时</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#MTR-客户端"><span class="toc-number">10.</span> <span class="toc-text">MTR 客户端</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#MTR-使用小结"><span class="toc-number">11.</span> <span class="toc-text">MTR 使用小结</span></a></li></ol>
 
  </div>

<div id="asidepart">
<div class="closeaside"><a class="closebutton" href="#" title="隐藏侧边栏"></a></div>
<aside class="clearfix">

  
<div class="github-card">
<p class="asidetitle">Github 名片</p>
<div class="github-card" data-github="wsgzao" data-theme="medium"></div>
<script type="text/javascript" src="//lab.lepture.com/github-cards/widget.js" ></script>
</div>



  
<div class="categorieslist">
	<p class="asidetitle">分类</p>
		<ul>
		
		  
			<li><a href="/categories/Hexo/" title="Hexo">Hexo<sup>6</sup></a></li>
		  
		
		  
			<li><a href="/categories/学习-Study/" title="学习 | Study">学习 | Study<sup>180</sup></a></li>
		  
		
		  
			<li><a href="/categories/生活-Life/" title="生活 | Life">生活 | Life<sup>16</sup></a></li>
		  
		
		  
			<li><a href="/categories/软件-Soft/" title="软件 | Soft">软件 | Soft<sup>5</sup></a></li>
		  
		
		</ul>
</div>


  <div class="linkslist">
  <p class="asidetitle">友情链接</p>
    <ul>
        
          <li>
            
            	<a href="http://wuchong.me" target="_blank" title="Jark&#39;s Blog">Jark&#39;s Blog</a>
            
          </li>
        
          <li>
            
            	<a href="https://www.linkedin.com/in/aowang" target="_blank" title="LinkedIn">LinkedIn</a>
            
          </li>
        
    </ul>
</div>

  <div class="rsspart">
	<a href="/atom.xml" target="_blank" title="rss">RSS 订阅</a>
</div>

</aside>
</div>
    </div>
    <footer><div id="footer" >
	
	<div class="line">
		<span></span>
		<div class="author"></div>
	</div>
	
	
	<section class="info">
		<p> Hello, I&#39;m OX. This is my blog on GitHub. <br/>
			Keep Calm and Carry On.</p>
	</section>
	 
	<div class="social-font" class="clearfix">
		
		
		<a href="https://github.com/wsgzao" target="_blank" class="icon-github" title="github"></a>
		
		
		
		
		
		<a href="https://www.linkedin.com/in/aowang" target="_blank" class="icon-linkedin" title="linkedin"></a>
		
		
		
		
		
	</div>
			
		

		<p class="copyright">
		Powered by <a href="http://hexo.io" target="_blank" title="hexo">hexo</a> and Theme by <a href="https://github.com/wuchong/jacman" target="_blank" title="Jacman">Jacman</a> © 2020 
		
		<a href="/about" target="_blank" title="wsgzao">wsgzao</a>
		
		
		</p>
</div>
</footer>
    <script src="/js/jquery-2.0.3.min.js"></script>
<script src="/js/jquery.imagesloaded.min.js"></script>
<script src="/js/gallery.js"></script>
<script src="/js/jquery.qrcode-0.12.0.min.js"></script>

<script type="text/javascript">
$(document).ready(function(){ 
  $('.navbar').click(function(){
    $('header nav').toggleClass('shownav');
  });
  var myWidth = 0;
  function getSize(){
    if( typeof( window.innerWidth ) == 'number' ) {
      myWidth = window.innerWidth;
    } else if( document.documentElement && document.documentElement.clientWidth) {
      myWidth = document.documentElement.clientWidth;
    };
  };
  var m = $('#main'),
      a = $('#asidepart'),
      c = $('.closeaside'),
      o = $('.openaside');
  c.click(function(){
    a.addClass('fadeOut').css('display', 'none');
    o.css('display', 'block').addClass('fadeIn');
    m.addClass('moveMain');
  });
  o.click(function(){
    o.css('display', 'none').removeClass('beforeFadeIn');
    a.css('display', 'block').removeClass('fadeOut').addClass('fadeIn');      
    m.removeClass('moveMain');
  });
  $(window).scroll(function(){
    o.css("top",Math.max(80,260-$(this).scrollTop()));
  });
  
        getSize();
        if (myWidth >= 1024) {
          c.click();
        }
  
  $(window).resize(function(){
    getSize(); 
    if (myWidth >= 1024) {
      $('header nav').removeClass('shownav');
    }else{
      m.removeClass('moveMain');
      a.css('display', 'block').removeClass('fadeOut');
      o.css('display', 'none');
      
      $('#toc.toc-aside').css('display', 'none');
        
    }
  });
});
</script>

<script type="text/javascript">
$(document).ready(function(){ 
  var ai = $('.article-content>iframe'),
      ae = $('.article-content>embed'),
      t  = $('#toc'),
      ta = $('#toc.toc-aside'),
      o  = $('.openaside'),
      c  = $('.closeaside');
  if(ai.length>0){
    ai.wrap('<div class="video-container" />');
  };
  if(ae.length>0){
   ae.wrap('<div class="video-container" />');
  };
  c.click(function(){
    ta.css('display', 'block').addClass('fadeIn');
  });
  o.click(function(){
    ta.css('display', 'none');
  });
  $(window).scroll(function(){
    ta.css("top",Math.max(140,320-$(this).scrollTop()));
  });
});
</script>


<script type="text/javascript">
$(document).ready(function(){ 
  var $this = $('.share'),
      url = $this.attr('data-url'),
      encodedUrl = encodeURIComponent(url),
      title = $this.attr('data-title'),
      tsina = $this.attr('data-tsina'),
      description = $this.attr('description');
  var html = [
  '<div class="hoverqrcode clearfix"></div>',
  '<a class="overlay" id="qrcode"></a>',
  '<a href="https://www.facebook.com/sharer.php?u=' + encodedUrl + '" class="article-share-facebook" target="_blank" title="Facebook"></a>',
  '<a href="https://twitter.com/intent/tweet?url=' + encodedUrl + '" class="article-share-twitter" target="_blank" title="Twitter"></a>',
  '<a href="#qrcode" class="article-share-qrcode" title="微信"></a>',
  '<a href="http://widget.renren.com/dialog/share?resourceUrl=' + encodedUrl + '&srcUrl=' + encodedUrl + '&title=' + title +'" class="article-share-renren" target="_blank" title="人人"></a>',
  '<a href="http://service.weibo.com/share/share.php?title='+title+'&url='+encodedUrl +'&ralateUid='+ tsina +'&searchPic=true&style=number' +'" class="article-share-weibo" target="_blank" title="微博"></a>',
  '<span title="Share to"></span>'
  ].join('');
  $this.append(html);

  $('.hoverqrcode').hide();

  var myWidth = 0;
  function updatehoverqrcode(){
    if( typeof( window.innerWidth ) == 'number' ) {
      myWidth = window.innerWidth;
    } else if( document.documentElement && document.documentElement.clientWidth) {
      myWidth = document.documentElement.clientWidth;
    };
    var qrsize = myWidth > 1024 ? 200:100;
    var options = {render: 'image', size: qrsize, fill: '#2ca6cb', text: url, radius: 0.5, quiet: 1};
    var p = $('.article-share-qrcode').position();
    $('.hoverqrcode').empty().css('width', qrsize).css('height', qrsize)
                          .css('left', p.left-qrsize/2+20).css('top', p.top-qrsize-10)
                          .qrcode(options);
  };
  $(window).resize(function(){
    $('.hoverqrcode').hide();
  });
  $('.article-share-qrcode').click(function(){
    updatehoverqrcode();
    $('.hoverqrcode').toggle();
  });
  $('.article-share-qrcode').hover(function(){}, function(){
      $('.hoverqrcode').hide();
  });
});   
</script>




<script type="text/javascript">

var disqus_shortname = 'wsgzao';

(function(){
  var dsq = document.createElement('script');
  dsq.type = 'text/javascript';
  dsq.async = true;
  dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
  (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
}());
(function(){
  var dsq = document.createElement('script');
  dsq.type = 'text/javascript';
  dsq.async = true;
  dsq.src = '//' + disqus_shortname + '.disqus.com/count.js';
  (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
}());
</script>








<link rel="stylesheet" href="/fancybox/jquery.fancybox.css" media="screen" type="text/css">
<script src="/fancybox/jquery.fancybox.pack.js"></script>
<script type="text/javascript">
$(document).ready(function(){ 
  $('.article-content').each(function(i){
    $(this).find('img').each(function(){
      if ($(this).parent().hasClass('fancybox')) return;
      var alt = this.alt;
      if (alt) $(this).after('<span class="caption">' + alt + '</span>');
      $(this).wrap('<a href="' + this.src + '" title="' + alt + '" class="fancybox"></a>');
    });
    $(this).find('.fancybox').each(function(){
      $(this).attr('rel', 'article' + i);
    });
  });
  if($.fancybox){
    $('.fancybox').fancybox();
  }
}); 
</script>



<!-- Analytics Begin -->

<script type="text/javascript">
(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','//www.google-analytics.com/analytics.js','ga');
ga('create', 'UA-77732745-1', 'wsgzao.github.io');  
ga('send', 'pageview');
</script>



<script>
var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = "//hm.baidu.com/hm.js?c2c5fc7d844d0973d9f77abd87f49c3c";
  var s = document.getElementsByTagName("script")[0]; 
  s.parentNode.insertBefore(hm, s);
})();
</script>



<!-- Analytics End -->

<!-- Totop Begin -->

	<div id="totop">
	<a title="返回顶部"><img src="/img/scrollup.png"/></a>
	</div>
	<script src="/js/totop.js"></script>

<!-- Totop End -->

<!-- MathJax Begin -->
<!-- mathjax config similar to math.stackexchange -->


<!-- MathJax End -->

<!-- swiftype Begin -->

<script type="text/javascript">
  (function(w,d,t,u,n,s,e){w['SwiftypeObject']=n;w[n]=w[n]||function(){
  (w[n].q=w[n].q||[]).push(arguments);};s=d.createElement(t);
  e=d.getElementsByTagName(t)[0];s.async=1;s.src=u;e.parentNode.insertBefore(s,e);
  })(window,document,'script','//s.swiftypecdn.com/install/v2/st.js','_st');

  _st('install','_4qDmKrBPn9Es3UvQHT4','2.0.0');
</script>

<!-- swiftype End -->

  </body>
</html>
