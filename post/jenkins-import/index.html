
 <!DOCTYPE HTML>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <script type="text/javascript">
    var host = "wsgzao.github.io";
    if ((host == window.location.host) && (window.location.protocol != "https:"))
        window.location.protocol = "https";
  </script> 
<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-LJ3PMGPVCK"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-LJ3PMGPVCK');
</script>
  
    <title>Jenkins export and import jobs 迁移导出导入任务实践小结 | HelloDog</title>
    <meta name="viewport" content="width=device-width, initial-scale=1,user-scalable=no">
    
    <meta name="author" content="wsgzao">
    

    
    <meta name="description" content="Jenkins export and import jobs 迁移导出导入任务实践小结">
<meta property="og:type" content="article">
<meta property="og:title" content="Jenkins export and import jobs 迁移导出导入任务实践小结">
<meta property="og:url" content="https://wsgzao.github.io/post/jenkins-import/index.html">
<meta property="og:site_name" content="HelloDog">
<meta property="og:description" content="Jenkins export and import jobs 迁移导出导入任务实践小结">
<meta property="og:locale" content="zh_CN">
<meta property="article:published_time" content="2020-01-06T06:59:49.000Z">
<meta property="article:modified_time" content="2023-02-27T05:33:06.869Z">
<meta property="article:author" content="wsgzao">
<meta name="twitter:card" content="summary">

    
    <link rel="alternative" href="/atom.xml" title="HelloDog" type="application/atom+xml">
    
    
    <link rel="icon" href="/img/favicon.ico">
    
    
    <link rel="apple-touch-icon" href="/img/jacman.jpg">
    <link rel="apple-touch-icon-precomposed" href="/img/jacman.jpg">
    
    
<link rel="stylesheet" href="/css/style.css">

<meta name="generator" content="Hexo 6.3.0"></head>

  <body>
    <header>
      
<div>
		
			<div id="imglogo">
				<a href="/"><img src="/img/logo.png" alt="HelloDog" title="HelloDog"/></a>
			</div>
			
			<div id="textlogo">
				<h1 class="site-name"><a href="/" title="HelloDog">HelloDog</a></h1>
				<h2 class="blog-motto">Keep Calm and Carry On</h2>
			</div>
			<div class="navbar"><a class="navbutton navmobile" href="#" title="菜单">
			</a></div>
			<nav class="animated">
				<ul>
					<ul>
					 
						<li><a href="/">主页 | Home</a></li>
					
						<li><a href="/index/">索引 | Index</a></li>
					
						<li><a href="/archives/">归档 | Archives</a></li>
					
						<li><a href="/about/">简介 | About</a></li>
					
					<li>
 					
						<form class="search">
							<label>Search</label>
						<input type="text" id="search" class="st-default-search-input" name="q" size="30" placeholder="搜索"><br>
						</form>
					
					</li>
				</ul>
			</nav>			
</div>
    </header>
    <div id="container">
      <div id="main" class="post" itemscope itemprop="blogPost">
  
	<article itemprop="articleBody"> 
		<header class="article-info clearfix">
  <h1 itemprop="name">
    
      <a href="/post/jenkins-import/" title="Jenkins export and import jobs 迁移导出导入任务实践小结" itemprop="url">Jenkins export and import jobs 迁移导出导入任务实践小结</a>
  </h1>
  <p class="article-author">By
       
		<a href="/about" title="wsgzao" target="_blank" itemprop="author">wsgzao</a>
		
  <p class="article-time">
    <time datetime="2020-01-06T06:59:49.000Z" itemprop="datePublished"> 发表于 2020-01-06</time>
    
  </p>
</header>
	<div class="article-content">
<!-- 		
		<div id="toc" class="toc-article">
			<strong class="toc-title">文章目录</strong>
		
			<ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%89%8D%E8%A8%80"><span class="toc-number">1.</span> <span class="toc-text">前言</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%9B%B4%E6%96%B0%E5%8E%86%E5%8F%B2"><span class="toc-number">2.</span> <span class="toc-text">更新历史</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#export-and-import-jobs-in-Jenkins"><span class="toc-number">3.</span> <span class="toc-text">export and import jobs in Jenkins</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Solutions-x2F-Answers"><span class="toc-number">4.</span> <span class="toc-text">Solutions&#x2F;Answers:</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Solution-1"><span class="toc-number">4.1.</span> <span class="toc-text">Solution 1:</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Solution-2"><span class="toc-number">4.2.</span> <span class="toc-text">Solution 2:</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Solution-3"><span class="toc-number">4.3.</span> <span class="toc-text">Solution 3:</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Solution-4"><span class="toc-number">4.4.</span> <span class="toc-text">Solution 4:</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Solution-5"><span class="toc-number">4.5.</span> <span class="toc-text">Solution 5:</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Solution-6"><span class="toc-number">4.6.</span> <span class="toc-text">Solution 6:</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Solution-7"><span class="toc-number">4.7.</span> <span class="toc-text">Solution 7:</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Solution-8"><span class="toc-number">4.8.</span> <span class="toc-text">Solution 8:</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Solution-9"><span class="toc-number">4.9.</span> <span class="toc-text">Solution 9:</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Solution-10"><span class="toc-number">4.10.</span> <span class="toc-text">Solution 10:</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Solution-11"><span class="toc-number">4.11.</span> <span class="toc-text">Solution 11:</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Solution-12"><span class="toc-number">4.12.</span> <span class="toc-text">Solution 12:</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Solution-13"><span class="toc-number">4.13.</span> <span class="toc-text">Solution 13:</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Solution-14"><span class="toc-number">4.14.</span> <span class="toc-text">Solution 14:</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Jenkins%E8%BF%81%E7%A7%BB%E6%96%B9%E6%A1%88%E5%B0%8F%E7%BB%93"><span class="toc-number">5.</span> <span class="toc-text">Jenkins迁移方案小结</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#REST-API"><span class="toc-number">5.1.</span> <span class="toc-text">REST API</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8curl%E5%92%8CJenkins-REST-API"><span class="toc-number">5.2.</span> <span class="toc-text">使用curl和Jenkins REST API</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8python%E7%BC%96%E5%86%99api-jenkins-py%E6%A0%B8%E5%BF%83%E9%80%BB%E8%BE%91"><span class="toc-number">5.3.</span> <span class="toc-text">使用python编写api_jenkins.py核心逻辑</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Jenkins-Plugin"><span class="toc-number">6.</span> <span class="toc-text">Jenkins Plugin</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Jenkins-Backup"><span class="toc-number">7.</span> <span class="toc-text">Jenkins Backup</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Jenkins-API-Token"><span class="toc-number">8.</span> <span class="toc-text">Jenkins API Token</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%8F%82%E8%80%83%E6%96%87%E7%AB%A0"><span class="toc-number">9.</span> <span class="toc-text">参考文章</span></a></li></ol>
		
		</div>
		 -->
		<h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>我遇到的Jenkins迁移项目并非可以通过简单的物理文件复制就可以轻松解决，需要考虑上千个不同项目的jobs分离，Jenkins 1.x和2.x大版本兼容性，Jenkins Plugins插件，Jenkins Credentials凭证，Jenkins Restrict节点约束，按view分类不同项目的jobs等各种因素。这次对Jenkins迁移做了大量的研究和实践，希望总结出来的方法能对各位有帮助。</p>
<blockquote>
<p>Jenkins export and import jobs 迁移导出导入任务实践小结</p>
</blockquote>
<h2 id="更新历史"><a href="#更新历史" class="headerlink" title="更新历史"></a>更新历史</h2><p>2020年01月06日 - 初稿</p>
<p>阅读原文 - <a href="https://wsgzao.github.io/post/jenkins-import/">https://wsgzao.github.io/post/jenkins-import/</a></p>
<p><strong>扩展阅读</strong></p>
<p><a target="_blank" rel="noopener" href="https://plugins.jenkins.io/">Jenkins Plugins Index</a></p>
<hr>
<h2 id="export-and-import-jobs-in-Jenkins"><a href="#export-and-import-jobs-in-Jenkins" class="headerlink" title="export and import jobs in Jenkins"></a>export and import jobs in Jenkins</h2><p>Is it possible to exchange jobs between 2 different Jenkins’? I’m searching for a way to export&#x2F;import jobs.</p>
<h2 id="Solutions-x2F-Answers"><a href="#Solutions-x2F-Answers" class="headerlink" title="Solutions&#x2F;Answers:"></a>Solutions&#x2F;Answers:</h2><h3 id="Solution-1"><a href="#Solution-1" class="headerlink" title="Solution 1:"></a>Solution 1:</h3><p>Jenkins has a rather good wiki, albeit hard to read when you’re new to CI software…</p>
<p>They offer a simple solution for <a target="_blank" rel="noopener" href="https://wiki.jenkins-ci.org/display/JENKINS/Administering+Jenkins#AdministeringJenkins-Moving%2Fcopying%2Frenamingjobs">moving jobs between servers</a></p>
<p>The trick probably was the need to reload config from the Jenkins Configuration Page.</p>
<h3 id="Solution-2"><a href="#Solution-2" class="headerlink" title="Solution 2:"></a>Solution 2:</h3><p>Probably use jenkins command line is another option, see <a target="_blank" rel="noopener" href="https://wiki.jenkins-ci.org/display/JENKINS/Jenkins+CLI">https://wiki.jenkins-ci.org&#x2F;display&#x2F;JENKINS&#x2F;Jenkins+CLI</a></p>
<ul>
<li>create-job: Creates a new job by reading stdin as a configuration XML file.</li>
<li>get-job: Dumps the job definition XML to stdout</li>
</ul>
<p>So you can do</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">java -jar jenkins-cli.jar -s http://server get-job myjob &gt; myjob.xml</span><br><span class="line">java -jar jenkins-cli.jar -s http://server create-job newmyjob &lt; myjob.xml</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>It works fine for me and I am used to store in inside my version control system</p>
<h3 id="Solution-3"><a href="#Solution-3" class="headerlink" title="Solution 3:"></a>Solution 3:</h3><p>A one-liner:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ curl -s http://OLD_JENKINS/job/JOBNAME/config.xml | curl -X POST &#x27;http://NEW_JENKINS/createItem?name=JOBNAME&#x27; --header &quot;Content-Type: application/xml&quot; -d @-</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>With authentication:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ curl -s http:///&lt;USER&gt;:&lt;API_TOKEN&gt;@OLD_JENKINS/job/JOBNAME/config.xml | curl -X POST &#x27;http:///&lt;USER&gt;:&lt;API_TOKEN&gt;@NEW_JENKINS/createItem?name=JOBNAME&#x27; --header &quot;Content-Type: application/xml&quot; -d @-</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>With Crumb, if CSRF is active (<a target="_blank" rel="noopener" href="https://stackoverflow.com/questions/38137760/jenkins-rest-api-create-job">see details here</a>):</p>
<p>Get crumb with:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ CRUMB_OLD=$(curl -s &#x27;http://&lt;USER&gt;:&lt;API_TOKEN&gt;@OLD_JENKINS/crumbIssuer/api/xml?xpath=concat(//crumbRequestField,&quot;:&quot;,//crumb)&#x27;)</span><br><span class="line">$ CRUMB_NEW=$(curl -s &#x27;http://&lt;USER&gt;:&lt;API_TOKEN&gt;@NEW_JENKINS/crumbIssuer/api/xml?xpath=concat(//crumbRequestField,&quot;:&quot;,//crumb)&#x27;)</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>Apply crumb with <code>-H CRUMB</code>:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ curl -s -H $CRUMB_OLD http:///&lt;USER&gt;:&lt;API_TOKEN&gt;@OLD_JENKINS/job/JOBNAME/config.xml | curl -X POST -H $CRUMB_NEW &#x27;http:///&lt;USER&gt;:&lt;API_TOKEN&gt;@NEW_JENKINS/createItem?name=JOBNAME&#x27; --header &quot;Content-Type: application/xml&quot; -d @-</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h3 id="Solution-4"><a href="#Solution-4" class="headerlink" title="Solution 4:"></a>Solution 4:</h3><p>There’s a plugin called <a target="_blank" rel="noopener" href="https://wiki.jenkins-ci.org/display/JENKINS/Job+Import+Plugin">Job Import Plugin</a> that may be what you are looking for. I have used it. It does have issues with importing projects from a server that doesn’t allow anonymous access.</p>
<p>For Completeness:<br>If you have command line access to both, you can do the procedure already mentioned by Khez for <a target="_blank" rel="noopener" href="https://wiki.jenkins-ci.org/display/JENKINS/Administering+Jenkins#AdministeringJenkins-Moving/copying/renamingjobs">Moving, Copying and Renaming Jenkins Jobs</a>.</p>
<h3 id="Solution-5"><a href="#Solution-5" class="headerlink" title="Solution 5:"></a>Solution 5:</h3><p>Go to your Jenkins server’s front page, click on REST API at the bottom of the page:</p>
<blockquote>
<p>Create Job</p>
</blockquote>
<p>To create a new job, post <code>config.xml</code> to this URL with query parameter <code>name=JOBNAME</code>. You need to send a <code>Content-Type: application/xml</code> header. You’ll get <code>200</code> status code if the creation is successful, or <code>4xx/5xx</code> code if it fails. <code>config.xml</code> is the format Jenkins uses to store the project in the file system, so you can see examples of them in the Jenkins home directory, or by retrieving the XML configuration of existing jobs from <code>/job/JOBNAME/config.xml</code>.</p>
<h3 id="Solution-6"><a href="#Solution-6" class="headerlink" title="Solution 6:"></a>Solution 6:</h3><p>In my Jenkins instance (version 1.548) the configuration file is at:</p>
<p><code>/var/lib/jenkins/jobs/-the-project-name-/config.xml</code></p>
<p>Owned by jenkins user and jenkins group with 644 permissions. Copying the file to and from here should work. I haven’t tried changing it directly but have backed-up the config from this spot in case the project needs to be setup again.</p>
<h3 id="Solution-7"><a href="#Solution-7" class="headerlink" title="Solution 7:"></a>Solution 7:</h3><p><strong><a target="_blank" rel="noopener" href="https://wiki.jenkins.io/display/JENKINS/Job+Import+Plugin">Job Import plugin</a></strong> is the easy way here to import jobs from another Jenkins instance. Just need to provide the URL of the source Jenkins instance. The Remote Jenkins URL can take any of the following types of URLs:</p>
<ul>
<li><p><code>http://$JENKINS</code> – get all jobs on remote instance</p>
</li>
<li><p><code>http://$JENKINS/job/$JOBNAME</code> – get a single job</p>
</li>
<li><p><code>http://$JENKINS/view/$VIEWNAME</code> – get all jobs in a particular view</p>
</li>
</ul>
<h3 id="Solution-8"><a href="#Solution-8" class="headerlink" title="Solution 8:"></a>Solution 8:</h3><p>Thanks to Larry Cai’s answer I managed to create a script to backup all my Jenkins jobs. I created a job that runs this every week. In case someone finds it useful, here it is:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">#!/bin/bash</span><br><span class="line">#IFS for jobs with spaces.</span><br><span class="line">SAVEIFS=$IFS</span><br><span class="line">IFS=$(echo -en &quot;\n\b&quot;)</span><br><span class="line">for i in $(java -jar /run/jenkins/war/WEB-INF/jenkins-cli.jar -s http://server:8080/ list-jobs);</span><br><span class="line">do</span><br><span class="line">  java -jar /run/jenkins/war/WEB-INF/jenkins-cli.jar -s http://server:8080/ get-job $&#123;i&#125; &gt; $&#123;i&#125;.xml;</span><br><span class="line">done</span><br><span class="line">IFS=$SAVEIFS</span><br><span class="line">mkdir deploy</span><br><span class="line">tar cvfj &quot;jenkins-jobs.tar.bz2&quot; ./*.xml</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h3 id="Solution-9"><a href="#Solution-9" class="headerlink" title="Solution 9:"></a>Solution 9:</h3><p>Jenkins export jobs to a directory</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">#! /bin/bash</span><br><span class="line">   SAVEIFS=$IFS</span><br><span class="line">   IFS=$(echo -en &quot;\n\b&quot;)</span><br><span class="line">   declare -i j=0</span><br><span class="line">   for i in $(java -jar jenkins-cli.jar -s http://server:8080/jenkins list-jobs  --username **** --password ***);</span><br><span class="line">   do</span><br><span class="line">   let &quot;j++&quot;;</span><br><span class="line">   echo $j;</span><br><span class="line">   if [ $j -gt 283 ] // If you have more jobs do it in chunks as it will terminate in the middle of the process. So Resume your job from where it ends.</span><br><span class="line">    then</span><br><span class="line">   java -jar jenkins-cli.jar -s http://lxvbmcbma:8080/jenkins get-job --username **** --password **** $&#123;i&#125; &gt; $&#123;i&#125;.xml;</span><br><span class="line">   echo &quot;done&quot;;</span><br><span class="line">   fi</span><br><span class="line">   done</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>Import jobs</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">for f in *.xml;</span><br><span class="line">do</span><br><span class="line">echo &quot;Processing $&#123;f%.*&#125; file..&quot;; //truncate the .xml extention and load the xml file for job creation</span><br><span class="line">java -jar jenkins-cli.jar -s http://server:8080/jenkins create-job $&#123;f%.*&#125;  &lt; $f</span><br><span class="line">done</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h3 id="Solution-10"><a href="#Solution-10" class="headerlink" title="Solution 10:"></a>Solution 10:</h3><p>Simple php script worked for me.</p>
<p><strong>Export:</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">// add all job codes in the array</span><br><span class="line">$jobs = array(&quot;job1&quot;, &quot;job2&quot;, &quot;job3&quot;);</span><br><span class="line"></span><br><span class="line">foreach ($jobs as $value)</span><br><span class="line">&#123;</span><br><span class="line">    fwrite(STDOUT, $value. &quot; \n&quot;) or die(&quot;Unable to open file!&quot;);</span><br><span class="line">    $path = &quot;http://server1:8080/jenkins/job/&quot;.$value.&quot;/config.xml&quot;;</span><br><span class="line">    $myfile = fopen($value.&quot;.xml&quot;, &quot;w&quot;);</span><br><span class="line">    fwrite($myfile, file_get_contents($path));</span><br><span class="line">    fclose($myfile);</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><strong>Import:</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line"></span><br><span class="line">// add all job codes in the array</span><br><span class="line">$jobs = array(&quot;job1&quot;, &quot;job2&quot;, &quot;job3&quot;);</span><br><span class="line"></span><br><span class="line">foreach ($arr as $value)</span><br><span class="line">&#123;</span><br><span class="line">    fwrite(STDOUT, $value. &quot; \n&quot;) or die(&quot;Unable to open file!&quot;);</span><br><span class="line">    $cmd = &quot;java -jar jenkins-cli.jar -s http://server2:8080/jenkins/ create-job &quot;.$value.&quot; &lt; &quot;.$value.&quot;.xml&quot;;</span><br><span class="line">    echo exec($cmd);</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h3 id="Solution-11"><a href="#Solution-11" class="headerlink" title="Solution 11:"></a>Solution 11:</h3><p>This does not work for existing jobs, however there is <a target="_blank" rel="noopener" href="http://docs.openstack.org/infra/jenkins-job-builder/">Jenkins job builder</a>.</p>
<p>This allows one to keep job definitions in yaml files and in a git repo which is very portable.</p>
<h3 id="Solution-12"><a href="#Solution-12" class="headerlink" title="Solution 12:"></a>Solution 12:</h3><p>For those of us in the Windows world who may or may not have Bash available, here’s my PowerShell port of <strong>Katu</strong> and <strong>Larry Cai</strong>‘s approach. Hope it helps someone.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">##### Config vars #####</span><br><span class="line">$serverUri = &#x27;http://localhost:8080/&#x27; # URI of your Jenkins server</span><br><span class="line">$jenkinsCli = &#x27;C:\Program Files (x86)\Jenkins\war\WEB-INF\jenkins-cli.jar&#x27; # Path to jenkins-cli.jar on your machine</span><br><span class="line">$destFolder = &#x27;C:\Jenkins Backup\&#x27; # Output folder (will be created if it doesn&#x27;t exist)</span><br><span class="line">$destFile = &#x27;jenkins-jobs.zip&#x27; # Output filename (will be overwritten if it exists)</span><br><span class="line">########################</span><br><span class="line"></span><br><span class="line">$work = Join-Path ([System.IO.Path]::GetTempPath()) ([System.IO.Path]::GetRandomFileName())</span><br><span class="line">New-Item -ItemType Directory -Force -Path $work | Out-Null # Suppress output noise</span><br><span class="line">echo &quot;Created a temp working folder: $work&quot;</span><br><span class="line"></span><br><span class="line">$jobs = (java -jar $jenkinsCli -s $serverUri list-jobs)</span><br><span class="line">echo &quot;Found $($jobs.Length) existing jobs: [$jobs]&quot;</span><br><span class="line"></span><br><span class="line">foreach ($j in $jobs)</span><br><span class="line">&#123;</span><br><span class="line">    $outfile = Join-Path $work &quot;$j.xml&quot;</span><br><span class="line">    java -jar $jenkinsCli -s $serverUri get-job $j | Out-File $outfile</span><br><span class="line">&#125;</span><br><span class="line">echo &quot;Saved $($jobs.Length) jobs to temp XML files&quot;</span><br><span class="line"></span><br><span class="line">New-Item -ItemType Directory -Force -Path $destFolder | Out-Null # Suppress output noise</span><br><span class="line">echo &quot;Found (or created) $destFolder folder&quot;</span><br><span class="line"></span><br><span class="line">$destPath = Join-Path $destFolder $destFile</span><br><span class="line">Get-ChildItem $work -Filter *.xml |</span><br><span class="line">    Write-Zip -Level 9 -OutputPath $destPath -FlattenPaths |</span><br><span class="line">    Out-Null # Suppress output noise</span><br><span class="line">echo &quot;Copied $($jobs.Length) jobs to $destPath&quot;</span><br><span class="line"></span><br><span class="line">Remove-Item $work -Recurse -Force</span><br><span class="line">echo &quot;Removed temp working folder&quot;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h3 id="Solution-13"><a href="#Solution-13" class="headerlink" title="Solution 13:"></a>Solution 13:</h3><p>It is very easy just download plugin name</p>
<p><a target="_blank" rel="noopener" href="https://wiki.jenkins.io/display/JENKINS/Job+Import+Plugin">Job Import Plugin</a></p>
<p>Enter the URL of your Remote Jenkins server and it will import the jobs automatically</p>
<h3 id="Solution-14"><a href="#Solution-14" class="headerlink" title="Solution 14:"></a>Solution 14:</h3><p>The most easy way, with direct access to the machine is to copy the job folder from first jenkins to another one (you can exclude workspaces – <code>workspace</code> folder), because the whole job configuration is stored in the xml file on the disk.</p>
<p>Then in the new jenkins just <code>reload configuration</code> in the global settings (admin access is required) should be enough, if not, then you will need to restart Jenkins tool.</p>
<p>Another way can be to use plugins mentioned above this post.</p>
<p>edit:<br>– in case you can probably also exclude <code>modules</code> folders</p>
<h2 id="Jenkins迁移方案小结"><a href="#Jenkins迁移方案小结" class="headerlink" title="Jenkins迁移方案小结"></a>Jenkins迁移方案小结</h2><blockquote>
<p>上面列举有14种方法居多，但大多数是基于方案4进行扩展</p>
</blockquote>
<p>上面列举的方案基本已经非常全了，感觉是不是有点眼花？其实归纳总结主要有以下4种</p>
<ol>
<li>官方的Moving&#x2F;copying&#x2F;renaming jobs，即所谓的物理文件迁移，如果情况复杂此方案不推荐</li>
<li>基于Jenkins CLI，该方案需要依赖jenkins-cli.jar包括java使用范围具有一定局限性，不推荐</li>
<li>基于类似Job Import Plugin插件形式，该类方案普适性较差，不推荐</li>
<li>基于Jenkins REST API，核心是获取<code>&lt;jenkinshost&gt;/job/&lt;jobname&gt;/config.xml</code>，效果最佳</li>
</ol>
<h3 id="REST-API"><a href="#REST-API" class="headerlink" title="REST API"></a>REST API</h3><p>Many objects of Jenkins provide the remote access API. They are available at &#x2F;…&#x2F;api&#x2F; where “…” portion is the object for which you’d like to access.</p>
<blockquote>
<p>XML API</p>
</blockquote>
<p>Access data exposed in HTML as XML for machine consumption. Schema is also available.<br>You can also specify optional XPath to control the fragment you’d like to obtain (but see below). For example, ..&#x2F;api&#x2F;xml?xpath&#x3D;&#x2F;<em>&#x2F;</em>[0].</p>
<p>For XPath that matches multiple nodes, you need to also specify the “wrapper” query parameter to specify the name of the root XML element to be create so that the resulting XML becomes well-formed.</p>
<p>Similarly exclude query parameter can be used to exclude nodes that match the given XPath from the result. This is useful for trimming down the amount of data you fetch (but again see below). This query parameter can be specified multiple times.</p>
<p>XPath filtering is powerful, and you can have it only return a very small data, but note that the server still has to build a full DOM of the raw data, which could cause a large memory spike. To avoid overloading the server, consider using the tree parameter, or use the xpath parameter in conjunction with the tree parameter. When used together, the result of the tree parameter filtering is built into DOM, then the XPath is applied to compute the final return value. In this way, you can often substantially reduce the size of DOM built in memory.</p>
<blockquote>
<p>JSON API</p>
</blockquote>
<p>Access the same data as JSON for JavaScript-based access. tree may be used.</p>
<blockquote>
<p>Python API</p>
</blockquote>
<p>Access the same data as Python for Python clients. This can be parsed into Python object as eval(urllib.urlopen(“…”).read()) and the resulting object tree is identical to that of JSON. However, when you do this, beware of the security implication. If you are connecting to a non-trusted Jenkins, the server can send you malicious Python programs.</p>
<p>In Python 2.6 or later you can safely parse this output using ast.literal_eval(urllib.urlopen(“…”).read())</p>
<p>For more information about remote API in Jenkins, see the documentation.</p>
<p><a target="_blank" rel="noopener" href="https://jenkins.io/redirect/remote-api">https://jenkins.io/redirect/remote-api</a></p>
<h3 id="使用curl和Jenkins-REST-API"><a href="#使用curl和Jenkins-REST-API" class="headerlink" title="使用curl和Jenkins REST API"></a>使用curl和Jenkins REST API</h3><blockquote>
<p>使用Jenkins REST API建议关闭CSRF防护</p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># To retrieve the job config.xml</span></span><br><span class="line">curl -X GET <span class="string">&#x27;&lt;jenkinshost&gt;/job/&lt;jobname&gt;/config.xml&#x27;</span> -u username:API_TOKEN -o &lt;jobname&gt;.xml</span><br><span class="line"></span><br><span class="line"><span class="comment"># to use this config to create a new job</span></span><br><span class="line">curl -s -XPOST <span class="string">&#x27;&lt;jenkinshost&gt;/createItem?name=&lt;jobname&gt;&#x27;</span> -u username:API_TOKEN --data-binary @&lt;jobname&gt;.xml -H <span class="string">&quot;Content-Type:text/xml&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># get all jenkins jobs</span></span><br><span class="line">curl -X GET <span class="string">&#x27;&lt;jenkinshost&gt;/api/json?pretty=true&#x27;</span> -u username:API_TOKEN -o jobs.json</span><br><span class="line"></span><br><span class="line"><span class="comment"># get jenkins view</span></span><br><span class="line">curl -X GET <span class="string">&#x27;&lt;jenkinshost&gt;/view/&lt;viewname&gt;/api/json&#x27;</span> -u username:API_TOKEN -o view.json</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>Obviously, replace:</p>
<ul>
<li>username API_TOKEN with your username and password&#x2F;API_Token</li>
<li>jenkinshost with your Jenkins URL</li>
<li>jobname with the name of the job that you created via the UI</li>
</ul>
<p><a target="_blank" rel="noopener" href="https://json-csv.com/">JSON to CSV Converter</a></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">mkdir</span> config_xml</span><br><span class="line">vim jobs.txt</span><br><span class="line">vim jenkins_jobs_migration.sh</span><br><span class="line"></span><br><span class="line"><span class="comment">#/bin/bash</span></span><br><span class="line">source_jenkins_host=<span class="string">&quot;xxx&quot;</span></span><br><span class="line">source_jenkins_username=<span class="string">&quot;xxx&quot;</span></span><br><span class="line">source_jenkins_password=<span class="string">&quot;xxx&quot;</span></span><br><span class="line"></span><br><span class="line">target_jenkins_host=<span class="string">&quot;xxx&quot;</span></span><br><span class="line">target_jenkins_username=<span class="string">&quot;xxx&quot;</span></span><br><span class="line">target_jenkins_password=<span class="string">&quot;xxx&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="title">pull</span></span>() &#123;</span><br><span class="line">    <span class="keyword">for</span> line <span class="keyword">in</span> `<span class="built_in">cat</span> jobs.txt`</span><br><span class="line">    <span class="keyword">do</span></span><br><span class="line">        <span class="built_in">echo</span> <span class="variable">$&#123;line&#125;</span></span><br><span class="line">        curl -X GET <span class="variable">$&#123;source_jenkins_host&#125;</span>job/<span class="variable">$&#123;line&#125;</span>/config.xml -u <span class="variable">$&#123;source_jenkins_username&#125;</span>:<span class="variable">$&#123;source_jenkins_password&#125;</span> -o config_xml/<span class="variable">$&#123;line&#125;</span>.xml</span><br><span class="line">    <span class="keyword">done</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="title">push</span></span>() &#123;</span><br><span class="line">    <span class="keyword">for</span> line <span class="keyword">in</span> `<span class="built_in">cat</span> jobs.txt`</span><br><span class="line">    <span class="keyword">do</span></span><br><span class="line">        <span class="built_in">echo</span> <span class="variable">$line</span></span><br><span class="line">        httprc=$(curl -s -XPOST <span class="variable">$&#123;target_jenkins_host&#125;</span>job/<span class="variable">$&#123;line&#125;</span>/doDelete -u <span class="variable">$&#123;target_jenkins_username&#125;</span>:<span class="variable">$&#123;target_jenkins_password&#125;</span>)</span><br><span class="line">        curl -s -XPOST <span class="variable">$&#123;target_jenkins_host&#125;</span>createItem?name=<span class="variable">$&#123;line&#125;</span> -u <span class="variable">$&#123;target_jenkins_username&#125;</span>:<span class="variable">$&#123;target_jenkins_password&#125;</span> --data-binary @config_xml/<span class="variable">$&#123;line&#125;</span>.xml -H <span class="string">&quot;Content-Type:text/xml&quot;</span></span><br><span class="line">    <span class="keyword">done</span></span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">case</span> <span class="string">&quot;<span class="variable">$1</span>&quot;</span> <span class="keyword">in</span></span><br><span class="line">    push)</span><br><span class="line">        push</span><br><span class="line">        ;;</span><br><span class="line">    pull)</span><br><span class="line">        pull</span><br><span class="line">        ;;</span><br><span class="line">    *)</span><br><span class="line">        <span class="built_in">echo</span> <span class="string">&quot;Usage: <span class="variable">$NAME</span> &#123;pull|push&#125;&quot;</span></span><br><span class="line">        <span class="built_in">exit</span> 1</span><br><span class="line">        ;;</span><br><span class="line"><span class="keyword">esac</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>


<h3 id="使用python编写api-jenkins-py核心逻辑"><a href="#使用python编写api-jenkins-py核心逻辑" class="headerlink" title="使用python编写api_jenkins.py核心逻辑"></a>使用python编写api_jenkins.py核心逻辑</h3><blockquote>
<p>暂不方便公开</p>
</blockquote>
<ol>
<li>支持读取context.json配置文件使用pipeline.j2模板自动生成不同类型的pipeline.xml导入文件</li>
<li>支持按view或者job export导出job config.xml配置信息</li>
<li>支持按view或者job import导入job config.xml配置信息</li>
</ol>
<h2 id="Jenkins-Plugin"><a href="#Jenkins-Plugin" class="headerlink" title="Jenkins Plugin"></a>Jenkins Plugin</h2><p>迁移插件可以通过上传<code>.hpi</code>一次性搞定，当然你也可用使用REST API或者jenkins-cli</p>
<p><a target="_blank" rel="noopener" href="https://jenkins.io/doc/book/managing/plugins/">Managing Plugins</a></p>
<h2 id="Jenkins-Backup"><a href="#Jenkins-Backup" class="headerlink" title="Jenkins Backup"></a>Jenkins Backup</h2><blockquote>
<p>archive jenkins setting and plugins</p>
</blockquote>
<p>大家应该都知道Jenkins备份插件目前主要就2种选择:</p>
<ul>
<li><a target="_blank" rel="noopener" href="https://plugins.jenkins.io/backup">Backup</a></li>
<li><a target="_blank" rel="noopener" href="https://plugins.jenkins.io/periodicbackup">Periodic Backup</a></li>
</ul>
<p>严格意义上来说应该只能选择Periodic Backup，但是如果是需要定期备份自然离不开编写Bash脚本</p>
<p><a target="_blank" rel="noopener" href="https://github.com/sue445/jenkins-backup-script">jenkins-backup-script</a></p>
<h2 id="Jenkins-API-Token"><a href="#Jenkins-API-Token" class="headerlink" title="Jenkins API Token"></a>Jenkins API Token</h2><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> hudson.model.*</span><br><span class="line"><span class="keyword">import</span> jenkins.model.*</span><br><span class="line"><span class="keyword">import</span> jenkins.security.*</span><br><span class="line"><span class="keyword">import</span> jenkins.security.apitoken.*</span><br><span class="line"></span><br><span class="line"><span class="comment">// you can change the &quot;admin&quot; name</span></span><br><span class="line"><span class="comment">// the false is to explicitely ask to not create a user who does not exist yet</span></span><br><span class="line"><span class="keyword">def</span> user = User.get(<span class="string">&quot;gop.bot@garena.com&quot;</span>, <span class="literal">false</span>)</span><br><span class="line"><span class="keyword">def</span> prop = user.getProperty(ApiTokenProperty.<span class="keyword">class</span>)</span><br><span class="line"><span class="comment">// the name is up to you</span></span><br><span class="line"><span class="keyword">def</span> result = prop.tokenStore.generateNewToken(<span class="string">&quot;token-created-by-script&quot;</span>)</span><br><span class="line">user.save()</span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> result.plainValue</span><br></pre></td></tr></table></figure>

<p><a target="_blank" rel="noopener" href="https://issues.jenkins-ci.org/browse/JENKINS-52339">New API Token system should allow tokens to be created for service accounts</a></p>
<h2 id="参考文章"><a href="#参考文章" class="headerlink" title="参考文章"></a>参考文章</h2><p><a target="_blank" rel="noopener" href="https://config9.com/apps/jenkins/export-import-jobs-in-jenkins/">Export&#x2F;import jobs in Jenkins</a></p>
<p><a target="_blank" rel="noopener" href="https://wiki.jenkins.io/display/JENKINS/Administering+Jenkins#AdministeringJenkins-Moving%2Fcopying%2Frenamingjobs">Moving&#x2F;copying&#x2F;renaming jobs</a></p>
<p><a target="_blank" rel="noopener" href="https://wiki.jenkins.io/display/JENKINS/Jenkins+CLI">Jenkins CLI</a></p>
<p><a target="_blank" rel="noopener" href="https://support.cloudbees.com/hc/en-us/articles/220857567-How-to-create-a-job-using-the-REST-API-and-cURL-">How to create a job using the REST API and cURL?</a></p>
<p><a target="_blank" rel="noopener" href="https://wiki.jenkins-ci.org/display/JENKINS/Remote+access+API">Jenkins Remote access API</a></p>
  
	</div>
		<footer class="article-footer clearfix">
<div class="article-catetags">

<div class="article-categories">
  <span></span>
  <a class="article-category-link" href="/categories/%E5%AD%A6%E4%B9%A0-Study/">学习 | Study</a>
</div>


</div>



	<div class="article-share" id="share">
	
	  <div data-url="https://wsgzao.github.io/post/jenkins-import/" data-title="Jenkins export and import jobs 迁移导出导入任务实践小结 | HelloDog" data-tsina="" class="share clearfix">
	  </div>
	
	</div>


</footer>

   	       
	</article>
	
<nav class="article-nav clearfix">
 
 <div class="prev" >
 <a href="/post/yaml/" title="YAML入门教程">
  <strong>上一篇：</strong><br/>
  <span>
  YAML入门教程</span>
</a>
</div>


<div class="next">
<a href="/post/jenkins-plugins/"  title="Jenkins Plugins常用插件推荐">
 <strong>下一篇：</strong><br/> 
 <span>Jenkins Plugins常用插件推荐
</span>
</a>
</div>

</nav>

	

<section id="comments" class="comment">
  <div id="disqus_thread">
    <noscript>Please enable JavaScript to view the <a target="_blank" rel="noopener" href="//disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
  </div>
</section>



</div>  
      <div class="openaside"><a class="navbutton" href="#" title="显示侧边栏"></a></div>

  <div id="toc" class="toc-aside">
  <strong class="toc-title">文章目录</strong>
 
 <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%89%8D%E8%A8%80"><span class="toc-number">1.</span> <span class="toc-text">前言</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%9B%B4%E6%96%B0%E5%8E%86%E5%8F%B2"><span class="toc-number">2.</span> <span class="toc-text">更新历史</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#export-and-import-jobs-in-Jenkins"><span class="toc-number">3.</span> <span class="toc-text">export and import jobs in Jenkins</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Solutions-x2F-Answers"><span class="toc-number">4.</span> <span class="toc-text">Solutions&#x2F;Answers:</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Solution-1"><span class="toc-number">4.1.</span> <span class="toc-text">Solution 1:</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Solution-2"><span class="toc-number">4.2.</span> <span class="toc-text">Solution 2:</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Solution-3"><span class="toc-number">4.3.</span> <span class="toc-text">Solution 3:</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Solution-4"><span class="toc-number">4.4.</span> <span class="toc-text">Solution 4:</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Solution-5"><span class="toc-number">4.5.</span> <span class="toc-text">Solution 5:</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Solution-6"><span class="toc-number">4.6.</span> <span class="toc-text">Solution 6:</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Solution-7"><span class="toc-number">4.7.</span> <span class="toc-text">Solution 7:</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Solution-8"><span class="toc-number">4.8.</span> <span class="toc-text">Solution 8:</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Solution-9"><span class="toc-number">4.9.</span> <span class="toc-text">Solution 9:</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Solution-10"><span class="toc-number">4.10.</span> <span class="toc-text">Solution 10:</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Solution-11"><span class="toc-number">4.11.</span> <span class="toc-text">Solution 11:</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Solution-12"><span class="toc-number">4.12.</span> <span class="toc-text">Solution 12:</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Solution-13"><span class="toc-number">4.13.</span> <span class="toc-text">Solution 13:</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Solution-14"><span class="toc-number">4.14.</span> <span class="toc-text">Solution 14:</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Jenkins%E8%BF%81%E7%A7%BB%E6%96%B9%E6%A1%88%E5%B0%8F%E7%BB%93"><span class="toc-number">5.</span> <span class="toc-text">Jenkins迁移方案小结</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#REST-API"><span class="toc-number">5.1.</span> <span class="toc-text">REST API</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8curl%E5%92%8CJenkins-REST-API"><span class="toc-number">5.2.</span> <span class="toc-text">使用curl和Jenkins REST API</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8python%E7%BC%96%E5%86%99api-jenkins-py%E6%A0%B8%E5%BF%83%E9%80%BB%E8%BE%91"><span class="toc-number">5.3.</span> <span class="toc-text">使用python编写api_jenkins.py核心逻辑</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Jenkins-Plugin"><span class="toc-number">6.</span> <span class="toc-text">Jenkins Plugin</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Jenkins-Backup"><span class="toc-number">7.</span> <span class="toc-text">Jenkins Backup</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Jenkins-API-Token"><span class="toc-number">8.</span> <span class="toc-text">Jenkins API Token</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%8F%82%E8%80%83%E6%96%87%E7%AB%A0"><span class="toc-number">9.</span> <span class="toc-text">参考文章</span></a></li></ol>
 
  </div>

<div id="asidepart">
<div class="closeaside"><a class="closebutton" href="#" title="隐藏侧边栏"></a></div>
<aside class="clearfix">

  
<div class="github-card">
<p class="asidetitle">Github 名片</p>
<div class="github-card" data-github="wsgzao" data-theme="medium"></div>
<script type="text/javascript" src="//lab.lepture.com/github-cards/widget.js" ></script>
</div>



  
<div class="categorieslist">
	<p class="asidetitle">分类</p>
		<ul>
		
		  
			<li><a href="/categories/Hexo/" title="Hexo">Hexo<sup>6</sup></a></li>
		  
		
		  
			<li><a href="/categories/学习-Study/" title="学习 | Study">学习 | Study<sup>192</sup></a></li>
		  
		
		  
			<li><a href="/categories/生活-Life/" title="生活 | Life">生活 | Life<sup>26</sup></a></li>
		  
		
		  
			<li><a href="/categories/软件-Soft/" title="软件 | Soft">软件 | Soft<sup>5</sup></a></li>
		  
		
		</ul>
</div>


  <div class="linkslist">
  <p class="asidetitle">友情链接</p>
    <ul>
        
          <li>
            
            	<a href="http://wuchong.me" target="_blank" title="Jark&#39;s Blog">Jark&#39;s Blog</a>
            
          </li>
        
          <li>
            
            	<a href="https://www.linkedin.com/in/aowang" target="_blank" title="LinkedIn">LinkedIn</a>
            
          </li>
        
    </ul>
</div>

  <div class="rsspart">
	<a href="/atom.xml" target="_blank" title="rss">RSS 订阅</a>
</div>

</aside>
</div>
    </div>
    <footer><div id="footer" >
	
	<div class="line">
		<span></span>
		<div class="author"></div>
	</div>
	
	
	<section class="info">
		<p> Hello, I&#39;m OX. This is my blog on GitHub. <br/>
			Keep Calm and Carry On.</p>
	</section>
	 
	<div class="social-font" class="clearfix">
		
		
		<a href="https://github.com/wsgzao" target="_blank" class="icon-github" title="github"></a>
		
		
		
		
		
		<a href="https://www.linkedin.com/in/aowang" target="_blank" class="icon-linkedin" title="linkedin"></a>
		
		
		
		
		
	</div>
			
		

		<p class="copyright">
		Powered by <a href="http://hexo.io" target="_blank" title="hexo">hexo</a> and Theme by <a href="https://github.com/wuchong/jacman" target="_blank" title="Jacman">Jacman</a> © 2023 
		
		<a href="/about" target="_blank" title="wsgzao">wsgzao</a>
		
		
		</p>
</div>
</footer>
    <script src="/js/jquery-3.6.4.min.js"></script>
<script src="/js/jquery.imagesloaded.min.js"></script>
<script src="/js/gallery.js"></script>
<script src="/js/jquery-qrcode-0.18.0.min.js"></script>

<script type="text/javascript">
$(document).ready(function(){ 
  $('.navbar').click(function(){
    $('header nav').toggleClass('shownav');
  });
  var myWidth = 0;
  function getSize(){
    if( typeof( window.innerWidth ) == 'number' ) {
      myWidth = window.innerWidth;
    } else if( document.documentElement && document.documentElement.clientWidth) {
      myWidth = document.documentElement.clientWidth;
    };
  };
  var m = $('#main'),
      a = $('#asidepart'),
      c = $('.closeaside'),
      o = $('.openaside');
  c.click(function(){
    a.addClass('fadeOut').css('display', 'none');
    o.css('display', 'block').addClass('fadeIn');
    m.addClass('moveMain');
  });
  o.click(function(){
    o.css('display', 'none').removeClass('beforeFadeIn');
    a.css('display', 'block').removeClass('fadeOut').addClass('fadeIn');      
    m.removeClass('moveMain');
  });
  $(window).scroll(function(){
    o.css("top",Math.max(80,260-$(this).scrollTop()));
  });
  
        getSize();
        if (myWidth >= 1024) {
          c.click();
        }
  
  $(window).resize(function(){
    getSize(); 
    if (myWidth >= 1024) {
      $('header nav').removeClass('shownav');
    }else{
      m.removeClass('moveMain');
      a.css('display', 'block').removeClass('fadeOut');
      o.css('display', 'none');
      
      $('#toc.toc-aside').css('display', 'none');
        
    }
  });
});
</script>

<script type="text/javascript">
$(document).ready(function(){ 
  var ai = $('.article-content>iframe'),
      ae = $('.article-content>embed'),
      t  = $('#toc'),
      ta = $('#toc.toc-aside'),
      o  = $('.openaside'),
      c  = $('.closeaside');
  if(ai.length>0){
    ai.wrap('<div class="video-container" />');
  };
  if(ae.length>0){
   ae.wrap('<div class="video-container" />');
  };
  c.click(function(){
    ta.css('display', 'block').addClass('fadeIn');
  });
  o.click(function(){
    ta.css('display', 'none');
  });
  $(window).scroll(function(){
    ta.css("top",Math.max(140,320-$(this).scrollTop()));
  });
});
</script>


<script type="text/javascript">
$(document).ready(function(){ 
  var $this = $('.share'),
      url = $this.attr('data-url'),
      encodedUrl = encodeURIComponent(url),
      title = $this.attr('data-title'),
      tsina = $this.attr('data-tsina'),
      description = $this.attr('description');
  var html = [
  '<div class="hoverqrcode clearfix"></div>',
  '<a class="overlay" id="qrcode"></a>',
  '<a href="https://www.facebook.com/sharer.php?u=' + encodedUrl + '" class="article-share-facebook" target="_blank" title="Facebook"></a>',
  '<a href="https://twitter.com/intent/tweet?url=' + encodedUrl + '" class="article-share-twitter" target="_blank" title="Twitter"></a>',
  '<a href="#qrcode" class="article-share-qrcode" title="微信"></a>',
  '<a href="http://widget.renren.com/dialog/share?resourceUrl=' + encodedUrl + '&srcUrl=' + encodedUrl + '&title=' + title +'" class="article-share-renren" target="_blank" title="人人"></a>',
  '<a href="http://service.weibo.com/share/share.php?title='+title+'&url='+encodedUrl +'&ralateUid='+ tsina +'&searchPic=true&style=number' +'" class="article-share-weibo" target="_blank" title="微博"></a>',
  '<span title="Share to"></span>'
  ].join('');
  $this.append(html);

  $('.hoverqrcode').hide();

  var myWidth = 0;
  function updatehoverqrcode(){
    if( typeof( window.innerWidth ) == 'number' ) {
      myWidth = window.innerWidth;
    } else if( document.documentElement && document.documentElement.clientWidth) {
      myWidth = document.documentElement.clientWidth;
    };
    var qrsize = myWidth > 1024 ? 200:100;
    var options = {render: 'image', size: qrsize, fill: '#2ca6cb', text: url, radius: 0.5, quiet: 1};
    var p = $('.article-share-qrcode').position();
    $('.hoverqrcode').empty().css('width', qrsize).css('height', qrsize)
                          .css('left', p.left-qrsize/2+20).css('top', p.top-qrsize-10)
                          .qrcode(options);
  };
  $(window).resize(function(){
    $('.hoverqrcode').hide();
  });
  $('.article-share-qrcode').click(function(){
    updatehoverqrcode();
    $('.hoverqrcode').toggle();
  });
  $('.article-share-qrcode').hover(function(){}, function(){
      $('.hoverqrcode').hide();
  });
});   
</script>




<script type="text/javascript">

var disqus_shortname = 'wsgzao';

(function(){
  var dsq = document.createElement('script');
  dsq.type = 'text/javascript';
  dsq.async = true;
  dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
  (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
}());
(function(){
  var dsq = document.createElement('script');
  dsq.type = 'text/javascript';
  dsq.async = true;
  dsq.src = '//' + disqus_shortname + '.disqus.com/count.js';
  (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
}());
</script>








<link rel="stylesheet" href="/fancybox/jquery.fancybox.css" media="screen" type="text/css">
<script src="/fancybox/jquery.fancybox.pack.js"></script>
<script type="text/javascript">
$(document).ready(function(){ 
  $('.article-content').each(function(i){
    $(this).find('img').each(function(){
      if ($(this).parent().hasClass('fancybox')) return;
      var alt = this.alt;
      if (alt) $(this).after('<span class="caption">' + alt + '</span>');
      $(this).wrap('<a href="' + this.src + '" title="' + alt + '" class="fancybox"></a>');
    });
    $(this).find('.fancybox').each(function(){
      $(this).attr('rel', 'article' + i);
    });
  });
  if($.fancybox){
    $('.fancybox').fancybox();
  }
}); 
</script>



<!-- Analytics Begin -->

<script type="text/javascript">
(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','//www.google-analytics.com/analytics.js','ga');
ga('create', 'UA-77732745-1', 'wsgzao.github.io');  
ga('send', 'pageview');
</script>



<script>
var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = "//hm.baidu.com/hm.js?c2c5fc7d844d0973d9f77abd87f49c3c";
  var s = document.getElementsByTagName("script")[0]; 
  s.parentNode.insertBefore(hm, s);
})();
</script>



<!-- Analytics End -->

<!-- Totop Begin -->

	<div id="totop">
	<a title="返回顶部"><img src="/img/scrollup.png"/></a>
	</div>
	<script src="/js/totop.js"></script>

<!-- Totop End -->

<!-- MathJax Begin -->
<!-- mathjax config similar to math.stackexchange -->


<!-- MathJax End -->

<!-- swiftype Begin -->

<script type="text/javascript">
  (function(w,d,t,u,n,s,e){w['SwiftypeObject']=n;w[n]=w[n]||function(){
  (w[n].q=w[n].q||[]).push(arguments);};s=d.createElement(t);
  e=d.getElementsByTagName(t)[0];s.async=1;s.src=u;e.parentNode.insertBefore(s,e);
  })(window,document,'script','//s.swiftypecdn.com/install/v2/st.js','_st');

  _st('install','_4qDmKrBPn9Es3UvQHT4','2.0.0');
</script>

<!-- swiftype End -->

  </body>
</html>
